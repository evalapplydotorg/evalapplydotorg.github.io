<!DOCTYPE html>
<html lang="en" prefix="og: https://ogp.me/ns#">
  <head>
    <!-- Some basic hygiene meta-data -->
<title>Animating Text Art in JavaScript</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="author" content="Aditya Athalye">
<meta name="description"
      content="It is with no small thanks to MDN, StackOverflow, Firefox&apos;s support for countless open tabs, JavaScript&apos;s support for first-class functions, and first-class supportive colleagues, I learned it is possible for a web front end novice to program &quot;text art animations&quot;. Whatever that is even. Because I thoroughly enjoyed doing just that for Hanukkah of Data 2022. Here&apos;s how it went down.">
<meta name="keywords" content="systems thinking,functional programming,architecture,software design,technology leadership,devops,clojure">
<meta property="og:title" content="Animating Text Art in JavaScript">
<meta property="og:description" content="It is with no small thanks to MDN, StackOverflow, Firefox&apos;s support for countless open tabs, JavaScript&apos;s support for first-class functions, and first-class supportive colleagues, I learned it is possible for a web front end novice to program &quot;text art animations&quot;. Whatever that is even. Because I thoroughly enjoyed doing just that for Hanukkah of Data 2022. Here&apos;s how it went down.">
<meta property="og:locale" content="en_GB">
<meta property="og:type" content="website">
<meta property="og:url" content="https://www.evalapply.org/posts/animate-text-art-javascript/index.html">
    <link rel="stylesheet preload" type="text/css" as="style" href="https://www.evalapply.org/static/css/style.css">
<link href="https://www.evalapply.org/index.xml"
      rel="alternate" type="application/rss+xml"
      title="Eval / Apply is pure magic">
<link rel="canonical" href="https://www.evalapply.org/posts/animate-text-art-javascript/index.html">
<link rel="icon" type="image/vnd.microsoft.icon" href="https://www.evalapply.org/static/img/favicon.ico">
</head>
  <body>
    <div id="the-very-top" class="stack center box">
        <header id="site-header">
  <div class="box invert stack">
    <div class="with-sidebar site-header">
      <a class="box icon" href="https://www.evalapply.org/index.html#main">
        <img src="https://www.evalapply.org/static/img/Lisp_logo.svg" alt="Eval / Apply is pure magic">
      </a>
      <div class="stack">
        <div class="site-header site-header:title">Eval / Apply is pure magic</div>
        <nav class="cluster site-header site-header:nav-items">
          <a href="https://www.evalapply.org/index.html#main">
   &lambda; about
</a>
<a href="https://www.evalapply.org/posts/index.html">
   &#9753; blog
</a>
<a href="mailto:hello@evalapply.org">
   email
</a>
<a href="#site-footer">
   &rlhar; subscribe
</a>
        </nav>
      </div>
    </div>
  </div>
</header>
        <main id="main">
          <article id="blog-post" class="stack">
  <header>
    <div class="stack">
      <div class="title">Animating Text Art in JavaScript</div>
      <div class="cluster post-meta">
           <span>&uarr; <a href="#site-header" rel="bookmark">menu</a></span>
           <span>&darr; <a href="#blog-post-footer" rel="bookmark">discuss</a></span>
           <span>&darr; <a href="#blog-post-toc" rel="bookmark">toc</a></span>
      </div>
      <div class="summary">It is with no small thanks to MDN, StackOverflow, Firefox's support for countless open tabs, JavaScript's support for first-class functions, and first-class supportive colleagues, I learned it is possible for a web front end novice to program "text art animations". Whatever that is even. Because I thoroughly enjoyed doing just that for Hanukkah of Data 2022. Here's how it went down.</div>
      <div class="cluster post-meta">
        <span class="author">By: Adi</span>
        <span class="date">Published: 2023-01-16</span>
        <span class="date">Updated: 2023-01-16</span>
        <span class="tags">Tags:  / <a href="https://www.evalapply.org/tags/hanukkah_of_data/index.html#main">#hanukkah_of_data</a> / <a href="https://www.evalapply.org/tags/text_art/index.html#main">#text_art</a> / <a href="https://www.evalapply.org/tags/javascript/index.html#main">#javascript</a> / <a href="https://www.evalapply.org/tags/functional_programming/index.html#main">#functional_programming</a> / <a href="https://www.evalapply.org/tags/howto/index.html#main">#howto</a>
        </span>
      </div>
      <hr>
    </div>
  </header>
  <section class="stack">
      <div id="blog-post-toc" class="stack table-of-contents">
  <details class="box invert stack" open>
    <summary>
      <strong>Contents</strong>
    </summary>
    <nav class="stack">
      <a href="#data-puzzles-in-december" class="toc-heading:h1">"Data Puzzles in December"</a>
<a href="#what-is-text-art-animation-even" class="toc-heading:h1">What is <em>Text Art Animation</em> even?</a>
<a href="#from-darkdraw-to-thine-browser" class="toc-heading:h1">From DarkDraw to thine Browser</a>
<a href="#architecture-discovering-the-spreadsheet-in-the-problem" class="toc-heading:h1">Architecture: Discovering the spreadsheet in the problem</a>
<a href="#how-it-began-the-dom-as-a-data-structure" class="toc-heading:h2">How it began: The DOM as a data structure</a>
<a href="#how-it-is-the-dom-as-a-live-spreadsheet" class="toc-heading:h2">How it is: The DOM as a live spreadsheet</a>
<a href="#what-transpired-in-between-learning-to-see" class="toc-heading:h2">What transpired in-between: Learning to "see"</a>
<a href="#details-details-details" class="toc-heading:h1">Details details details</a>
<a href="#the-aesthetic-of-text-art-and-its-animation" class="toc-heading:h2">The aesthetic of Text Art and its Animation</a>
<a href="#structuring-darkdraw-source-data" class="toc-heading:h2">Structuring DarkDraw source data</a>
<a href="#choice-of-javascript" class="toc-heading:h2">Choice of Javascript</a>
<a href="#choice-of-animation-method" class="toc-heading:h2">Choice of animation method</a>
<a href="#window.requestanimationframe-had-me-on-the-fence" class="toc-heading:h3"><code>Window.requestAnimationFrame</code> had me on the fence</a>
<a href="#element.animate-is-neato-but-it-cannot-modify-elements" class="toc-heading:h3"><code>Element.animate</code> is neato, but it cannot modify elements</a>
<a href="#setinterval-and-settimeout-worked-just-right" class="toc-heading:h3"><code>setInterval</code> and <code>setTimeout</code> worked just right</a>
<a href="#composition-and-painting" class="toc-heading:h2">Composition and Painting</a>
<a href="#conclusion" class="toc-heading:h1">Conclusion</a>
<a href="#copyright-notice" class="toc-heading:h1">Copyright notice</a>
<a href="#acknowledgments" class="toc-heading:h1">Acknowledgments</a>
<a href="#footnotes" class="toc-heading:h1">Footnotes</a>
    </nav>
  </details>
</div>
<hr>
  <script type="text/javascript" src="animations.js"></script>
<figure>
<img src="HanukkahOfData2022ArtSliceCopyrightDwimmertxt.png" alt="" /><figcaption>Slice of text art for <a href="https://hanukkah.bluebird.sh/credits/">Hanukkah of Data 2022</a>, by <a href="#copyright-notice">dwimmer</a>. Solve the puzzles to see it all, <em>or</em> use the cheat noted below. :)</figcaption>
</figure>
<h1 id="data-puzzles-in-december">"Data Puzzles in December"</h1>
<p>A perfectly innocent-looking thread <code>saulpw</code> (a.k.a. <a href="https://www.saul.pw/">Saul Pwanson</a>) started in the <a href="#site-footer">Recurse Center</a> community Zulip. Tame enough to scroll past at first glance. As did I. Lucky me, someone did not. <em>"What's a data puzzle?"</em>, they asked.</p>
<p>So. Saul wanted to create an <em>AoC-like</em> <a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> for data nerds <a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>. He elaborated thusly:</p>
<blockquote>
<p>"… they're puzzles that you solve from the data clues.</p>
<p>Like here's one: You overhear someone saying that they're in "the only place in the state where you can join the mile-high club in a church". And you would get a list of US places and figure out which place it must be."</p>
<p>— saulpw</p>
</blockquote>
<p>Long story short <a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>, there I was, tagging along with a <a href="https://hanukkah.bluebird.sh/credits/">merry band of Devottys and assorted gentlenerds</a>, tryna make a thing.</p>
<p>The goal became to create a local-first game experience. Where the puzzle data set is a file to download (CSV, JSON, SQLITE). Each day, a puzzle question is released to the website. There is no central scoreboard. Stats are personal. Answers are validated locally. Correct answers beget lightings of flames, reveals of parts of a tapestry, complete with animated animals.</p>
<p>Oh yes, Animated Text Art!</p>
<h1 id="what-is-text-art-animation-even">What is <em>Text Art Animation</em> even?</h1>
<p>'tis Pointillism in motion. Imagination cast as pure data. Digital art with, ah, <em>character</em>.</p>
<pre class="text"><code> ⎠(  ⎠/⎞⎜  ⎠⎞  ⎟⎟  ⎛(  ⎞⎞⎛⎛ ⎠⎛⎞ \ ⎞ ᾆ῎ϔᾧᾗ ⎛ /  ⎛⎝  ⎞⎞⎛⎛  ⎠⎛⎝  ⎜⎜ ⎛⎛⎝
 ⎝‿)    ⎝ (‿⎠  ⎟⎛  ⎝‿) ⎟⎟⎜⎜ ⎝‿⎠  ⎞⎟ ⎜;ἷˈɮ ⎜⎛   ⎝‿) ⎟⎟⎜⎜  ⎝‿⎠  ⎞⎜ ⎝‿⎠
  Ɣ        Ɣ    \   Ɣ  ⎠/⎞⎜  Ɣ   ⎟⎟ ⎜.¡ ⎟ ⎜⎜    Ɣ  ⎟⎛\⎝   Ɣ   /   Ɣ
ζ⅋ɧℌ¸    ҁᾯ¡ҩℷ    ʧ₧℘ҩ¸   ⎝ζ⅋ɧℌ¸ ⎟⎛ ⎜ ʖ ⎟ ⎞⎜ ʧ₧℘ҩ¸⎠   ζ⅋ɧℌ¸   ҁᾯ¡ҩ
ᾆ῟¡₰ᾗ    ᾆ῎ϔᾧᾗ    Ḉἧ℃&#39;ῒ   ᾆ῟¡₰ᾗ   \{ìɨʉɨí}/  Ḉἧ℃&#39;ῒ    ᾆ῟¡₰ᾗ    ᾆ῎ϔᾧ
⎜¸ƾ῟ἷ    ⎜;ἷˈɮ    ⎜Ҹ῏῝ʖ    ⎜¸ƾ῟ἷ    )ˊ⁀ˋ(     ⎜Ҹ῏῝ʖ    ⎜¸ƾ῟ἷ    ⎜;ἷˈ
</code></pre>
<p>Lots of character in fact. Each <code>UTF8</code> character chosen with care. Each instance of each character lovingly hand-picked, painstakingly hand-placed, and coloured. <em>Animated</em> Text Art is several frames worth of this loving, caring, painstaking arrangement of plain text. Maybe two frames that blink at you, maybe forty-two that make a candle flame dance. A craft that hearkens back to <em>Ye Olde</em> days of hand-drawn animation.</p>
<figure>
<img src="HanukkahOfData2022DarkDrawDrawingViewCopyrightDwimmer.png" alt="" /><figcaption><a href="https://instagram.com/dwimmertxt">dwimmer</a> created the Text Art with <a href="https://github.com/devottys/darkdraw">DarkDraw</a>, in <a href="https://www.visidata.org/">VisiData</a>.</figcaption>
</figure>
<figure>
<img src="HanukkahOfData2022DarkDrawSheetViewCopyrightDwimmer.png" alt="" /><figcaption>The "Backing Sheet" view, of the drawing, in DarkDraw + VisiData.</figcaption>
</figure>
<p>And here it is, exported as JSON:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true"></a>{<span class="st">&quot;id&quot;</span><span class="op">:</span> <span class="st">&quot;off&quot;</span><span class="op">,</span> <span class="st">&quot;type&quot;</span><span class="op">:</span> <span class="st">&quot;frame&quot;</span><span class="op">,</span> <span class="st">&quot;text&quot;</span><span class="op">:</span> <span class="st">&quot;&quot;</span><span class="op">,</span> <span class="st">&quot;color&quot;</span><span class="op">:</span> <span class="st">&quot;&quot;</span><span class="op">,</span> <span class="st">&quot;tags&quot;</span><span class="op">:</span> []<span class="op">,</span> <span class="st">&quot;group&quot;</span><span class="op">:</span> <span class="st">&quot;&quot;</span><span class="op">,</span> <span class="st">&quot;duration_ms&quot;</span><span class="op">:</span> <span class="dv">100</span>}<span class="op">,</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true"></a>{<span class="st">&quot;id&quot;</span><span class="op">:</span> <span class="st">&quot;on&quot;</span><span class="op">,</span> <span class="st">&quot;type&quot;</span><span class="op">:</span> <span class="st">&quot;frame&quot;</span><span class="op">,</span> <span class="st">&quot;text&quot;</span><span class="op">:</span> <span class="st">&quot;&quot;</span><span class="op">,</span> <span class="st">&quot;color&quot;</span><span class="op">:</span> <span class="st">&quot;&quot;</span><span class="op">,</span> <span class="st">&quot;tags&quot;</span><span class="op">:</span> []<span class="op">,</span> <span class="st">&quot;group&quot;</span><span class="op">:</span> <span class="st">&quot;&quot;</span><span class="op">,</span> <span class="st">&quot;duration_ms&quot;</span><span class="op">:</span> <span class="dv">100</span>}<span class="op">,</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true"></a>{<span class="st">&quot;x&quot;</span><span class="op">:</span> <span class="dv">76</span><span class="op">,</span> <span class="st">&quot;y&quot;</span><span class="op">:</span> <span class="dv">5</span><span class="op">,</span> <span class="st">&quot;text&quot;</span><span class="op">:</span> <span class="st">&quot;</span><span class="sc">\u0194</span><span class="st">&quot;</span><span class="op">,</span> <span class="st">&quot;color&quot;</span><span class="op">:</span> <span class="st">&quot;88&quot;</span><span class="op">,</span> <span class="st">&quot;tags&quot;</span><span class="op">:</span> [<span class="st">&quot;wick&quot;</span><span class="op">,</span> <span class="st">&quot;day1&quot;</span>]<span class="op">,</span> <span class="st">&quot;group&quot;</span><span class="op">:</span> <span class="st">&quot;&quot;</span><span class="op">,</span> <span class="st">&quot;frame&quot;</span><span class="op">:</span> <span class="st">&quot;on&quot;</span><span class="op">,</span> <span class="st">&quot;href&quot;</span><span class="op">:</span> <span class="st">&quot;1&quot;</span>}<span class="op">,</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true"></a>{<span class="st">&quot;x&quot;</span><span class="op">:</span> <span class="dv">40</span><span class="op">,</span> <span class="st">&quot;y&quot;</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="st">&quot;text&quot;</span><span class="op">:</span> <span class="st">&quot;</span><span class="sc">\u0194</span><span class="st">&quot;</span><span class="op">,</span> <span class="st">&quot;color&quot;</span><span class="op">:</span> <span class="st">&quot;88&quot;</span><span class="op">,</span> <span class="st">&quot;tags&quot;</span><span class="op">:</span> [<span class="st">&quot;wick&quot;</span><span class="op">,</span> <span class="st">&quot;day0&quot;</span>]<span class="op">,</span> <span class="st">&quot;group&quot;</span><span class="op">:</span> <span class="st">&quot;&quot;</span><span class="op">,</span> <span class="st">&quot;frame&quot;</span><span class="op">:</span> <span class="st">&quot;on&quot;</span>}<span class="op">,</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true"></a>{<span class="st">&quot;x&quot;</span><span class="op">:</span> <span class="dv">46</span><span class="op">,</span> <span class="st">&quot;y&quot;</span><span class="op">:</span> <span class="dv">11</span><span class="op">,</span> <span class="st">&quot;text&quot;</span><span class="op">:</span> <span class="st">&quot;{&quot;</span><span class="op">,</span> <span class="st">&quot;color&quot;</span><span class="op">:</span> <span class="st">&quot;255 bold&quot;</span><span class="op">,</span> <span class="st">&quot;tags&quot;</span><span class="op">:</span> [<span class="st">&quot;menorah&quot;</span>]<span class="op">,</span> <span class="st">&quot;group&quot;</span><span class="op">:</span> <span class="st">&quot;&quot;</span><span class="op">,</span> <span class="st">&quot;frame&quot;</span><span class="op">:</span> <span class="st">&quot;off&quot;</span>}<span class="op">,</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true"></a>{<span class="st">&quot;x&quot;</span><span class="op">:</span> <span class="dv">52</span><span class="op">,</span> <span class="st">&quot;y&quot;</span><span class="op">:</span> <span class="dv">11</span><span class="op">,</span> <span class="st">&quot;text&quot;</span><span class="op">:</span> <span class="st">&quot;}&quot;</span><span class="op">,</span> <span class="st">&quot;color&quot;</span><span class="op">:</span> <span class="st">&quot;255 bold&quot;</span><span class="op">,</span> <span class="st">&quot;tags&quot;</span><span class="op">:</span> [<span class="st">&quot;menorah&quot;</span>]<span class="op">,</span> <span class="st">&quot;group&quot;</span><span class="op">:</span> <span class="st">&quot;&quot;</span><span class="op">,</span> <span class="st">&quot;frame&quot;</span><span class="op">:</span> <span class="st">&quot;off&quot;</span>}</span></code></pre></div>
<p>But, honestly, 'tis awesome sauce that mere pictures do not do justice to.</p>
<p>Go <a href="https://hanukkah.bluebird.sh/">play Hanukkah of Data</a> to uncover the art and animations for yourself! Or cheat <a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a>.</p>
<h1 id="from-darkdraw-to-thine-browser">From DarkDraw to thine Browser</h1>
<figure>
<img src="HanukkahOfData2022ArtCopyrightDwimmertxt.png" alt="" /><figcaption>Browser rendering of the delightful Text Art for Hanukkah of Data, by <a href="https://instagram.com/dwimmertxt">dwimmer</a>.</figcaption>
</figure>
<p>Text Art can literally be Javascript too, if your artist draws in <a href="https://github.com/devottys/darkdraw">DarkDraw</a> and your build pipeline exports plain text <code>ddw</code> file contents straight into handy JSON arrays.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true"></a><span class="kw">for</span> <span class="ex">i</span> in menorah tapestry flame <span class="kw">;</span> <span class="kw">do</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true"></a>    <span class="bu">echo</span> -n <span class="st">&quot;const </span><span class="va">${i}</span><span class="st">DDW = &quot;</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true"></a>    <span class="ex">vd</span> -b resources/<span class="va">${i}</span>.ddw -o - --save-filetype json</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true"></a><span class="kw">done</span> <span class="op">&gt;</span> <span class="ex">assets/js/text_art_data.js</span></span></code></pre></div>
<p>And this is where the front end novice—yours truly—begins to git forge ahead, footguns in both hands, pointed squarely at feet, after this fateful utterance…</p>
<blockquote>
<p><em>"Sure, I'll try to Javascript the Text Art Animation."</em>.</p>
<p>— Yours Truly</p>
</blockquote>
<p>A foolish line, as I was soon to discover.</p>
<p>For it was a thing I had never really done. Write Javascript, I mean. The foolishness comes naturally. Luckily it was virtue this time. If I had known how much I'd sweat trying to do justice to the talented <a href="https://instagram.com/dwimmertxt">dwimmer's</a> Text Art, I'd have quietly stayed home.</p>
<p>Still… I knew that Javascript is a fairly <em><a href="https://evalapply.org/tags/functional_programming/index.html#main">Functional</a></em> language, which provided comfort that I could do <em>something</em>. In the end, I think it came out alright, in about 200 lines of code, warts and all.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true"></a><span class="fu">grep</span> --count -v -E <span class="kw">\</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true"></a>     <span class="ex">-e</span> <span class="st">&quot;^$&quot;</span> -e <span class="st">&quot;//&quot;</span> -e <span class="st">&quot;/|\s+\*.*&quot;</span> <span class="kw">\</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true"></a>     <span class="ex">assets/js/text_artist.js</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true"></a><span class="ex">213</span></span></code></pre></div>
<h1 id="architecture-discovering-the-spreadsheet-in-the-problem">Architecture: Discovering the spreadsheet in the problem</h1>
<p>Spreadsheets are a personal favourite tool. Commonplace problems tend to fit snugly into spreadsheet-like models and behaviours. When confronted by a new problem, I invariably make tables to make sense of it. And I've used spreadsheets a lot in off-label ways too (Ever created dynamic data-driven app mock-ups in Excel?). Yet, it took some doing before I finally <em>saw</em> that I can (should) use the web browser + DOM as a <em>dynamic medium</em> to play with rather than an <em>inert target</em> to overwrite.</p>
<h2 id="how-it-began-the-dom-as-a-data-structure">How it began: The DOM as a data structure</h2>
<p>Text art was arranged in terms of 2D matrices (Javascript array-of-arrays). That was translated to HTML with which to replace DOM contents entirely, viz. <code>artcontext.append(htmlizeArtSheet(art_sheet))</code>, as seen here:</p>
<details class="box invert stack">
<summary>
<code>Treating the browser as an inert target.</code>
<hr />
</summary><code>
<div class="sourceCode" id="cb5"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true"></a><span class="kw">function</span> <span class="fu">updateDom</span>(</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true"></a>    artcontext <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">querySelector</span>(<span class="st">&#39;.textart&#39;</span>)<span class="op">,</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true"></a>    max_cols <span class="op">=</span> MAX_COLS<span class="op">,</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true"></a>    max_rows <span class="op">=</span> MAX_ROWS) {</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true"></a>    <span class="co">// with reference to ./tapestry_test.html</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true"></a>    <span class="co">// This represents a flame animation sequence spread over 41 frames.</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true"></a>    <span class="kw">const</span> flame_ddw_animation <span class="op">=</span> <span class="fu">ddwChars</span>(candleFlameAnimatedDDW)<span class="op">;</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true"></a>    <span class="co">// Just pulling out arbitrary shapes of the flame, to place over</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true"></a>    <span class="co">// each candle position.</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true"></a>    <span class="kw">const</span> nine_flames <span class="op">=</span> [<span class="st">&quot;0&quot;</span><span class="op">,</span> <span class="st">&quot;1&quot;</span><span class="op">,</span> <span class="st">&quot;2&quot;</span><span class="op">,</span> <span class="st">&quot;3&quot;</span><span class="op">,</span> <span class="st">&quot;5&quot;</span><span class="op">,</span> <span class="st">&quot;8&quot;</span><span class="op">,</span> <span class="st">&quot;13&quot;</span><span class="op">,</span> <span class="st">&quot;21&quot;</span><span class="op">,</span> <span class="st">&quot;34&quot;</span>]</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true"></a>          <span class="op">.</span><span class="fu">reduce</span>(</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true"></a>              <span class="kw">function</span> (flame_frames<span class="op">,</span> frame_id<span class="op">,</span> idx) {</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true"></a>                  flame_frames[idx] <span class="op">=</span> flame_ddw_animation<span class="op">.</span><span class="fu">filter</span>(char <span class="kw">=&gt;</span> char<span class="op">.</span><span class="at">frame</span> <span class="op">==</span> frame_id)<span class="op">;</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true"></a>                  <span class="cf">return</span> flame_frames<span class="op">;</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true"></a>              }<span class="op">,</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true"></a>              [])<span class="op">;</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true"></a></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true"></a>    <span class="co">// Offset each flame data to coordinates that place each flame over</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true"></a>    <span class="co">// each candle&#39;s wick.</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true"></a>    <span class="kw">const</span> nine_flames_transposed <span class="op">=</span> [{<span class="dt">x</span><span class="op">:</span>  <span class="dv">3</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="dv">2</span>}<span class="op">,</span> {<span class="dt">x</span><span class="op">:</span> <span class="dv">11</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="dv">2</span>}<span class="op">,</span> {<span class="dt">x</span><span class="op">:</span> <span class="dv">20</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="dv">2</span>}<span class="op">,</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true"></a>                                    {<span class="dt">x</span><span class="op">:</span> <span class="dv">29</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="dv">2</span>}<span class="op">,</span> {<span class="dt">x</span><span class="op">:</span> <span class="dv">39</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="dv">2</span>}<span class="op">,</span> {<span class="dt">x</span><span class="op">:</span> <span class="dv">48</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="dv">2</span>}<span class="op">,</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true"></a>                                    {<span class="dt">x</span><span class="op">:</span> <span class="dv">57</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="dv">2</span>}<span class="op">,</span> {<span class="dt">x</span><span class="op">:</span> <span class="dv">66</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="dv">2</span>}<span class="op">,</span> {<span class="dt">x</span><span class="op">:</span> <span class="dv">75</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="dv">2</span>}</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true"></a>                                   ]<span class="op">.</span><span class="fu">flatMap</span>(({x<span class="op">,</span> y}<span class="op">,</span> idx) <span class="kw">=&gt;</span> <span class="fu">transposeCharLocations</span>(x<span class="op">,</span> y<span class="op">,</span> nine_flames[idx]))<span class="op">;</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true"></a></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true"></a>    <span class="co">// Composite teaserDDW data with overlay data of the nine flames.</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true"></a>    <span class="kw">const</span> teaser_with_flame_ddw <span class="op">=</span> <span class="fu">ddwChars</span>(teaserDDW)<span class="op">.</span><span class="fu">concat</span>(nine_flames_transposed)<span class="op">;</span></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true"></a></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true"></a>    <span class="co">// Reshape the composite data into the expected matrix form that will be painted.</span></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true"></a>    <span class="kw">const</span> art_sheet <span class="op">=</span> <span class="fu">insertDdwCharsIntoTextArtSheet</span>(teaser_with_flame_ddw<span class="op">,</span> max_cols<span class="op">,</span> max_rows)<span class="op">;</span></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true"></a>    <span class="co">// console.log(art_sheet);</span></span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true"></a></span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true"></a>    <span class="co">// Finally... Paint the text art!</span></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true"></a>    artcontext<span class="op">.</span><span class="fu">append</span>(<span class="fu">htmlizeArtSheet</span>(art_sheet))<span class="op">;</span></span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true"></a></span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true"></a>    <span class="cf">return</span> artcontext<span class="op">;</span></span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true"></a>}<span class="op">;</span></span></code></pre></div>
</code></details>
<p>The workhorse function was a Javascript matrix manipulator:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true"></a><span class="kw">function</span> <span class="fu">insertDdwCharsIntoTextArtSheet</span>(</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true"></a>    ddw_char_array<span class="op">,</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true"></a>    x_cols <span class="op">=</span> MAX_COLS<span class="op">,</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true"></a>    y_rows <span class="op">=</span> MAX_ROWS<span class="op">,</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true"></a>    ddw_char_maker <span class="op">=</span> makeDdwChar) {</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true"></a>    <span class="kw">const</span> insertIfPositionExists <span class="op">=</span> (char_matrix<span class="op">,</span> ddw_char) <span class="kw">=&gt;</span> {</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true"></a>        <span class="kw">let</span> {x<span class="op">,</span> y} <span class="op">=</span> ddw_char<span class="op">;</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true"></a>        <span class="cf">if</span> (y <span class="op">&lt;</span> y_rows <span class="op">&amp;&amp;</span> x <span class="op">&lt;</span> x_cols) {</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true"></a>            char_matrix[y][x] <span class="op">=</span> ddw_char<span class="op">;</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true"></a>        }</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true"></a>        <span class="cf">return</span> char_matrix<span class="op">;</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true"></a>    }<span class="op">;</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true"></a></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true"></a>    <span class="cf">return</span> ddw_char_array</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true"></a>        <span class="op">.</span><span class="fu">reduce</span>(insertIfPositionExists<span class="op">,</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true"></a>                <span class="fu">makeTextArtSheet</span>(x_cols<span class="op">,</span> y_rows<span class="op">,</span> ddw_char_maker))<span class="op">;</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true"></a>}</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true"></a></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true"></a><span class="kw">function</span> <span class="fu">makeTextArtSheet</span>(</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true"></a>    x_cols <span class="op">=</span> MAX_COLS<span class="op">,</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true"></a>    y_rows <span class="op">=</span> MAX_ROWS<span class="op">,</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true"></a>    ddw_char_maker <span class="op">=</span> makeDdwChar) {</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true"></a>    <span class="cf">return</span> <span class="bu">Array</span><span class="op">.</span><span class="fu">from</span>({<span class="dt">length</span><span class="op">:</span> y_rows}<span class="op">,</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true"></a>                      (_<span class="op">,</span> y) <span class="kw">=&gt;</span> <span class="bu">Array</span><span class="op">.</span><span class="fu">from</span>({<span class="dt">length</span><span class="op">:</span> x_cols}<span class="op">,</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true"></a>                                           (_<span class="op">,</span> x) <span class="kw">=&gt;</span> <span class="fu">ddw_char_maker</span>(x<span class="op">,</span> y)))<span class="op">;</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true"></a>}</span></code></pre></div>
<p>Yes, I didn't pay_​attention to namingConventions in that version.</p>
<h2 id="how-it-is-the-dom-as-a-live-spreadsheet">How it is: The DOM as a live spreadsheet</h2>
<p>Now, everything is designed around a live "canvas" written to the DOM. Mechanically, the canvas is a rectangular grid of empty <code>&lt;span&gt;</code> elements, organised by and uniquely addressable by x/y coordinates set as data attributes. All text art operations assume the DOM already contains this live "canvas", and query/update any part of it, based on information set in the source data (coordinates, glyph, style, frames, tags etc.).</p>
<details class="box invert stack">
<summary>
<code>Treating the browser as a live medium.</code>
<hr />
</summary><code>
<div class="sourceCode" id="cb7"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true"></a><span class="kw">function</span> <span class="fu">updateDom</span>() {</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true"></a>    <span class="kw">let</span> now <span class="op">=</span> <span class="bu">Date</span><span class="op">.</span><span class="fu">now</span>()<span class="op">;</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true"></a>    <span class="kw">let</span> han5738_begins <span class="op">=</span> <span class="bu">Date</span><span class="op">.</span><span class="fu">UTC</span>(<span class="dv">2022</span><span class="op">,</span> <span class="dv">11</span><span class="op">,</span> <span class="dv">18</span><span class="op">,</span> <span class="dv">16</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true"></a>    <span class="kw">let</span> han5738_ends <span class="op">=</span> <span class="bu">Date</span><span class="op">.</span><span class="fu">UTC</span>(<span class="dv">2022</span><span class="op">,</span> <span class="dv">11</span><span class="op">,</span> <span class="dv">26</span><span class="op">,</span> <span class="dv">16</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true"></a>    <span class="kw">let</span> dayZero <span class="op">=</span> now <span class="op">&gt;</span> han5738_ends <span class="op">?</span> <span class="fu">getStartTime</span>(<span class="dv">0</span>) <span class="op">:</span> han5738_begins<span class="op">;</span> <span class="co">// depending on when a player starts the game</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true"></a>    <span class="kw">let</span> todayNum <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>((now <span class="op">-</span> dayZero)<span class="op">/</span>(<span class="dv">24</span><span class="op">*</span><span class="dv">3600</span><span class="op">*</span><span class="dv">1000</span>) <span class="op">+</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true"></a>    <span class="co">//////////////////////////////////////////////////</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true"></a>    <span class="co">// Initialise the Text Art &quot;canvas&quot;.</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true"></a>    <span class="co">//////////////////////////////////////////////////</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true"></a>    <span class="fu">stopAllLiveAnimations</span>()<span class="op">;</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true"></a>    <span class="fu">paintEmptyCanvas</span>()<span class="op">;</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true"></a></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true"></a>    <span class="co">// Parts of the Menorah to always show</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true"></a>    <span class="kw">let</span> allMenorahChars <span class="op">=</span> <span class="fu">getDdwChars</span>(menorahDDW)<span class="op">;</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true"></a>    <span class="kw">let</span> selectedMenorahChars <span class="op">=</span> allMenorahChars<span class="op">.</span><span class="fu">filter</span>((char) <span class="kw">=&gt;</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true"></a>        (char<span class="op">.</span><span class="at">tags</span><span class="op">.</span><span class="at">length</span> <span class="op">==</span> <span class="dv">0</span> <span class="op">||</span> char<span class="op">.</span><span class="at">tags</span><span class="op">.</span><span class="fu">includes</span>(<span class="st">&quot;day0&quot;</span>) <span class="op">||</span> char<span class="op">.</span><span class="at">tags</span><span class="op">.</span><span class="fu">includes</span>(<span class="st">&quot;menorah&quot;</span>)) <span class="op">&amp;&amp;</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true"></a>            (<span class="op">!</span>char<span class="op">.</span><span class="at">frame</span> <span class="op">||</span> char<span class="op">.</span><span class="at">frame</span> <span class="op">==</span> <span class="st">&quot;off&quot;</span>))<span class="op">;</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true"></a>    <span class="kw">let</span> setOfFlames <span class="op">=</span> <span class="kw">new</span> <span class="bu">Set</span>()<span class="op">;</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true"></a>    <span class="kw">let</span> selectedTapestryChars <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true"></a></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true"></a>    <span class="co">// Gather data to paint based on day and answers</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true"></a>    <span class="cf">for</span> (<span class="kw">let</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">9</span><span class="op">;</span> <span class="op">++</span>i) {</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true"></a>        <span class="co">// Flames to light up for any answered puzzle</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true"></a>        <span class="cf">if</span> (<span class="fu">isLit</span>(i)) {</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true"></a>            setOfFlames<span class="op">.</span><span class="fu">add</span>(i)<span class="op">;</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true"></a>        }</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true"></a>        <span class="kw">let</span> toggleState <span class="op">=</span> <span class="fu">isLit</span>(i) <span class="op">?</span> <span class="st">&quot;on&quot;</span> <span class="op">:</span> <span class="st">&quot;off&quot;</span><span class="op">;</span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true"></a>        <span class="kw">let</span> dayTag <span class="op">=</span> <span class="vs">`day</span><span class="sc">${</span>i<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true"></a></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true"></a>        <span class="co">// Candle data for &quot;today&quot; OR for any already-answered puzzle</span></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true"></a>        <span class="cf">if</span> (<span class="fu">canBeLit</span>(i) <span class="op">||</span> <span class="fu">isLit</span>(i)) {</span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true"></a>            selectedMenorahChars <span class="op">=</span> selectedMenorahChars<span class="op">.</span><span class="fu">concat</span>(</span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true"></a>                allMenorahChars<span class="op">.</span><span class="fu">filter</span>((char) <span class="kw">=&gt;</span> {</span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true"></a>                    <span class="cf">return</span> char<span class="op">.</span><span class="at">tags</span><span class="op">.</span><span class="fu">includes</span>(dayTag) <span class="op">&amp;&amp;</span> (<span class="op">!</span>char<span class="op">.</span><span class="at">frame</span> <span class="op">||</span> char<span class="op">.</span><span class="at">frame</span> <span class="op">==</span> toggleState)<span class="op">;</span></span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true"></a>                })</span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true"></a>            )<span class="op">;</span></span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true"></a>        }</span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true"></a></span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true"></a>        <span class="co">// &quot;Revealed&quot; Tapestry data for any answered puzzle</span></span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true"></a>        selectedTapestryChars <span class="op">=</span> selectedTapestryChars</span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true"></a>            <span class="op">.</span><span class="fu">concat</span>(allTapestryChars<span class="op">.</span><span class="fu">filter</span>((char) <span class="kw">=&gt;</span></span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true"></a>                char<span class="op">.</span><span class="at">frame</span> <span class="op">==</span> toggleState <span class="op">&amp;&amp;</span> char<span class="op">.</span><span class="at">tags</span><span class="op">.</span><span class="fu">includes</span>(dayTag)))<span class="op">;</span></span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true"></a>    }</span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true"></a></span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true"></a>    <span class="co">//////////////////////////////////////////////////</span></span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true"></a>    <span class="co">// Paint the art</span></span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true"></a>    <span class="co">//////////////////////////////////////////////////</span></span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true"></a>    <span class="fu">paintTextArtPiece</span>(selectedTapestryChars)<span class="op">;</span></span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true"></a>    <span class="fu">paintTextArtPiece</span>(selectedMenorahChars<span class="op">,</span> <span class="dv">19</span><span class="op">,</span> <span class="dv">30</span>)<span class="op">;</span> <span class="co">// offset by x=19, y=30 w.r.t. origin</span></span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true"></a>    <span class="co">// Light flames</span></span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true"></a>    <span class="cf">for</span> (<span class="kw">const</span> flameNum <span class="kw">of</span> setOfFlames) {</span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true"></a>        <span class="fu">animateFlame</span>(flameNum)<span class="op">;</span></span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true"></a>    }</span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true"></a>    <span class="co">// Twitch Animals</span></span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true"></a>    [<span class="kw">null</span><span class="op">,</span> <span class="co">// candle 0, no animal for Shamash</span></span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true"></a>     beehiveDdwChars<span class="op">,</span> <span class="co">// candle 1</span></span>
<span id="cb7-58"><a href="#cb7-58" aria-hidden="true"></a>     snailDdwChars<span class="op">,</span> <span class="co">// candle 2</span></span>
<span id="cb7-59"><a href="#cb7-59" aria-hidden="true"></a>     spiderDdwChars<span class="op">,</span> <span class="co">// candle 3</span></span>
<span id="cb7-60"><a href="#cb7-60" aria-hidden="true"></a>     hornedOwlDdwChars<span class="op">,</span> <span class="co">// candle 4</span></span>
<span id="cb7-61"><a href="#cb7-61" aria-hidden="true"></a>     koalaDdwChars<span class="op">,</span> <span class="co">// candle 5</span></span>
<span id="cb7-62"><a href="#cb7-62" aria-hidden="true"></a>     squirrelDdwChars<span class="op">,</span> <span class="co">// candle 6</span></span>
<span id="cb7-63"><a href="#cb7-63" aria-hidden="true"></a>     toucanDdwChars<span class="op">,</span> <span class="co">// candle 7</span></span>
<span id="cb7-64"><a href="#cb7-64" aria-hidden="true"></a>     snakeDdwChars <span class="co">// candle 8</span></span>
<span id="cb7-65"><a href="#cb7-65" aria-hidden="true"></a>    ]<span class="op">.</span><span class="fu">forEach</span>((animalDdwChars<span class="op">,</span> candleNum) <span class="kw">=&gt;</span> {</span>
<span id="cb7-66"><a href="#cb7-66" aria-hidden="true"></a>        <span class="cf">if</span> (animalDdwChars <span class="op">&amp;&amp;</span> <span class="fu">isLit</span>(candleNum)) {</span>
<span id="cb7-67"><a href="#cb7-67" aria-hidden="true"></a>            <span class="fu">twitchAnimal</span>(</span>
<span id="cb7-68"><a href="#cb7-68" aria-hidden="true"></a>                animalDdwChars<span class="op">.</span><span class="fu">filter</span>((char) <span class="kw">=&gt;</span> char<span class="op">.</span><span class="at">frame</span> <span class="op">==</span> <span class="st">&quot;on&quot;</span>)<span class="op">,</span></span>
<span id="cb7-69"><a href="#cb7-69" aria-hidden="true"></a>                animalDdwChars<span class="op">.</span><span class="fu">filter</span>((char) <span class="kw">=&gt;</span> char<span class="op">.</span><span class="at">frame</span> <span class="op">==</span> <span class="st">&quot;on2&quot;</span>)</span>
<span id="cb7-70"><a href="#cb7-70" aria-hidden="true"></a>            )<span class="op">;</span></span>
<span id="cb7-71"><a href="#cb7-71" aria-hidden="true"></a>        }</span>
<span id="cb7-72"><a href="#cb7-72" aria-hidden="true"></a>    })<span class="op">;</span></span>
<span id="cb7-73"><a href="#cb7-73" aria-hidden="true"></a>}<span class="op">;</span></span></code></pre></div>
</code></details>
<p>So, an empty "cell" like this <code>&lt;span data-x="30" data-y="42"&gt;&lt;/span&gt;</code> may get DarkDraw character information like this <code>&lt;span data-x="30" data-y="42" class=" fg255 bold" data-frame="off"&gt;)&lt;/span&gt;</code>. Where the source DarkDraw character data itself would look like this: <code>{"x": 30, "y": 42, "text": ")", "color": "225 bold", "tags": [], "group": "", "frame": ""}</code>.</p>
<p>Like this:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true"></a><span class="kw">function</span> <span class="fu">paintTextArtPiece</span>(</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true"></a>    ddwCharArray<span class="op">,</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true"></a>    xCanvasOffset <span class="op">=</span> <span class="dv">0</span><span class="op">,</span> yCanvasOffset <span class="op">=</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true"></a>    canvasContext <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">&quot;art&quot;</span>)) {</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true"></a>    <span class="cf">for</span> (<span class="kw">const</span> char <span class="kw">of</span> ddwCharArray) {</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true"></a>        el <span class="op">=</span> canvasContext<span class="op">.</span><span class="fu">querySelector</span>(</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true"></a>            <span class="vs">`</span><span class="sc">${</span>EL_CELL<span class="sc">}</span><span class="vs">[data-y=&#39;</span><span class="sc">${</span>char<span class="op">.</span><span class="at">y</span> <span class="op">+</span> yCanvasOffset<span class="sc">}</span><span class="vs">&#39;][data-x=&#39;</span><span class="sc">${</span>char<span class="op">.</span><span class="at">x</span> <span class="op">+</span> xCanvasOffset<span class="sc">}</span><span class="vs">&#39;]`</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true"></a>        )<span class="op">;</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true"></a>        <span class="cf">if</span>(el) {</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true"></a>            el<span class="op">.</span><span class="at">className</span> <span class="op">=</span> <span class="fu">getCssForDdwColorStr</span>(char<span class="op">.</span><span class="at">color</span>)<span class="op">;</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true"></a>            el<span class="op">.</span><span class="at">dataset</span><span class="op">.</span><span class="at">frame</span> <span class="op">=</span> char<span class="op">.</span><span class="at">frame</span><span class="op">?</span> char<span class="op">.</span><span class="at">frame</span> <span class="op">:</span> <span class="st">&quot;&quot;</span><span class="op">;</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true"></a>            el<span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> char<span class="op">.</span><span class="at">href</span><span class="op">?</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true"></a>                <span class="vs">`&lt;a href=&quot;</span><span class="sc">${</span>char<span class="op">.</span><span class="at">href</span><span class="sc">}</span><span class="vs">&quot; style=&quot;color:#FFFFFF; font-weight: bold;&quot;&gt;</span><span class="sc">${</span>char<span class="op">.</span><span class="at">text</span><span class="sc">}</span><span class="vs">&lt;/a&gt;`</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true"></a>                <span class="op">:</span> <span class="vs">`</span><span class="sc">${</span>char<span class="op">.</span><span class="at">text</span><span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true"></a>        }</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true"></a>    }</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true"></a>}</span></code></pre></div>
<h2 id="what-transpired-in-between-learning-to-see">What transpired in-between: Learning to "see"</h2>
<p>Picture a reticent server-inhabiter bobbing about in a primordial DOM-soup, waiting for the stars to rise.</p>
<p>There is a knowing how to swim versus a knowing how to swim in the open sea. The raw skills are similar, but oceans are so very different from familiar swimming pools, that one has to learn a whole other way of sensing, observing, thinking, and operating. That is how it goes, in unfamiliar territory.</p>
<p>The slow star-dawn was the very process of relocating the "spreadsheet" from being in-memory (a 2D Matrix), to being an in-DOM grid of live elements. That in turn meant identifying the various parts at my disposal, and working out how to organise the solution using the pieces, viz.</p>
<ul>
<li><p>design of raw data; its shape and structure,</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true"></a><span class="fu">{</span><span class="dt">&quot;x&quot;</span><span class="fu">:</span> <span class="dv">76</span><span class="fu">,</span> <span class="dt">&quot;y&quot;</span><span class="fu">:</span> <span class="dv">5</span><span class="fu">,</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true"></a> <span class="dt">&quot;text&quot;</span><span class="fu">:</span> <span class="st">&quot;</span><span class="ch">\u0194</span><span class="st">&quot;</span><span class="fu">,</span> <span class="dt">&quot;color&quot;</span><span class="fu">:</span> <span class="st">&quot;88&quot;</span><span class="fu">,</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true"></a> <span class="dt">&quot;tags&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="st">&quot;wick&quot;</span><span class="ot">,</span> <span class="st">&quot;day1&quot;</span><span class="ot">]</span><span class="fu">,</span> <span class="dt">&quot;group&quot;</span><span class="fu">:</span> <span class="st">&quot;&quot;</span><span class="fu">,</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true"></a> <span class="dt">&quot;frame&quot;</span><span class="fu">:</span> <span class="st">&quot;on&quot;</span><span class="fu">,</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true"></a> <span class="dt">&quot;href&quot;</span><span class="fu">:</span> <span class="st">&quot;1&quot;</span><span class="fu">}</span></span></code></pre></div></li>
<li><p>data transformation operations (filtering, enriching, reshaping)</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true"></a><span class="kw">const</span> flameAnimationSequence <span class="op">=</span> <span class="fu">getDdwFrames</span>(flameDDW)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true"></a>      <span class="op">.</span><span class="fu">sort</span>((fa<span class="op">,</span> fb) <span class="kw">=&gt;</span> fb<span class="op">.</span><span class="at">id</span> <span class="op">&gt;</span> fa<span class="op">.</span><span class="at">id</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true"></a>      <span class="op">.</span><span class="fu">map</span>((frame) <span class="kw">=&gt;</span> flameAnimationCharacters</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true"></a>           <span class="op">.</span><span class="fu">filter</span>((char) <span class="kw">=&gt;</span> char<span class="op">.</span><span class="at">frame</span> <span class="op">==</span> <span class="vs">`</span><span class="sc">${</span>frame<span class="op">.</span><span class="at">id</span><span class="sc">}</span><span class="vs">`</span>))</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true"></a>      <span class="op">.</span><span class="fu">map</span>((flameChars) <span class="kw">=&gt;</span> <span class="fu">frameInsideMask</span>(flameChars<span class="op">,</span> <span class="dv">3</span><span class="op">,</span> <span class="dv">3</span>))<span class="op">;</span></span></code></pre></div></li>
<li><p>domain abstractions (canvas, text art pieces, painter, animator)</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true"></a><span class="kw">function</span> <span class="fu">paintEmptyCanvas</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true"></a>    canvasContext <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">&quot;art&quot;</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true"></a>) {<span class="op">...</span>}<span class="op">;</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true"></a><span class="kw">function</span> <span class="fu">paintTextArtPiece</span>(</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true"></a>    ddwCharArray<span class="op">,</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true"></a>    xCanvasOffset <span class="op">=</span> <span class="dv">0</span><span class="op">,</span> yCanvasOffset <span class="op">=</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true"></a>    canvasContext <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">&quot;art&quot;</span>)</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true"></a>) {<span class="op">...</span>}<span class="op">;</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true"></a></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true"></a><span class="kw">function</span> <span class="fu">paintFlame</span>(</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true"></a>    dayIndex <span class="op">=</span> <span class="dv">0</span><span class="op">,</span> frameCounter <span class="op">=</span> <span class="kw">new</span> <span class="fu">FrameCounter</span>(<span class="dv">41</span>)</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true"></a>) {<span class="op">...</span>}<span class="op">;</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true"></a></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true"></a><span class="kw">function</span> <span class="fu">animateFlame</span>(dayIndex <span class="op">=</span> <span class="dv">0</span>) {</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true"></a>    <span class="kw">let</span> animationID <span class="op">=</span> <span class="pp">setInterval</span>(paintFlame<span class="op">,</span> <span class="dv">100</span><span class="op">,</span> dayIndex<span class="op">,</span> <span class="kw">new</span> <span class="fu">FrameCounter</span>(<span class="dv">41</span>))<span class="op">;</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true"></a>    LIVE_ANIMATIONS_IDS_SET<span class="op">.</span><span class="fu">add</span>(animationID)<span class="op">;</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true"></a>}<span class="op">;</span></span></code></pre></div></li>
<li><p>HTML/CSS construction (e.g. make a canvas of rows and colums, with data attributes set)</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true"></a><span class="kw">&lt;span</span><span class="ot"> data-x=</span><span class="st">&quot;30&quot;</span><span class="ot"> data-y=</span><span class="st">&quot;42&quot;</span><span class="ot"> class=</span><span class="st">&quot;fg255 bold&quot;</span><span class="ot"> data-frame=</span><span class="st">&quot;off&quot;</span><span class="kw">&gt;</span>)<span class="kw">&lt;/span&gt;</span></span></code></pre></div></li>
<li><p>actual DOM manipulations (e.g. select/update element by data attributes)</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true"></a>canvasContext<span class="op">.</span><span class="fu">querySelector</span>(</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true"></a>    <span class="vs">`</span><span class="sc">${</span>EL_CELL<span class="sc">}</span><span class="vs">[data-y=&#39;</span><span class="sc">${</span>char<span class="op">.</span><span class="at">y</span> <span class="op">+</span> yCanvasOffset<span class="sc">}</span><span class="vs">&#39;][data-x=&#39;</span><span class="sc">${</span>char<span class="op">.</span><span class="at">x</span> <span class="op">+</span> xCanvasOffset<span class="sc">}</span><span class="vs">&#39;]`</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true"></a>)<span class="op">;</span></span></code></pre></div></li>
</ul>
<p>And so forth…</p>
<p>Ultimately, I suppose I retained the general data munging needed to <em>prepare</em> source data for writes into the DOM, and dropped the sort-of DarkDraw-to-HTML "compiler" piece from the solution. That piece was causing avoidable data munging work <em>and</em> was tempting me into over-abstracting code.</p>
<p>The revised approach also resulted in code that is true to the <em>aesthetic</em> feel of Text Art animation, which was the real win.</p>
<h1 id="details-details-details">Details details details</h1>
<h2 id="the-aesthetic-of-text-art-and-its-animation">The aesthetic of Text Art and its Animation</h2>
<p><em>Characters are material</em>; where a character is a glyph along with its associated information, including styles (256 bit colour palette), x/y grid position, order of appearance (frame number), tags, grouping etc.</p>
<p><em>Animation is discrete</em>, not smooth; effected by replacing characters with characters.</p>
<p><em>Painting is <strong>not</strong> an emulation of the artist's intent</em>, but a faithful reproduction of their hand, regardless of medium.</p>
<p>Our mechanical text artist was code in the web browser medium. But one can imagine implementing text artistry with stop-motion photography, or printed flip-books, or kaleidoscopes, or this wicked cool <a href="https://tangible.media.mit.edu/project/inform/.">Dynamic Shape Display</a> at MIT Media Lab.</p>
<p>Hark back to my note on thinking in terms of <em>dynamic</em> media.</p>
<h2 id="structuring-darkdraw-source-data">Structuring DarkDraw source data</h2>
<p>If the data sucks, the code will suck. Now there's a maxim for you.</p>
<p>I try to structure, fix, and enrich source data as much as humanly possible. If the data is well-formed and models the problem domain well, the solution domain (i.e. the code / system design) almost writes itself.</p>
<p>And when the resident artist quips thusly, it's pure gold.</p>
<blockquote>
<p>"that's what's so fun about dd<br />
it's all just data :)"</p>
<p>— dwimmer</p>
<p>(<em>dd</em> = DarkDraw)</p>
</blockquote>
<p>So, these became goals for the code:</p>
<ul>
<li>Construct a spreadsheet with x/y coordinates</li>
<li>Place characters precisely into the appropriate coordinates</li>
<li>Animate characters based on what they represent (flame, animal, etc.)</li>
</ul>
<p>Over a handful of iterations of data modeling, our data representation came to have two types of records, as follows:</p>
<ul>
<li><p><strong>"Frame" records</strong> that contain information about a single frame.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true"></a><span class="fu">{</span><span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="st">&quot;off&quot;</span><span class="fu">,</span> <span class="dt">&quot;type&quot;</span><span class="fu">:</span> <span class="st">&quot;frame&quot;</span><span class="fu">,</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true"></a> <span class="dt">&quot;text&quot;</span><span class="fu">:</span> <span class="st">&quot;&quot;</span><span class="fu">,</span> <span class="dt">&quot;color&quot;</span><span class="fu">:</span> <span class="st">&quot;&quot;</span><span class="fu">,</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true"></a> <span class="dt">&quot;tags&quot;</span><span class="fu">:</span> <span class="ot">[]</span><span class="fu">,</span> <span class="dt">&quot;group&quot;</span><span class="fu">:</span> <span class="st">&quot;&quot;</span><span class="fu">,</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true"></a> <span class="dt">&quot;duration_ms&quot;</span><span class="fu">:</span> <span class="dv">100</span><span class="fu">}</span></span></code></pre></div>
<p>These come bundled in a <code>ddw</code> data file. VisiData uses these to render DarkDraw text art animations. Our game requires only two kinds of animations: flames that cycle over 42 frames, and animals that blink (on/off frames). So I just wrote special functions for each kind of frame-handling. A general frame-aware animator is TBD. Maybe next year :)</p></li>
<li><p><strong>"Character" records</strong>, which we tagged semantically. Is it for a squirrel? A wick? The menorah? Which day of game play to associate it with?</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true"></a><span class="fu">{</span><span class="dt">&quot;x&quot;</span><span class="fu">:</span> <span class="dv">76</span><span class="fu">,</span> <span class="dt">&quot;y&quot;</span><span class="fu">:</span> <span class="dv">5</span><span class="fu">,</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true"></a> <span class="dt">&quot;text&quot;</span><span class="fu">:</span> <span class="st">&quot;</span><span class="ch">\u0194</span><span class="st">&quot;</span><span class="fu">,</span> <span class="dt">&quot;color&quot;</span><span class="fu">:</span> <span class="st">&quot;88&quot;</span><span class="fu">,</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true"></a> <span class="dt">&quot;tags&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="st">&quot;wick&quot;</span><span class="ot">,</span> <span class="st">&quot;day1&quot;</span><span class="ot">]</span><span class="fu">,</span> <span class="dt">&quot;group&quot;</span><span class="fu">:</span> <span class="st">&quot;&quot;</span><span class="fu">,</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true"></a> <span class="dt">&quot;frame&quot;</span><span class="fu">:</span> <span class="st">&quot;on&quot;</span><span class="fu">,</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true"></a> <span class="dt">&quot;href&quot;</span><span class="fu">:</span> <span class="st">&quot;1&quot;</span><span class="fu">}</span></span></code></pre></div>
<p>Given this, our Javascript can interpret each character record to decide whether to place it in the DOM (Is it the right day? What is the frame state?). Then, to place it, we locate a cell for the x/y coordinates, punch in the text, add appropriate CSS class for the color value, and link the cell if an href is specified.</p></li>
</ul>
<h2 id="choice-of-javascript">Choice of Javascript</h2>
<p>It's just Javascript.</p>
<p>The good parts.</p>
<p>That's all.</p>
<h2 id="choice-of-animation-method">Choice of animation method</h2>
<p>Even "just" Javascript provides us several options: <code>setInterval</code>, <code>setTimeout</code>, <code>Element.animate</code>, <code>Window.requestAnimationFrame</code>, to name a few <a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a>. CSS adds more to the mix. <em>However</em>, Text Art Animation aesthetic asks us to work with <em>characters as material</em>, so CSS animation methods are out from the outset.</p>
<h3 id="window.requestanimationframe-had-me-on-the-fence"><code>Window.requestAnimationFrame</code> had me on the fence</h3>
<p>It is supposed to be CPU friendly because it works <a href="https://developer.mozilla.org/en-US/docs/Web/API/window/requestAnimationFrame">with the browser's render cycle</a> <a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a>, and I have a feeling one can do a proper job of animation with it—unlike <code>Element.animate</code> discussed below. However, <code>setInterval</code> and <code>setTimeout</code> worked well enough that I didn't feel compelled to experiment more. A game had to ship, after all.</p>
<h3 id="element.animate-is-neato-but-it-cannot-modify-elements"><code>Element.animate</code> is neato, but it cannot modify elements</h3>
<p>Also it requires us to model discrete animation in terms of carefully-chosen keyframe effects. These traits combined imply we might <em>emulate</em> the artist's intent, at best. Thus it does not suit our purpose.</p>
<div class="box invert">
<em>This "loading" effect demo with <code>Element.animate()</code> is <b>not</b> text art animation.</em>
<div id="loading-demo"></div>
</div>
<script type="text/javascript">demoLoading();</script>
<p><em>An unrelated but important detail</em>, because of the unwelcome hair-loss it has caused me… <code>Element.animate</code> does not work <em>visually</em> for inline elements like <code>&lt;span&gt;</code> <em>unless</em> they receive block properties via CSS, viz. <code>display: inline-block;</code>.</p>
<p>Like if we <code>document.getElementById(theID).animate({...})</code> an inline element (no block properties), then <code>document.getElementById(theID).getAnimations()</code> shows that an animation is indeed running. <em>However</em> nothing is visible in-browser.</p>
<p>So my guess is, unadulterated inline elements seem to behave like point objects as far as animate is concerned. This little detail seems to be conspicuously absent from MDN and StackOverflow combined. Unless I've misunderstood everything, of course.</p>
<p>This took <strong>way</strong> longer to debug than I'm able to admit in polite company.</p>
<h3 id="setinterval-and-settimeout-worked-just-right"><code>setInterval</code> and <code>setTimeout</code> worked just right</h3>
<p>These let us call functions that do exactly the thing we want, viz. punch <em><a href="#the-aesthetic-of-text-art-and-its-animation">characters</a></em> into our "live spreadsheet" medium, exactly the way the artist placed them in the original art source. These methods can make a CPU sing, but hey, the awesome art is worth every watt it, ah, draws.</p>
<div class="box invert">
<em>Random twitch loop <code>setTimeout</code> and recursion.</em>
<div id="blink-demo"></div>
</div>
<script type="text/javascript">demoBlink();</script>
<div class="box invert">
<em>Flipbook-like frame-by-frame animation loop with <code>setInterval</code>.</em>
<div id="glider-demo"></div>
</div>
<script type="text/javascript">demoGlider();</script>
<h2 id="composition-and-painting">Composition and Painting</h2>
<p>Graphics artists will find this section wholly unsurprising. Our Text Art is a composite of parts. These include:</p>
<ul>
<li>static parts like the base of the menorah, parts of the tapestry</li>
<li>animated parts such as flames and twitchy animals</li>
<li>"revealed" parts that could be static and/or animated</li>
</ul>
<p>We can think of each part as an abstract sheet. Sheets of art are over-painted on a shared blank rectangular canvas of pre-set size. A sheet may be as small as one character, or as large as the whole canvas, and may be of any shape in-between.</p>
<p>All art is painted with respect to the same x/y origin, where the coordinates follow display screen layout:</p>
<ul>
<li>x = columns of a sheet of text art</li>
<li>y = rows of a sheet of text art</li>
<li>0/0 origin begins at the <em>top-left</em> corner</li>
</ul>
<p>For animated text art, sheets are associated with animation frames. We view this as a stack of text art sheets, one sheet per frame. Since it's all 2D space, we are sort of "looking from above" and can't see the depth of the stack. Frames are irrelevant for static text art; there is just one sheet.</p>
<p>Mechanically, our animation is quite like flipping a flipbook. A subtle detail is that animation art should explicitly paint blanks where it does not want to show characters. If source data contains explicit blanks, our code can blindly punch characters into the DOM. Otherwise, our code has to calculate empty cells, which creates needless complexity (for me it was that first version that I trashed).</p>
<h1 id="conclusion">Conclusion</h1>
<p>Animating text art in the browser is a lot of fun… have at it! Draw with <a href="https://github.com/devottys/darkdraw">DarkDraw</a>. Export as JSON. Drop some <em>Vanilla ice ice baby</em> Javascript. Profit?</p>
<h1 id="copyright-notice">Copyright notice</h1>
<p>All <em>Hanukkah of Data</em> text art featured in this piece, in any form (e.g. screenshots, source data, rendered samples) are copyright <a href="https://www.instagram.com/dwimmertxt/">dwimmer</a>. Reproduced with permission. If you like the art (and why wouldn't you?), give him a shout out. Better still, commission him to make rad stuff for you!</p>
<h1 id="acknowledgments">Acknowledgments</h1>
<p>Cheers to all the <a href="https://bluebird.sh">devottys</a> for a super fun time making Hanukkah of Data. It was my first time working with an artist to render their work, and I'm glad it was someone like dwimmer. A joy! Thanks to <a href="https://www.saul.pw/">Saul</a>, <a href="https://anja.kefala.info/">Anja</a>, <a href="https://www.radhikamurthy.com/">Radhika</a> for reviews and remarks on this post.</p>
<h1 id="footnotes">Footnotes</h1>
<section class="footnotes" role="doc-endnotes">
<hr />
<ol>
<li id="fn1" role="doc-endnote"><p>AoC is <a href="https://adventofcode.com/">Advent of Code</a>. AoC-like is like Rogue-like. Did I just coin a name for a genre of programmer-y puzzles for programmer nerds by programmer nerds?<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2" role="doc-endnote"><p>Later <a href="https://www.visidata.org/blog/2022/hanukkah-of-data/">announced at the VisiData blog</a> as: <em>If you like the concept of Advent of Code, but wish there was set of data puzzles for data nerds, well, this year you're in luck!</em><a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3" role="doc-endnote"><p>Suppose you were I.</p>
<p>You are clueless about puzzles. In fact, you are clueless about the whole enterprise of game-making for that matter.</p>
<p>But! Suppose you ended up on a call with Saul. And suppose he says there <em>might</em> be an inebriated aunt in the wind who aided by a deliciously smoky and peaty Kentucky Bourbon (or few) has navigated her way to an inscrutable location, instead of the warm home in NYC where she is anxiously awaited owing to the <em>Very Important Ingredients</em> she was supposed to have driven over from her family store in DC… or something. And that the working title of the game is <em>"Hanukkah of Data"</em>.</p>
<p>What would you do?</p>
<p>Sign up, of course. Whimsy? Hilarity? A fun project of, by, for gentlenerds? <em>Just because</em>? Slam dunk sale!<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4" role="doc-endnote"><p>The art reveals progressively, as one solves each data puzzle. If you just want to see the art, a cheat is available. In the browser console: <code>atob("c29sdmVQdXp6bGVzKCk=")</code> -&gt; call the function -&gt; refresh browser.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5" role="doc-endnote"><p>Recently I saw <a href="https://gyanl.com/cutie/">this animation experiment</a> that does things with event listeners. e.g. invoke callbacks to update the <code>transform</code> attribute of the target element.<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn6" role="doc-endnote"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/window/requestAnimationFrame">MDN docs on Window.requestAnimationFrame()</a></p>
<blockquote>
<p>You should call this method whenever you're ready to update your animation onscreen. This will request that your animation function be called before the browser performs the next repaint. The number of callbacks is usually 60 times per second, but will generally match the display refresh rate in most web browsers as per W3C recommendation. requestAnimationFrame() calls are paused in most browsers when running in background tabs or hidden &lt;iframe&gt;s in order to improve performance and battery life.</p>
</blockquote>
<a href="#fnref6" class="footnote-back" role="doc-backlink">↩︎</a></li>
</ol>
</section>
  </section>
  <footer id="blog-post-footer" class="footer">
    <nav class="cluster">
      <span>&uarr; <a href="#blog-post" rel="bookmark">title</a></span>
      <span>&uarr; <a href="#site-header" rel="bookmark">menu</a></span>
      <span>&rarr; <a href="mailto:weblog@evalapply.org">email comments</a></span>
    </nav>
  </footer>
</article>
        </main>
        <footer id="site-footer">
<hr>
<div class="box invert footer stack">
  <div class="cluster">
    <span>&#128231; : <a href="mailto:hello@evalapply.org">hello@evalapply.org</a></span>
    <a class="site-feed"
       href="https://www.evalapply.org/index.xml">
       Blog feed
    </a>
    <form class="cluster"
          action="https://buttondown.email/api/emails/embed-subscribe/evalapply"
          method="post" target="popupwindow"
          onsubmit="window.open('https://buttondown.email/evalapply','popupwindow')">
        <input type="email" name="email" id="bd-email">
      <span>
        <input type="submit" value="Get occasional newsletter">
        <em>(thanks, <a href="https://buttondown.email" target="_blank">Buttondown</a>!)</em>
      </span>
    </form>
  </div>
  <hr>
  <p>&copy; copyright 2023, <a href="https://evalapply.org" target="_blank">Aditya Athalye</a>.
    <span>Except where otherwise noted, content on this site is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">
    Creative Commons Attribution-ShareAlike 4.0 International License
    </a>, the same one used by Wikipedia.</span>
<span><a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">
    <img alt="Creative Commons License" style="border-width:0"
         src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png">
    </a></span>
  </p>
  <hr>
  <p> Made with
      <a href="https://www.gnu.org/software/emacs/">GNU Emacs</a>,
      <a href="https://orgmode.org/">org-mode</a>, and
      <a href="https://github.com/adityaathalye/shite">shite</a>.
  </p>
  <p id="recurse-scout">
  <script async defer src="https://www.recurse-scout.com/loader.js?t=40533398b8c93bb4f3323a170e032e91"></script>
  </p>
</div>
</footer>
    </div>
    <!-- Cloudflare Web Analytics -->
    <script defer src='https://static.cloudflareinsights.com/beacon.min.js'
            data-cf-beacon='{"token": "2a55df7e78f941c29a35207cedd0f66c"}'>
    </script>
    <!-- End Cloudflare Web Analytics -->
  </body>
</html>
