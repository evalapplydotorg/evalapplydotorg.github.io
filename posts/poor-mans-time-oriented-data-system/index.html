<!DOCTYPE html>
<html lang="en" prefix="og: https://ogp.me/ns#">
  <head>
    <!-- Some basic hygiene meta-data -->
<title>Poor man&apos;s bitemporal data system in SQLite and Clojure</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="author" content="Aditya Athalye">
<meta name="description"
      content="On trying to mash up SQLite with ideas stolen from Accountants, Clojure, Datomic, XTDB, Rama, and Local-first-ers, to satisfy Henderson&apos;s Tenth Law. Viz., to make a sufficiently complicated data system containing an ad-hoc, informally-specified, bug-ridden, slow implementation of half of a bitemporal database. Because? Because laying about on a hammock, contemplating hopelessly complected objects like Current Databases isn&apos;t just for the Rich man.">
<meta name="keywords" content="systems thinking,functional programming,architecture,software design,technology leadership,devops,clojure,B2B Micro SaaS">
<meta property="og:title" content="Poor man&apos;s bitemporal data system in SQLite and Clojure">
<meta property="og:description" content="On trying to mash up SQLite with ideas stolen from Accountants, Clojure, Datomic, XTDB, Rama, and Local-first-ers, to satisfy Henderson&apos;s Tenth Law. Viz., to make a sufficiently complicated data system containing an ad-hoc, informally-specified, bug-ridden, slow implementation of half of a bitemporal database. Because? Because laying about on a hammock, contemplating hopelessly complected objects like Current Databases isn&apos;t just for the Rich man.">
<meta property="og:locale" content="en_GB">
<meta property="og:type" content="website">
<meta property="og:url" content="https://www.evalapply.org/posts/poor-mans-time-oriented-data-system/index.html">
    <!-- Preload logo as it is on all pages -->
<link rel="preload" href="https://www.evalapply.org/static/img/Lisp_logo.svg" as="image" type="image/svg+xml" />
<!-- Preload font files and font styles, before layout styles to reduce layout shift -->
<link rel="preload" href="https://www.evalapply.org/static/fonts/google/firacode/v22/uU9eCBsR6Z2vfE9aq3bL0fxyUs4tcw4W_D1sJVD7Ng.woff2" as="font" type="font/woff2"
      crossorigin>
<link rel="preload" href="https://www.evalapply.org/static/fonts/google/gentiumbookplus/v1/vEFN2-RHBgUK5fbjKxRpbBtJPyRpocKdT7HmqQ.woff2" as="font" type="font/woff2"
      crossorigin>
<link rel="preload" href="https://www.evalapply.org/static/fonts/google/gentiumbookplus/v1/vEFL2-RHBgUK5fbjKxRpbBtJPyRpocKYf7M.woff2" as="font" type="font/woff2"
      crossorigin>
<link rel="preload" href="https://www.evalapply.org/static/fonts/google/ptsansnarrow/v18/BngRUXNadjH0qYEzV7ab-oWlsbCGwR0.woff2" as="font" type="font/woff2"
      crossorigin>
<link rel="stylesheet preload" type="text/css" as="style" href="https://www.evalapply.org/static/css/fonts.css">
<link rel="stylesheet preload" type="text/css" as="style" href="https://www.evalapply.org/static/css/style.css">
<link href="https://www.evalapply.org/index.xml"
      rel="alternate" type="application/rss+xml"
      title="Aditya Athalye writes and works here.">
<link rel="canonical" href="https://www.evalapply.org/posts/poor-mans-time-oriented-data-system/index.html">
<link rel="icon" type="image/vnd.microsoft.icon" href="https://www.evalapply.org/static/img/favicon.ico">
    <base target="_blank">
</head>
  <body>
    <div id="the-very-top" class="stack center box">
        <header id="site-header">
  <div class="box invert stack">
    <div class="with-sidebar site-header">
      <a class="box icon" href="https://www.evalapply.org/index.html" target="_self">
        <img src="https://www.evalapply.org/static/img/Lisp_logo.svg" alt="Aditya Athalye writes and works here." width="60" height="60">
      </a>
      <div class="stack">
        <h1 class="site-header title">Aditya Athalye writes and works here.</h1>
        
        <nav class="cluster site-header site-header:nav-items">
          <a href="https://www.linkedin.com/posts/adityaathalye_seeking-work-remote-ok-with-activity-7357385373867528194-bpiV" target="_blank">
  $ hire
</a>
|
<a href="https://www.evalapply.org/posts/index.html" target="_self">
  &#9753; read
</a>
<a href="https://news.ycombinator.com/from?site=evalapply.org" target="_blank">
  HN
</a>
<a href="https://lobste.rs/domains/evalapply.org" target="_blank">
  L
</a>
<a href="https://www.youtube.com/@evalapplydotorg/playlists" target="_blank" target="_self">
  YT
</a>
|
<a href="https://www.evalapply.org/about.html#standing-invitation" target="_self">
  &#x2709; mail
</a>
<a href="https://www.linkedin.com/in/adityaathalye" target="_blank">
 in
</a>
|
<a href="https://www.evalapply.org/about.html" target="_self">
  &lambda; self
</a>
<a href="https://www.evalapply.org/now.html#main" target="_self">
  &raquo; now
</a>
<a href="https://www.evalapply.org/index.xml" target="_blank">
  &asymp; feed
</a>
        </nav>
        <p class="footnotes">Cooking right now: "Project
          <a href="https://www.evalapply.org/index.html#writing-for-nerds">
            Writing for nerds"</a>.
        </p>
      </div>
    </div>
  </div>
</header>
  <main id="main">
    <article id="blog-post" class="stack">
  <header class="stack">
      <p class="title">Poor man's bitemporal data system in SQLite and Clojure</p>

      <p class="cluster post-meta">
        <span>[ &darr; <a href="#blog-post-toc" rel="bookmark" target=_self>toc</a> ]</span>
        <span class="date">Published: 2025-07-14</span>
        <span class="date">Updated: 2025-07-15</span>
        <span class="author">By: Aditya Athalye</span>
      </p>

      <p class="summary">
        On trying to mash up SQLite with ideas stolen from Accountants, Clojure, Datomic, XTDB, Rama, and Local-first-ers, to satisfy Henderson's Tenth Law. Viz., to make a sufficiently complicated data system containing an ad-hoc, informally-specified, bug-ridden, slow implementation of half of a bitemporal database. Because? Because laying about on a hammock, contemplating hopelessly complected objects like Current Databases isn't just for the Rich man.
      </p>
     <div class="post-meta"><hr></div>
     <div class="post-meta">
            <nav class="cluster">
        <a href="mailto:blog.comments@evalapply.org?subject=DELETE_ME_HUMAN Poor man's bitemporal data system in SQLite and Clojure" rel="bookmark">&#x2709; email me comments</a>
        <span>&raquo; share &rarr;</span>
        <a href="https://bsky.app/intent/compose?text=Poor%20man%27s%20bitemporal%20data%20system%20in%20SQLite%20and%20Clojure%20https%3A%2F%2Fwww.evalapply.org%2Fposts%2Fpoor-mans-time-oriented-data-system%2Findex.html" target="_blank">[bsky]</a>
        <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fwww.evalapply.org%2Fposts%2Fpoor-mans-time-oriented-data-system%2Findex.html" target="_blank">[in]</a>
        <a href="https://news.ycombinator.com/submitlink?u=https%3A%2F%2Fwww.evalapply.org%2Fposts%2Fpoor-mans-time-oriented-data-system%2Findex.html&t=Poor%20man%27s%20bitemporal%20data%20system%20in%20SQLite%20and%20Clojure" target="_blank"> [HN]</a>
        <a href="https://lobste.rs/stories/new" target="_blank">[lobste.rs]</a>
        <a href="http://www.reddit.com/submit?url=https%3A%2F%2Fwww.evalapply.org%2Fposts%2Fpoor-mans-time-oriented-data-system%2Findex.html&title=Poor%20man%27s%20bitemporal%20data%20system%20in%20SQLite%20and%20Clojure" target="_blank">[reddit]</a>
        <a class="site-feed" href="https://www.evalapply.org/index.xml" target="_blank">feed</a>
      </nav>
      <p><hr></p>
      <form class="footer cluster"
      action="https://buttondown.com/api/emails/embed-subscribe/evalapply"
      method="post"
      target="popupwindow"
      autocomplete="on"
      onsubmit="window.open('https://buttondown.com/evalapply', 'popupwindow')">
  <input type="email" name="email" id="bd-email" autocomplete="on" />
  <label for="bd-email" hidden>Email</label>
  <span>
    <input type="submit" value="Get posts by email" />
    <input type="hidden" name="tag" value="everyone" />
<input type="hidden" name="tag" value="via-blog-post" />
  </span>
</form>
      <p><hr></p>
      <nav class="cluster">
        <span>Tags:</span>
        <a href="https://www.evalapply.org/tags/functional_programming/index.html#main" target="_self">#functional_programming</a><a href="https://www.evalapply.org/tags/clojure/index.html#main" target="_self">#clojure</a><a href="https://www.evalapply.org/tags/databases/index.html#main" target="_self">#databases</a><a href="https://www.evalapply.org/tags/architecture/index.html#main" target="_self">#architecture</a><a href="https://www.evalapply.org/tags/software_design/index.html#main" target="_self">#software_design</a><a href="https://www.evalapply.org/tags/local_first/index.html#main" target="_self">#local_first</a><a href="https://www.evalapply.org/tags/programming/index.html#main" target="_self">#programming</a><a href="https://www.evalapply.org/tags/web_development/index.html#main" target="_self">#web_development</a>
      </nav>
    </div>
  </header>
  <hr>
  <section class="stack">
      <div id="blog-post-toc" class="stack table-of-contents">
  <details class="box invert stack" open>
    <summary>
      <strong>Contents</strong>
    </summary>
    <nav class="stack">
      <a href="#dont-try-this-at-work" target="_self" class="toc-heading:h1">Don't try this at work!</a>
<a href="#reading-guide-thinky-thoughts-alert-same-thing" target="_self" class="toc-heading:h1">Reading Guide / Thinky Thoughts Alert (same thing)</a>
<a href="#factual-and-temporal-world-building" target="_self" class="toc-heading:h1">Factual and Temporal World-Building</a>
<a href="#accountants-are-our-exemplary-archetype" target="_self" class="toc-heading:h2">Accountants are our exemplary archetype</a>
<a href="#all-databases-record-state-of-entities" target="_self" class="toc-heading:h2">All databases record <strong>state</strong> of <strong>entities</strong></a>
<a href="#everything-is-process" target="_self" class="toc-heading:h2">Everything is Process</a>
<a href="#the-identity-of-an-entity-is-the-complete-life-it-lives" target="_self" class="toc-heading:h2">The <strong>identity</strong> of an entity is the complete life it lives</a>
<a href="#a-fact-can-be-true-or-false" target="_self" class="toc-heading:h2">A <strong>fact</strong> can be true or false</a>
<a href="#what-happens-when-fact-and-fact-collide" target="_self" class="toc-heading:h2">What happens when fact and fact collide?</a>
<a href="#finally-the-two-questions-that-put-the-bi-in-the-bitemporal" target="_self" class="toc-heading:h2">Finally, the Two Questions that put the 'bi' in the 'bitemporal'</a>
<a href="#when-did-it-actually-happen" target="_self" class="toc-heading:h3">When did it actually happen?</a>
<a href="#when-did-we-officially-record-it" target="_self" class="toc-heading:h3">When did we officially record it?</a>
<a href="#reality-versus-data-based-time-travel" target="_self" class="toc-heading:h1">Reality versus (data-based) Time-Travel</a>
<a href="#no-temporal-database-can-contain-reality-itself" target="_self" class="toc-heading:h2">No temporal database can contain Reality itself</a>
<a href="#reality-transpires-in-dedekind-cuts" target="_self" class="toc-heading:h2">Reality transpires in Dedekind cuts</a>
<a href="#facts-contain-observations.-observations-are-not-reality." target="_self" class="toc-heading:h2">Facts contain observations. Observations are not Reality.</a>
<a href="#materialised-reality-depends-on-whos-asking." target="_self" class="toc-heading:h2">Materialised "Reality" depends on who's asking.</a>
<a href="#architecture-decisions-code" target="_self" class="toc-heading:h1">Architecture Decisions + Code</a>
<a href="#the-bet" target="_self" class="toc-heading:h2">The Bet</a>
<a href="#the-architecture-a-vertically-integrated-saas-machine" target="_self" class="toc-heading:h2">The Architecture: A Vertically Integrated SaaS Machine</a>
<a href="#the-trade-off-hard-to-design-easy-to-build-own-operate-teach" target="_self" class="toc-heading:h3">The Trade-Off: Hard to design, Easy to Build-Own-Operate-Teach</a>
<a href="#above-all-aggressively-minimise-system-wide-complexity" target="_self" class="toc-heading:h3">Above All: <strong>Aggressively</strong> Minimise System-Wide Complexity</a>
<a href="#two-wee-vms-please.-one-to-serve-one-for-failover." target="_self" class="toc-heading:h3">Two Wee VMs, please. One to serve, one for failover.</a>
<a href="#feed-cheap-disks-to-storage-hungry-temporal-databases" target="_self" class="toc-heading:h3">Feed cheap disks to storage-hungry Temporal Databases</a>
<a href="#clojure-namespaces-and-immutability-are-honking-great-ideas" target="_self" class="toc-heading:h2">Clojure: Namespaces and Immutability are honking great ideas</a>
<a href="#honeysql-constrain-world-namespaces" target="_self" class="toc-heading:h3">HoneySQL: Constrain World Namespaces</a>
<a href="#honeysql-constrain-world-users" target="_self" class="toc-heading:h3">HoneySQL: Constrain World Users</a>
<a href="#honeysql-constrain-world-entities" target="_self" class="toc-heading:h3">HoneySQL: Constrain World Entities</a>
<a href="#datomic-single-thread-writes-concurrent-reads" target="_self" class="toc-heading:h2">Datomic: Single-thread writes, concurrent reads</a>
<a href="#code-saasy-sqlite-configuration" target="_self" class="toc-heading:h3">Code: SaaSy SQLite Configuration</a>
<a href="#xtdb-all-facts-are-bitemporal-by-design" target="_self" class="toc-heading:h2">XTDB: All facts are bitemporal by design</a>
<a href="#honeysql-our-central-append-only-world-facts-table" target="_self" class="toc-heading:h3">HoneySQL: Our central append-only "World Facts" table</a>
<a href="#realities-are-arrows.-time-marks-flight.-uuidv7-is-time." target="_self" class="toc-heading:h2">Realities are arrows. Time marks flight. UUIDv7 is Time.</a>
<a href="#honeysql-current-db-is-just-a-view-of-valid-world-facts-as-of-now" target="_self" class="toc-heading:h3">HoneySQL: Current DB is just a VIEW of valid World Facts as-of-now</a>
<a href="#honeysql-current-db-indices-and-full-text-search-for-great-good" target="_self" class="toc-heading:h3">HoneySQL: Current DB: Indices and Full Text Search for great good</a>
<a href="#rama-views-are-just-data.-materialize-in-clojure.-not-in-sql." target="_self" class="toc-heading:h2">Rama: Views are just data. Materialize in Clojure. Not in SQL.</a>
<a href="#sqlite-flexible-typing-for-the-win" target="_self" class="toc-heading:h2">SQLite: Flexible typing for the win</a>
<a href="#transact-facts-append-only" target="_self" class="toc-heading:h3">Transact Facts: Append-only</a>
<a href="#transact-entities-namespaces-users-idempotently" target="_self" class="toc-heading:h3">Transact Entities, Namespaces, Users Idempotently</a>
<a href="#git-and-local-first-somehow-make-all-facts-merge" target="_self" class="toc-heading:h2">Git and Local-First: Somehow make all facts merge</a>
<a href="#todo-production-engineering-things-one-ought-to-do" target="_self" class="toc-heading:h2">TODO: Production engineering things one ought to do</a>
<a href="#postamble-rant-as-a-recap-same-thing" target="_self" class="toc-heading:h1">Postamble / Rant As A Recap (same thing)</a>
<a href="#readings-and-references" target="_self" class="toc-heading:h1">Readings and References</a>
<a href="#research-references" target="_self" class="toc-heading:h2">Research references</a>
<a href="#temporal-data-system-friendly-products" target="_self" class="toc-heading:h2">Temporal Data System Friendly Products</a>
<a href="#affiliations-disclosures" target="_self" class="toc-heading:h2">Affiliations / Disclosures</a>
<a href="#special-thanks-and-credits" target="_self" class="toc-heading:h1">Special Thanks and Credits</a>
<a href="#footnotes" target="_self" class="toc-heading:h1">Footnotes</a>
    </nav>
  </details>
</div>
<hr>
  <h1 id="dont-try-this-at-work">Don't try this at work!</h1>
<figure>
<img src="./poor-mans-bitemporal-sqlite-db-scheme.png" />
<figcaption>The <em>"Poor Man's Bitemporal Database"</em>, in the safety of my local box. No servers were harmed. Yet.</figcaption>
</figure>
<p>Especially fellow Clojurians trying to realise their Indie B2B SaaS dreams (translation: income <em>and</em> time-poor). Please use a proper professional time-oriented data system. The following are (pithy descriptions mine); <em>and</em> they are available <em>gratis</em> for fledgling commercial use.</p>
<ul>
<li><a href="https://www.datomic.com/">Datomic</a>… <em>"the DB as a value"</em> over an immutable log of all facts.</li>
<li><a href="https://xtdb.com/">XTDB</a>… <em>"the DB as a value"</em> over an immutable log of all <em>bitemporal</em> facts.</li>
<li><a href="https://redplanetlabs.com/">Rama</a>… <em>"<strong>any</strong> DB as dirt-cheap view"</em> over an immutable log of all events.</li>
</ul>
<h1 id="reading-guide-thinky-thoughts-alert-same-thing">Reading Guide / Thinky Thoughts Alert (same thing)</h1>
<p><em><strong>Solitary over-caffeinated temporal database rumination</strong></em> went out of hand. Even <em>The Voices</em> are fed up and want someone to stop us. Furthermore;</p>
<ol>
<li>Sage friends already gently shook their heads after hearing <em>The Voices</em>.</li>
<li>Their hard-won advice—<em>"Just Use Postgres."</em>, and <em>"Please, for everyone's sake, stick with the relational models."</em>—fell on deaf ears. <a href="#fn1" target="_self" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></li>
<li>Obviously, I am also incapable of following <a href="#dont-try-this-at-work" target="_self">my own advice</a>.</li>
</ol>
<p>Hence this post.</p>
<p><em><strong>Take what is useful, discard the rest…</strong></em></p>
<p>The key take-away is: <em><strong>the accountants were right all along</strong></em>. Software engineers will do well, to cleverly copy the accountants <a href="#fn2" target="_self" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>. Now you may…</p>
<ul>
<li><a href="https://duckduckgo.com/?q=cat+pictures">View cat pictures</a> instead.</li>
<li><a href="#readings-and-references" target="_self">Skip to the reference material</a>. <em>Definitely</em> worth your time; pinky promise.</li>
<li><a href="#architecture-decisions-code" target="_self">Skip to Architecture + Code</a>; where the raw rubber tire of one's thinky-thought-ing meets the rough road of relentless Reality.</li>
</ul>
<p>Or, grab a big beverage to help ingest the <em>ten thousand</em> tokens to follow… Unless you are a Large Language Model. You can't drink. Sucks to be you.</p>
<p><em><strong>But beware. Once you see, you cannot un-see the fact that…</strong></em></p>
<blockquote>
<p>Any sufficiently complicated data system contains an ad-hoc, informally-specified, bug-ridden, slow implementation of half of a bitemporal database.</p>
<p>— <a href="https://github.com/jarohen">Henderson</a>'s Tenth Law.</p>
</blockquote>
<h1 id="factual-and-temporal-world-building">Factual and Temporal World-Building</h1>
<figure>
<img src="./dr-who-shapshot-in-time.jpg" />
<figcaption>Recommended reading (ages 10 to 1,000) for the aspiring temporal data engineer.</figcaption>
</figure>
<h2 id="accountants-are-our-exemplary-archetype">Accountants are our exemplary archetype</h2>
<p>The cashier at Temporal Convenience Store K9, just handed us our bill. Oi; where is that 10% discount applicable to our bulk purchase of provisions as loyal customers (it's going to be a <em>long</em> trip)?!</p>
<p>Now we <em>think</em> that, but we <em>ask</em> politely, because we know there are many civil ways to sort this snafu without shoplifting or violence. Two universally accepted <a href="#fn3" target="_self" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a> remedies are:</p>
<ul>
<li>The cashier has direct authority to fix it, and they may gladly oblige.</li>
<li>The cashier's hands are sadly tied. For ERP reasons, accounts alone has authority to issue refunds for bills over a certain value. But we asked nicely so the cashier kindly nods us to accounts, in the backroom.</li>
</ul>
<p>Odds are that the store people <a href="#fn4" target="_self" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a> will fix it by issuing <em>two <strong>new</strong> transactions</em>.</p>
<ul>
<li>One transaction to cancel the last bill and reverse the related charge to our spacecard.</li>
<li>Another transaction issuing the corrected bill, including the discounted amount, with a fresh charge made to our spacecard.</li>
</ul>
<p>Meanwhile, Temporal Convenience Store K9's various ledgers have received corresponding debits and credits too, of course. But enough. A programmer, though Poor, is no Fool. One does not simply trespass The Field of Accountants. There be dragons.</p>
<p>So… Back to the DB.</p>
<p>One way or another, the store's accounting database must tell these facts:</p>
<ul>
<li>At TxTime-7543, Cashier-Adric at Store-K9 ISSUED bill ID-13579 having value 100 spacecoin, and charged it to SpaceCard-1337.</li>
<li>At TxTime-7587, Cashier-Adric at Store-K9 REVERSED bill ID-13579 having value 100 spacecoin, and refunded it to SpaceCard-1337.
<ul>
<li>Maaaybe a note about why it was reversed. <a href="#fn5" target="_self" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a></li>
</ul></li>
<li>At TxTime-7715, Accounts-Nyssa at Store-K9 ISSUED bill ID-13579-v2 for 90 spacecoin, with a total value of 100 spacecoin minus 10 spacecoin going to discount, and charged 90 spacecoin to SpaceCard-1337.</li>
</ul>
<p>We call this a <em>temporal data system</em> because it incorporates the passage of time.</p>
<ul>
<li>No information is ever modified in-place or deleted.</li>
<li>New information is always appended.</li>
<li>To grok the latest state of the accounts, one must read the sequence of all facts recorded in the database.</li>
<li>Reading a fact updates a separate, current view of the accounts… our "as of now" understanding of the world.</li>
<li>The "current view" can be rebuilt from scratch, up to any point in time, whether it is "as of now", or "as of last week", or "as of next quarter" (which will be useful only if we add synthetic projected-future events into the database).</li>
</ul>
<p>So… What to think about in order to design a general-purpose temporal data system that does this for us?</p>
<h2 id="all-databases-record-state-of-entities">All databases record <strong>state</strong> of <strong>entities</strong></h2>
<p>People, things, processes etc. State is the discrete <strong>value</strong> of some <strong>attribute</strong> of an <strong>entity</strong> <em>at a specific point in time</em>.</p>
<ul>
<li><strong>Values</strong> are timeless and context free <code>(17)</code>.</li>
<li><strong>Attributes</strong> provide context <code>('age')</code>, which we use to suggest and interpret the meaning of a value <code>(= age 17)</code>.</li>
<li><strong>Entities</strong> are real or imaginary objects ( <code>Adric</code>) having attributes (<code>age</code>).</li>
</ul>
<p>Thus, the <em>State</em> of <em>Adric</em> can be stated as: <em><strong>Adric's age is 17 as of now</strong></em>.</p>
<p>In a current database—which is just a fancy way of saying <em>database</em>—the <em>as of now</em> is implicit. So is the concept of <em>"<code>age</code> is an attribute of the entity <code>Adric</code>"</em>. We just call it <em>Schema</em>, in the abstract.</p>
<table>
<thead>
<tr class="header">
<th>entity</th>
<th>age</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Adric</td>
<td>17</td>
</tr>
</tbody>
</table>
<p>Let's re-state our traditional table as <strong><em>Entity-Attribute-Value (EAV)</em></strong> triplets. Let's also add a column for time (as we often do) to answer questions like "when was Adric's age last updated in our database?".</p>
<table>
<thead>
<tr class="header">
<th>entity</th>
<th>attribute</th>
<th>value</th>
<th>time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Adric</td>
<td>age</td>
<td>17</td>
<td>as-of-date-time</td>
</tr>
</tbody>
</table>
<p>From this kernel shall spring forth our world, wrought of facts and time itself. But first, one must acknowledge that…</p>
<blockquote>
<p>All the world’s a stage,<br />
And all the men and women merely players;<br />
They have their exits and their entrances,<br />
And one man in his time plays many parts,<br />
His acts being seven ages.</p>
<p>— William Shakespeare, As You Like It, Act-II, Scene-VII, Lines 139-143</p>
</blockquote>
<p>As my theater gentlefriends like to say…</p>
<h2 id="everything-is-process">Everything is Process</h2>
<p>We understand the world in terms of processes. All of Reality is a live process which we want to participate in—control, influence, react, adapt. Ergo, all information is part of some process. Yes, even universal constants like <code>c</code> and <code>π</code>, which we can confidently assume to be constant only in our observable universe. Because even these came to be <em>after</em> the moment of the big bang, and will remain only until the eventual heat death of the universe (assuming our universe is ever-expanding, and not a bouncing singularity).</p>
<p>It follows that, to understand the world, we must observe and respond to data; information about various attributes of various meaningful aspects of reality, as we perceive it. Said another way, we understand the world by observing and modifying the state of entities over time—the past, the now, and the later. A person's address, a valve's current position, the remaining free volume of a container, the trajectory of a comet, one's fast-emptying savings account.</p>
<table>
<thead>
<tr class="header">
<th>entity</th>
<th>attribute</th>
<th>value</th>
<th>time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Adric</td>
<td>age</td>
<td>17</td>
<td>as-of-date-time</td>
</tr>
<tr class="even">
<td>Adric</td>
<td>address</td>
<td>Foo</td>
<td>as-of-date-time</td>
</tr>
<tr class="odd">
<td>Adric</td>
<td>bitemporal belief</td>
<td>1</td>
<td>as-of-date-time</td>
</tr>
</tbody>
</table>
<p>The more sophisticated a being is, the more context about entities and entity-relationships it is able to keep alive and/or use simultaneously <a href="#fn6" target="_self" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a>.</p>
<h2 id="the-identity-of-an-entity-is-the-complete-life-it-lives">The <strong>identity</strong> of an entity is the complete life it lives</h2>
<p>Never-ending <em>process</em> is the beating heart, the whistling wind, the pulsing quasar, the furious procreation, the tectonic Subduction, the whispered good-bye, the thermodynamic survival instinct of all things. Process is the <em>why</em> of <em>being</em>. One could even say that an entity without <em>id</em> can have no identity.</p>
<p>This is why, to properly identify an entity, we must egolessly maintain an up-to-date mental-model about it. For that, we must continually observe, record, and aggregate a succession of states of the entity in question.</p>
<p>Consequently, knowledge of entity-attributes alone is not sufficient (Adric has age, address, belief). Knowledge of attribute-values is required too (age is x, address is y, belief is z). And without a sense of time, we simply cannot complete the picture.</p>
<p>To make it concrete:</p>
<ul>
<li>Every person's life revolves around their address and we can guess different things about them based on how their address changes.</li>
<li>You know which Adric is being spoken about because you know
<ul>
<li>Adric's age was 17 last year. Adric's age is 18 as of now. Adric's age will be 319 on &lt;specific date&gt;.</li>
<li>Adric's address was Foo last year. Adric's address is Baz as of now. Adric's address will be Bar after December 2025.</li>
<li>Adric's belief in bitemporality was 1% last year. Adric's belief in bitemporality is 99% as of now.</li>
<li>Adric's temporal innocence level was 99% last year. Adric's temporal innocence level is 1% as of now.</li>
</ul></li>
<li>A reader of this set of facts can confidently determine: <em><strong>As-of-now, Adric is an eighteen year old entity that lives at</strong></em> <em><strong>'Baz', believes strongly in bitemporality, and has nearly no temporal innocence.</strong></em></li>
</ul>
<table>
<thead>
<tr class="header">
<th>E</th>
<th>A</th>
<th>V</th>
<th>as-of-time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Adric</td>
<td>{:age [:time :years]}</td>
<td>17</td>
<td>date-last-year</td>
</tr>
<tr class="even">
<td>Adric</td>
<td>{:age [:time :years]}</td>
<td>18</td>
<td>date-now</td>
</tr>
<tr class="odd">
<td>Adric</td>
<td>{:age [:time :years]}</td>
<td>319</td>
<td>date-future</td>
</tr>
<tr class="even">
<td>Adric</td>
<td>{:address [:text :string]}</td>
<td>Foo</td>
<td>date-last-year</td>
</tr>
<tr class="odd">
<td>Adric</td>
<td>{:address [:text :string]}</td>
<td>Baz</td>
<td>date-now</td>
</tr>
<tr class="even">
<td>Adric</td>
<td>{:address [:text :string]}</td>
<td>Bar</td>
<td>date-future</td>
</tr>
<tr class="odd">
<td>Adric</td>
<td>{:belief [:bitemporality :%]}</td>
<td>1</td>
<td>date-last-year</td>
</tr>
<tr class="even">
<td>Adric</td>
<td>{:belief [:bitemporality :%]}</td>
<td>99</td>
<td>date-now</td>
</tr>
<tr class="odd">
<td>Adric</td>
<td>{:innocence [:temporal :%]}</td>
<td>99</td>
<td>date-last-year</td>
</tr>
<tr class="even">
<td>Adric</td>
<td>{:innocence [:temporal :%]}</td>
<td>1</td>
<td>date-now</td>
</tr>
</tbody>
</table>
<p><code>KEY: E(ntity), A(ttribute), V(alue)</code></p>
<hr />
<p>Having gained this factual understanding, a dear reader may be tempted to further theorise; <em>Adric lost his temporal innocence and eventually</em> <em>ended up living at 'Bar', where he always is these days.</em> Of course, to <em>prove</em> such an allegation, the dear reader would have to piece together many more facts about Adric, <em>and show causation</em>, not mere correlation.</p>
<p>The dear reader may happily play temporal sleuth. However, the temporal database and temporal data engineer are not here to judge. Our role is simply to record the facts as presented, without ego, without prejudice, with integrity, so that the temporal data sleuth may use it productively to figure out <em><strong>what happened, when, and why</strong></em>.</p>
<p>For there is more to facts than meets the eye.</p>
<blockquote>
<p>"I'm not in the judgment business, Mr. Orr. I'm after facts. And the events of the mind, believe me, to me are facts. When you <em><strong>see</strong></em> another man's dream as he dreams it recorded in black and white on the electroencephalograph, as I've done ten thousand times, you don't speak of dreams as 'unreal.' They exist; they are events; they leave a mark behind them."</p>
<p>— Dr. William Haber</p>
<p><code>The Lathe of Heaven, Ursula K. Le Guin.</code></p>
</blockquote>
<h2 id="a-fact-can-be-true-or-false">A <strong>fact</strong> can be true or false</h2>
<p>The temporal sleuth knows that one must resolve the reality of a fact by asserting whether it is true or false.</p>
<p>Our facts table can be expressed as something like the table below. Aspiring temporal data engineers will do well to avoid speculating <em>why</em> a fact might have been asserted true or false. Our ilk must simply realise that we can <em>assert</em> facts this way; <code>&lt;statement of fact&gt; is &lt;true/false?&gt; as of &lt;time&gt;</code>.</p>
<p>Each state of the Adric entity can thus be re-written as an <em><strong>assertion</strong></em> of a fact.</p>
<ul>
<li><em>"Adric's age is 17"</em> is a <em>true</em> fact <em>as of</em> date-last-year.</li>
<li><em>"Adric's age is 17"</em> is a <em>false</em> fact <em>as of</em> date-now.</li>
</ul>
<table>
<thead>
<tr class="header">
<th>E</th>
<th>A</th>
<th>V</th>
<th>assert</th>
<th>as-of-time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Adric</td>
<td>{:age [:time :years]}</td>
<td>17</td>
<td>true</td>
<td>date-last-year</td>
</tr>
<tr class="even">
<td>Adric</td>
<td>{:age [:time :years]}</td>
<td>17</td>
<td>false</td>
<td>date-now</td>
</tr>
</tbody>
</table>
<p><code>KEY: E(ntity), A(ttribute), V(alue)</code></p>
<hr />
<p>With just this information, the temporal sleuth can infer that Adric's age <em>definitely changed at least once</em> sometime between date-last-year and date-now. But how many times, and to what value, is anybody's guess. For that, we need more temporal observations. Which thickens the plot. For now, we might receive conflicting observations.</p>
<h2 id="what-happens-when-fact-and-fact-collide">What happens when fact and fact collide?</h2>
<p>You Won't Believe This One Trick Accountants Use To Deal With Changing Facts. They never delete old entries from their ledgers, they simply make <em>new</em> "correcting entries" (We established this in our motivating example.).</p>
<p>Earlier, we were told to record that the Adric entity's age is 17 as of date-last-year. Presently, we are told to make a note that Adric is NOT 17 any more. We have no idea about Adric's <del>birth date</del> creation date, by the way. We just make a note of assertions of facts about Adric's age, as we are told.</p>
<table>
<thead>
<tr class="header">
<th>E</th>
<th>A</th>
<th>V</th>
<th>assert</th>
<th>as-of-time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Adric</td>
<td>{:age [:time :years]}</td>
<td>17</td>
<td>true</td>
<td>date-last-year</td>
</tr>
<tr class="even">
<td>Adric</td>
<td>{:age [:time :years]}</td>
<td>17</td>
<td>false</td>
<td>date-now</td>
</tr>
</tbody>
</table>
<p><code>KEY: E(ntity), A(ttribute), V(alue)</code></p>
<hr />
<p><em><strong>At this point, if anyone asks for Adric's age "as of now", the only truth we can tell is "we don't know".</strong></em> Think about this for a moment. How should we interrogate this temporal data store, to make sense of the information it contains? It's subtle. Hopefully all the thinky thoughting to come will build a clearer intuition. But we are out of time right now…</p>
<p>Sixty seconds later, we are interrupted and told that Adric is in fact 18, and oh by the way, he was already 18 as of date-now. And does it bother us that <em>we wrote the earlier thing down already</em>? No it doesn't. We just assert the new fact.</p>
<p>And just like that…</p>
<p><em>Now</em> if anyone asks for Adric's age "as of now", we can truthfully answer <code>18</code>. Because now our table looks like…</p>
<table>
<thead>
<tr class="header">
<th>E</th>
<th>A</th>
<th>V</th>
<th>assert</th>
<th>as-of-time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Adric</td>
<td>{:age [:time :years]}</td>
<td>17</td>
<td>true</td>
<td>date-last-year</td>
</tr>
<tr class="even">
<td>Adric</td>
<td>{:age [:time :years]}</td>
<td>17</td>
<td>false</td>
<td>date-now</td>
</tr>
<tr class="odd">
<td>Adric</td>
<td>{:age [:time :years]}</td>
<td>18</td>
<td>true</td>
<td>date-now</td>
</tr>
</tbody>
</table>
<p><code>KEY: E(ntity), A(ttribute), V(alue)</code></p>
<hr />
<p>Similarly, we make note of other facts about Adric as of various dates on the timeline. But let's add one more key detail… the time at which we made note of the information.</p>
<h2 id="finally-the-two-questions-that-put-the-bi-in-the-bitemporal">Finally, the Two Questions that put the 'bi' in the 'bitemporal'</h2>
<p>Events always occur <em>before they can be recorded</em>. It's just how nature works. Therefore, we can only ever make a note of a fact, after the fact. And so it comes to pass, that any self-respecting temporal sleuth naturally begins their temporal interrogation with two questions:</p>
<h3 id="when-did-it-actually-happen">When did it actually happen?</h3>
<p>Only a fact-sender may lay claim to the time an event occurred. <em>And</em> this timestamp must <em>always</em> travel with the fact. Whether the claimed timestamp is acceptable or not is between the fact-sender and the temporal sleuth. The temporal data store and engineer just make sure it is written down exactly as given.</p>
<h3 id="when-did-we-officially-record-it">When did we officially record it?</h3>
<p>Only the temporal data <em>store</em>—not even the temporal data engineer—may lay claim to when this happened. For the temporal data engineer is just a fallible puny human who can screw up in so many ways. Making typos. Misreading the clock. Lazily avoiding recording facts until the auditor comes a-calling. Or even forgetting the fact entirely, upon discovery of which fact, the temporal sleuth gets called in to piece together what might have happened.</p>
<p>So, let's update our temporal data table with the "transaction" time, at which the data store guarantees that it has immutably inscribed a fact.</p>
<p>To ease table-reading life of our fellow our puny humans, we also rearrange the time columns a bit. Now, we can manually read records as follows:</p>
<ul>
<li>At Transaction Time <code>t02</code>, the table recorded the following fact:
<ul>
<li><em>As of <code>dt-now</code>, <code>Adric</code>'s <code>:age</code> being <code>17</code> stands REDACTED.</em></li>
</ul></li>
<li>At Transaction Time <code>t03</code>, the table recorded the following fact:
<ul>
<li><em>As of <code>dt-now</code>, <code>Adric</code>'s <code>:age</code> being <code>18</code> stands ASSERTED.</em></li>
</ul></li>
</ul>
<table>
<thead>
<tr class="header">
<th>tx-time</th>
<th>as-of-time</th>
<th>E</th>
<th>A</th>
<th>V</th>
<th>assert</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>t01</td>
<td>dt-last-yr</td>
<td>Adric</td>
<td>{:age [:time :years]}</td>
<td>17</td>
<td>true</td>
</tr>
<tr class="even">
<td><em><strong>t02</strong></em></td>
<td><em><strong>dt-now</strong></em></td>
<td><em><strong>Adric</strong></em></td>
<td><em><strong>{:age [:time :years]}</strong></em></td>
<td><em><strong>17</strong></em></td>
<td><em><strong>false</strong></em></td>
</tr>
<tr class="odd">
<td><em><strong>t03</strong></em></td>
<td><em><strong>dt-now</strong></em></td>
<td><em><strong>Adric</strong></em></td>
<td><em><strong>{:age [:time :years]}</strong></em></td>
<td><em><strong>18</strong></em></td>
<td><em><strong>true</strong></em></td>
</tr>
<tr class="even">
<td>t04</td>
<td>dt-future</td>
<td>Adric</td>
<td>{:age [:time :years]}</td>
<td>319</td>
<td>true</td>
</tr>
<tr class="odd">
<td>t05</td>
<td>dt-last-yr</td>
<td>Adric</td>
<td>{:address [:text :string]}</td>
<td>Foo</td>
<td>true</td>
</tr>
<tr class="even">
<td>t06</td>
<td>dt-now</td>
<td>Adric</td>
<td>{:address [:text :string]}</td>
<td>Bar</td>
<td>false</td>
</tr>
<tr class="odd">
<td>t07</td>
<td>dt-now</td>
<td>Adric</td>
<td>{:address [:text :string]}</td>
<td>Baz</td>
<td>true</td>
</tr>
<tr class="even">
<td>t08</td>
<td>dt-future</td>
<td>Adric</td>
<td>{:address [:text :string]}</td>
<td>Bar</td>
<td>true</td>
</tr>
<tr class="odd">
<td>t09</td>
<td>dt-last-yr</td>
<td>Adric</td>
<td>{:belief [:bitemporality :%]}</td>
<td>1</td>
<td>true</td>
</tr>
<tr class="even">
<td>t10</td>
<td>dt-now</td>
<td>Adric</td>
<td>{:belief [:bitemporality :%]}</td>
<td>99</td>
<td>true</td>
</tr>
<tr class="odd">
<td>t11</td>
<td>dt-future</td>
<td>Adric</td>
<td>{:belief [:bitemporality :%]}</td>
<td>0</td>
<td>false</td>
</tr>
<tr class="even">
<td>t12</td>
<td>dt-last-yr</td>
<td>Adric</td>
<td>{:innocence [:temporal :%]}</td>
<td>99</td>
<td>true</td>
</tr>
<tr class="odd">
<td>t13</td>
<td>dt-now</td>
<td>Adric</td>
<td>{:innocence [:temporal :%]}</td>
<td>1</td>
<td>true</td>
</tr>
<tr class="even">
<td>t14</td>
<td>dt-future</td>
<td>Adric</td>
<td>{:innocence [:temporal :%]}</td>
<td>33</td>
<td>false</td>
</tr>
</tbody>
</table>
<p><code>KEY: E(ntity), A(ttribute), V(alue)</code></p>
<hr />
<p>This brings us to the absurdity of time travel… For things to get better, they have to get <em>weird</em> first.</p>
<h1 id="reality-versus-data-based-time-travel">Reality versus (data-based) Time-Travel</h1>
<figure>
<img src="./time-travel-timelines-informationisbeautiful-net.jpg" />
<figcaption>"TIMELINES" - Time Travel in popular film and TV. (Source: <a href="https://informationisbeautiful.net/visualizations/timelines-time-travel-in-popular-film-and-tv/">informationisbeautiful.net</a>)</figcaption>
</figure>
<blockquote>
<p>"Why do you think your mother didn't notice that reality had changed since last night?" <code>[Dr. Haber]</code></p>
<p>"Well, she didn't dream it. I mean, the dream really did change reality. It made a different reality, retroactively, which she'd been part of all along. Being in it, she had no memory of any other. I did, I remembered both, because I was… there… at the moment of the change. This is the only way I can explain it, I know it doesn't make sense. But I have got to have some explanation or else face the fact that I'm insane." <code>[Mr. Orr]</code></p>
<p><code>The Lathe of Heaven, Ursula K. Le Guin.</code></p>
</blockquote>
<p><em>Actual</em> Time Travel is different each time, because the very act of it interacts with and perturbs Reality. Not being higher dimensional beings, we have evolved to get by, by perceiving very little of very little. To us, convenient fictions are good enough Reality.</p>
<h2 id="no-temporal-database-can-contain-reality-itself">No temporal database can contain Reality itself</h2>
<p><em>"The Song"</em> is a convenient fiction.</p>
<p>We love to loop a favourite hit single. Yet…</p>
<ul>
<li><em><strong>A record is not "The Song".</strong></em> All recordings are lossy <a href="#fn7" target="_self" class="footnote-ref" id="fnref7" role="doc-noteref"><sup>7</sup></a> because all acts of measurement are lossy. That's just physics.</li>
<li><em><strong>A replay is not "The Song".</strong></em> Every replay is the same information yet it is <em>new</em>, because Reality is ever-moving, ever-changing. (Ignoring for a moment the fact that every replay degrades the storage medium—vinyl, compact disk, copper plate, SSD—causing further information loss.)</li>
<li><em><strong>Nor are live performances "The Song".</strong></em> Each rendition is different.</li>
</ul>
<p>Similarly, temporal databases can only mimic Time Travel.</p>
<ul>
<li>The experience of Reality can only ever be captured as finite, discrete observations (samples and measurements).</li>
<li>Therefore, a temporal recording or database can only ever contain approximate observations of Reality.</li>
<li>Each time we retrieve the observations, we cannot help but <em>reinterpret</em> them because we ourselves have changed in the interval.</li>
</ul>
<p>We can only ever sing songs about what we believed happened.</p>
<h2 id="reality-transpires-in-dedekind-cuts">Reality transpires in Dedekind cuts</h2>
<p><em>"This Instant"</em> is a convenient fiction.</p>
<p>Every observation of reality exists <em>somewhere inside of an interval</em>, because our means of measurement can only ever <em>approximate</em> the moment of occurrence of an event. The idea of the <em>Dedekind Cut</em> frames this neatly.</p>
<article class="footnotes">
<p>A <a href="https://en.wikipedia.org/wiki/Dedekind_cut">Dedekind cut</a> is a partition of the rationals <code>Q</code> into two subsets <code>A</code> and <code>B</code> such that</p>
<ol>
<li><code>A</code> is nonempty.</li>
<li><code>A ≠ Q</code> (equivalently, <code>B</code> is nonempty).</li>
<li>If <code>x,y ∈ Q</code>, <code>x &lt; y</code>, and <code>y ∈ A</code>, then <code>x ∈ A</code>. (<code>A</code> is "closed downwards".)</li>
<li>If <code>x ∈ A</code>, then there exists a <code>y ∈ A</code> such that <code>y &gt; x</code>. (<code>A</code> does not contain a greatest element.)</li>
</ol>
<p>By omitting the first two requirements, we formally obtain the extended real number line.</p>
<figure>
<img src="Dedekind_cut_at_square_root_of_two.svg.png" />
<figcaption>Dedekind cut at square root of two. (<a href="https://commons.wikimedia.org/wiki/File:Dedekind_cut_at_square_root_of_two.svg">Wikimedia Commons</a>).</figcaption>
</figure>
</article>
<p>Why split such philosophical hairs? Why?</p>
<p>Because, we must record temporal facts with proper temporal resolution. For example, an infinitesimal such as a Femtosecond (10<sup>-15s</sup>) can be…</p>
<ul>
<li>Just Right… for that "Femto Laser" Cataract removal or LASIK surgery.</li>
<li><em>Waaay</em> over the top… for orchestral arrangements where sub-millisecond (&lt; 10<sup>-3s</sup>) coordination is more than enough.</li>
<li>Or <em>too coarse(!)</em>… for Quantum dynamics studies, where incredible things happen in attoseconds (10<sup>-18s</sup>). <a href="#fn8" target="_self" class="footnote-ref" id="fnref8" role="doc-noteref"><sup>8</sup></a></li>
</ul>
<p>More subtly, because all Temporal Data Processing queries are <em>Interval</em> queries, served by collating facts that happened starting Time X to Time Y.</p>
<p>For example, <em>"Calculate the state of the world <code>as-of</code> some <code>Instant</code>."</em></p>
<p>To serve this query, we must collate all facts starting from the earliest available ones, right up to whatever <code>as-of</code> time Instant. It could be <code>as-of</code> &lt;some past moment&gt;, or <code>as-of</code> some projected future, or…. <code>as-of</code> <em>this very instant</em>, a.k.a. a <code>now</code> query.</p>
<p>The <code>now</code> query is a special-case <code>as-of</code> query, because <code>now</code> is an <em>expanding</em> query window… ever-increasing "wall-clock time". It means <em>our computer's temporal resolution</em>, which the temporal database relies on, must suit that of incoming facts. My cheap wristwatch will botch your Formula One lap times.</p>
<p>Fun fact: The <code>now</code> query returns <em>a</em> Current Database.</p>
<h2 id="facts-contain-observations.-observations-are-not-reality.">Facts contain observations. Observations are not Reality.</h2>
<p><em>"Facts"</em> are a convenient fiction.</p>
<p>To fact-find, we must observe. Observation requires measurement. Measurements are inherently lossy. Consequently, no collection of facts, no matter how fine-grained can ever capture Reality as it <em>actually</em> happened.</p>
<p>Besides, facts depend on who's observing. Having experienced the world a bit, we have doubtless realised that, <em>routinely</em>…</p>
<ul>
<li>The same party told us "use this fact", at different times, with no regard to whatever happened in-between.</li>
<li>OR, it's possible that the same party sent us two different facts at the same time, but they were recorded in the table at different times. Maybe the temporal database recorded one fact, but before it could record the other fact, it got waylaid by a VACUUM emergency. It happens.</li>
<li>OOOORRRR, it is possible that <em>two different parties</em> with <em>different</em> vantage points of a shared reality sent their observations independently, without being aware that other party even exists. Our temporal database just says "okay then", and records <em>both</em> claims of facts about observed reality.</li>
</ul>
<p>As we established in the <code>Adric</code> scenario, multiple facts <em>for the same <code>E-A-V</code> triple</em>, can <em>claim</em> to have occurred at the same time (<code>Adric is NOT 17 as-of-now</code>, and <code>Adric IS 18 as-of-now</code>).</p>
<p>Consequently, though our bitemporal database notes down distinct facts at different times, we <em>cannot presume</em> that the sequence of recording follows Reality.</p>
<p>In other words…</p>
<p><em>Facts are <strong>mutually independent parallel <em>claims</em></strong> that assert or redact some aspect of <strong>concurrent real-world events</strong>.</em></p>
<p>In fact, facts are <em>always</em> so. <em>Variables</em> are mutually dependent or independent; correlated or uncorrelated, because variables subsume Real identities, all of which live in the contiguous fabric of the same shared Universe.</p>
<p>What the Fact?!</p>
<h2 id="materialised-reality-depends-on-whos-asking.">Materialised "Reality" depends on who's asking.</h2>
<p><em>"Reality"</em> is a convenient fiction.</p>
<p>We simulate alternate reality all the time. Worrying about the future. Worrying about what someone must be thinking about us just now. Questioning past life choices and wondering "what if". Much like financial analysts, weather modelers, chess pros, special ops teams running scenarios and doing retrospectives. Except those other people get paid to imagine worst case scenarios.</p>
<ol>
<li>If each fact lives <em>on its own conceptual timeline</em>, then we must necessarily <em>reconstruct reality</em> by threading a point of view through a sequence of recorded facts.</li>
<li>Only the temporal sleuth—not the temporal database, nor engineer—get to choose which timeline or timelines (sequence(s) of facts) ought to construct a prospective Reality.</li>
<li>Only the temporal sleuth gets to choose the <code>as-of</code> point in time wherefrom to do so—now, past, future; separately or simultaneously. And gets paid to imagine alternate realities.</li>
</ol>
<h1 id="architecture-decisions-code">Architecture Decisions + Code</h1>
<figure>
<img src="./pallet-rack-architecture.jpg" />
<figcaption>Pallet Rack <em>"<a href="https://www.jaaga.in/living-building">Living Building</a>"</em> nerdspace &amp; art installation - Freeman Murray et. al., Kochi, Kerala, 2012.</figcaption>
</figure>
<p><code>nb.</code> All code snippets are Clojure. All SQL is written specifically for SQLite, using the <a href="https://cljdoc.org/d/com.github.seancorfield/honeysql/2.7.1310/doc/readme">Honey SQL</a> library (SQL as Clojure data structures).</p>
<h2 id="the-bet">The Bet</h2>
<p><em>All</em> data systems are, in reality, temporal data systems. Most just don't know it until it's too late. <em>Things</em>—as life teaches inevitably—have a habit of getting real, real fast. Suddenly, one fine day, life <em>will</em> deliver us a forehead-slapping moment because even that tiny-SaaS indie B2B app has manifested <em>"a sufficiently complicated data system"</em>. Because <a href="../software-debt/index.html#main">complexity is inevitable</a>.</p>
<h2 id="the-architecture-a-vertically-integrated-saas-machine">The Architecture: A Vertically Integrated SaaS Machine</h2>
<p>Runaway incidental complexity <em>of software</em> is why computers got slower while hardware and networks got faster. This bothers me no end. I want to profit from the glut of compute <em>without</em> taking on systemic complexity. <a href="#fn9" target="_self" class="footnote-ref" id="fnref9" role="doc-noteref"><sup>9</sup></a></p>
<p>One way is to build software applications as unified vertically integrated computer systems, as a fruit-named company famously does. And, as is true for contemplating complected objects on hammocks, profiting from full-systems vertical integration isn't just for the absurdly rich global conglomerate.</p>
<p><code>nb.</code> <em><strong>"Vertical Integration" does NOT mean "Being Rigid".</strong></em> Quite the opposite; it means cultivate total adaptability, situational awareness, and mastery over self and environment. <a href="#fn10" target="_self" class="footnote-ref" id="fnref10" role="doc-noteref"><sup>10</sup></a></p>
<h3 id="the-trade-off-hard-to-design-easy-to-build-own-operate-teach">The Trade-Off: Hard to design, Easy to Build-Own-Operate-Teach</h3>
<p>The main thing to understand is that changing any single detail of a vertically-integrated system could mandate ripple-effect changes through the whole system… and <em>that is okay</em>.</p>
<p>The indie vertically-integrating systems builder should choose an extreme position:</p>
<ul>
<li>Either <em>go all-in</em> on a <em>single</em> all-encompassing web SaaS stack (application framework, server runtime, tool chain).</li>
<li>Or make a <a href="https://github.com/adityaathalye/clojure-multiproject-example">custom system of composable parts</a>. Entirely avoid building on top of pre-designed monolithic frameworks (most Clojure pros).</li>
</ul>
<p>Either way is fine. <a href="../clojure-web-app-from-scratch/index.html">Either way demands significant investment</a> from the committed indie SaaS builder. The only real choice one has, is <em>to own it</em>—learn to fit self to it, or make it fit to self. <a href="#fn11" target="_self" class="footnote-ref" id="fnref11" role="doc-noteref"><sup>11</sup></a></p>
<h3 id="above-all-aggressively-minimise-system-wide-complexity">Above All: <strong>Aggressively</strong> Minimise System-Wide Complexity</h3>
<p>The absurdly not-rich local indie SaaS maker must accept the complexity-management limits of their own smol brain. And that is okay. One poor brain can do a <em>lot</em>, if it asks <em>"So, like, how do I build a unified, coherent system specialised to me—my goals, needs, and indeed, to my way of thinking?"</em>, which is…</p>
<ul>
<li>no cloud services lock-in (no VC funding. no funding at all, actually.)</li>
<li>no framework lock-in (a-la-carte pieces)</li>
<li>no tool-bench / process lock-in (design own tools shaped for own brain)</li>
<li>no devops clones (dead-simple deployments, observability, failover etc.)</li>
<li>no (future) customer data lock-in (must be local-first compatible)</li>
</ul>
<p>Well, I am a <a href="https://grugbrain.dev/">grug-brained developer</a> <a href="#fn12" target="_self" class="footnote-ref" id="fnref12" role="doc-noteref"><sup>12</sup></a> therefore "the system" <em>must</em> be small conceptually, and literally. It is mission-critical to build the system piecemeal, where we intimately know the parts and can fully control interfaces between parts and abstraction boundaries.</p>
<p>In the context of a SaaS web application it means:</p>
<ul>
<li>Single-server installation
<ul>
<li>App, db, cache, queue, document store, server, proxy; everything on one box</li>
<li>To scale, beef up server</li>
</ul></li>
<li>Unified Application + Database architecture
<ul>
<li>In-process databases only</li>
<li>Universal, static, zero-migration storage schema</li>
<li>All application-specific materialised views as application code i.e. the application is <em>not</em> "just a DB wrapper".</li>
<li>Optionally, single tenancy. One DB per tenant, for regional compliance, and horizontal scaling as a nice side-benefit.</li>
<li>No write concurrency. All database operations are one-way loops.</li>
<li>No "Distributed Local-first". Local-first mode is unauthenticated single-user. Server-mode is bog standard synchronous SaaS.</li>
</ul></li>
<li>Immutability by default
<ul>
<li>idempotence where immutability gets too involved to implement correctly
<ul>
<li>in-place mutation only as a rare, purposeful, escape hatch when both immutability and idempotence get too complex or too resource-hungry</li>
</ul></li>
</ul></li>
<li>One DB Engine to rule them all
<ul>
<li>Primary store</li>
<li>K/V store</li>
<li>Sessions store</li>
<li>Cache</li>
<li>Document store</li>
</ul></li>
</ul>
<h3 id="two-wee-vms-please.-one-to-serve-one-for-failover.">Two Wee VMs, please. One to serve, one for failover.</h3>
<p>Seriously.</p>
<p>Computers today—even the cheap shared VMs—are stupid-fast. A properly built web app can use the <em>smallest</em> VM below, to support a healthy SaaS business, <em>with room to grow</em>. Add one more box on hot standby for failover.</p>
<table>
<caption>Hetzner Cloud Shared vCPU (Intel®) Pricing - DE, FI datacenters.</caption>
<thead>
<tr class="header">
<th>Name</th>
<th>VCPU</th>
<th>RAM</th>
<th>NVMe SSD</th>
<th>Traffic incl. IPv4</th>
<th>Hourly</th>
<th>Monthly</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>CX22</td>
<td>2</td>
<td>4 GB</td>
<td>40 GB</td>
<td>20 TB</td>
<td>€ 0.006</td>
<td>€ 3.79 max.</td>
</tr>
<tr class="even">
<td>CX32</td>
<td>4</td>
<td>8 GB</td>
<td>80 GB</td>
<td>20 TB</td>
<td>€ 0.0113</td>
<td>€ 6.80 max.</td>
</tr>
<tr class="odd">
<td>CX42</td>
<td>8</td>
<td>16 GB</td>
<td>160 GB</td>
<td>20 TB</td>
<td>€ 0.0273</td>
<td>€ 16.40 max.</td>
</tr>
<tr class="even">
<td>CX52</td>
<td>16</td>
<td>32 GB</td>
<td>320 GB</td>
<td>20 TB</td>
<td>€ 0.054</td>
<td>€ 32.40 max.</td>
</tr>
</tbody>
</table>
<p><code>Source: hetzner.com, as-of 2025-07-12. No affiliation.</code></p>
<hr />
<p>Wherever it's up to me, I will just keep beefing up that single-box installation, for as long as I can get away with. Max out normie VMs with taxing DB queries of a hacked-up temporal database, used by a bog-standard JVM web app.</p>
<p>Like, <em>if <u><strong>I</strong></u> were</em> a web app, that CCX63 would feel absolutely <em>palatial</em>.</p>
<p>Gimme it! <a href="#fn13" target="_self" class="footnote-ref" id="fnref13" role="doc-noteref"><sup>13</sup></a></p>
<table>
<caption>Hetzner Cloud Dedicated vCPU (AMD EPYC) Pricing - DE, FI datacenters.</caption>
<thead>
<tr class="header">
<th>Name</th>
<th>VCPU</th>
<th>RAM</th>
<th>NVMe SSD</th>
<th>Traffic incl. IPv4</th>
<th>Hourly</th>
<th>Monthly</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>CCX13</td>
<td>2</td>
<td>8 GB</td>
<td>80 GB</td>
<td>20 TB</td>
<td>€ 0.02</td>
<td>€ 12.49 max.</td>
</tr>
<tr class="even">
<td>CCX23</td>
<td>4</td>
<td>16 GB</td>
<td>160 GB</td>
<td>20 TB</td>
<td>€ 0.0392</td>
<td>€ 24.49 max.</td>
</tr>
<tr class="odd">
<td>CCX33</td>
<td>8</td>
<td>32 GB</td>
<td>240 GB</td>
<td>30 TB</td>
<td>€ 0.0777</td>
<td>€ 48.49 max.</td>
</tr>
<tr class="even">
<td>CCX43</td>
<td>16</td>
<td>64 GB</td>
<td>360 GB</td>
<td>40 TB</td>
<td>€ 0.1546</td>
<td>€ 96.49 max.</td>
</tr>
<tr class="odd">
<td>CCX53</td>
<td>32</td>
<td>128 GB</td>
<td>600 GB</td>
<td>50 TB</td>
<td>€ 0.3085</td>
<td>€ 192.49 max.</td>
</tr>
<tr class="even">
<td>CCX63</td>
<td>48</td>
<td>192 GB</td>
<td>960 GB</td>
<td>60 TB</td>
<td>€ 0.4623</td>
<td>€ 288.49 max.</td>
</tr>
</tbody>
</table>
<p><code>Source: hetzner.com, as-of 2025-07-12. No affiliation.</code></p>
<hr />
<h3 id="feed-cheap-disks-to-storage-hungry-temporal-databases">Feed cheap disks to storage-hungry Temporal Databases</h3>
<p>Current Databases terrify the temporal database engineer. A current database is a giant mass of global mutable state. It has no innate sense of time. And current database engineers inevitably have to manage concurrency. Some even have to delve into the dark arts of Multi Version Concurrency Control. <a href="#fn14" target="_self" class="footnote-ref" id="fnref14" role="doc-noteref"><sup>14</sup></a></p>
<p>This mortal fear causes temporal database designers to copy accountants, who have been doing temporal data engineering for centuries. Why not tackle the far simpler problem of making everything append-only? Make a DB engine which will guarantee that <em>at such-and-such time</em> <em>it faithfully recorded &lt;this set of claimed facts&gt;, as-given, nondestructively</em>.</p>
<p>However, copying accountants isn't free.</p>
<ul>
<li>For one, temporal databases hoard data; chomping Terabytes for breakfast. The stuff of DB-tuning nightmares of current data engineers.</li>
<li>For another, without the right tools, we risk being Disk-wise but Query-foolish. We mitigate this by copying architects (of software).</li>
</ul>
<p>Here are some worth copying.</p>
<h2 id="clojure-namespaces-and-immutability-are-honking-great-ideas">Clojure: Namespaces and Immutability are honking great ideas</h2>
<p>We want to constrain all entities to well-known, guaranteed globally-qualified namespaces. So…</p>
<ul>
<li><code>world</code> is the only global namespace we permit, and is also the only single-segmented namespace</li>
<li>all other namespaces <strong>must</strong> be <strong>minimum</strong> two-segmented, such as <code>com.acmecorp</code> or <code>com.acmecorp.foo-client</code>.</li>
<li><code>ns_name</code> must only ever be the namespace part (such as <code>com.acmecorp</code> or <code>world</code>) of a fully qualified entity name (of <code>com.acmecorp/user</code> or <code>world/administrator</code>).</li>
</ul>
<p>All SQL is written for SQLite, using <a href="https://cljdoc.org/d/com.github.seancorfield/honeysql/2.7.1310/doc/readme">Honey SQL</a> by Sean Corfield.</p>
<blockquote>
<p>SQL as Clojure data structures. Build queries programmatically – even at runtime – without having to bash strings together.</p>
</blockquote>
<h3 id="honeysql-constrain-world-namespaces">HoneySQL: Constrain World Namespaces</h3>
<figure>
<img src="./poor-mans-bitemporal-sqlite-db-world-namespaces.png" />
<figcaption>"World Namespaces".</figcaption>
</figure>
<div class="sourceCode" id="cb2"><pre class="sourceCode clojure"><code class="sourceCode clojure"><span id="cb2-1"><a href="#cb2-1" target="_self" aria-hidden="true" tabindex="-1"></a>{<span class="at">:create-table</span> [<span class="at">:world</span>_namespaces <span class="at">:if-not-exists</span>]</span>
<span id="cb2-2"><a href="#cb2-2" target="_self" aria-hidden="true" tabindex="-1"></a> <span class="at">:with-columns</span></span>
<span id="cb2-3"><a href="#cb2-3" target="_self" aria-hidden="true" tabindex="-1"></a> [[<span class="at">:rowid</span> <span class="at">:integer</span> <span class="at">:primary-key</span>]</span>
<span id="cb2-4"><a href="#cb2-4" target="_self" aria-hidden="true" tabindex="-1"></a>  [<span class="at">:ns</span>_name</span>
<span id="cb2-5"><a href="#cb2-5" target="_self" aria-hidden="true" tabindex="-1"></a>   <span class="at">:text</span> [<span class="at">:not</span> <span class="va">nil</span>] [<span class="at">:unique</span>]</span>
<span id="cb2-6"><a href="#cb2-6" target="_self" aria-hidden="true" tabindex="-1"></a>   [<span class="at">:check</span> [<span class="at">:and</span></span>
<span id="cb2-7"><a href="#cb2-7" target="_self" aria-hidden="true" tabindex="-1"></a>            [:= <span class="at">:ns</span>_name [<span class="at">:trim</span> <span class="at">:ns</span>_name]]</span>
<span id="cb2-8"><a href="#cb2-8" target="_self" aria-hidden="true" tabindex="-1"></a>            [:= [<span class="at">:text</span>_split <span class="at">:ns</span>_name <span class="st">&quot;/&quot;</span> <span class="dv">2</span>] <span class="st">&quot;&quot;</span>]</span>
<span id="cb2-9"><a href="#cb2-9" target="_self" aria-hidden="true" tabindex="-1"></a>            [<span class="at">:or</span></span>
<span id="cb2-10"><a href="#cb2-10" target="_self" aria-hidden="true" tabindex="-1"></a>             [:= <span class="at">:ns</span>_name <span class="st">&quot;world&quot;</span>]</span>
<span id="cb2-11"><a href="#cb2-11" target="_self" aria-hidden="true" tabindex="-1"></a>             [:&lt;&gt; [<span class="at">:text</span>_split <span class="at">:ns</span>_name <span class="st">&quot;.&quot;</span> <span class="dv">2</span>] <span class="st">&quot;&quot;</span>]]]]</span>
<span id="cb2-12"><a href="#cb2-12" target="_self" aria-hidden="true" tabindex="-1"></a>   <span class="co">;; somehow we must enforce these names are globally unique</span></span>
<span id="cb2-13"><a href="#cb2-13" target="_self" aria-hidden="true" tabindex="-1"></a>   ]</span>
<span id="cb2-14"><a href="#cb2-14" target="_self" aria-hidden="true" tabindex="-1"></a>  [<span class="at">:is</span>_active <span class="at">:boolean</span> [<span class="at">:not</span> <span class="va">nil</span>] [<span class="at">:default</span> <span class="va">false</span>]</span>
<span id="cb2-15"><a href="#cb2-15" target="_self" aria-hidden="true" tabindex="-1"></a>   <span class="co">;; sometimes a namespace may be deactivated but kept around</span></span>
<span id="cb2-16"><a href="#cb2-16" target="_self" aria-hidden="true" tabindex="-1"></a>   ]</span>
<span id="cb2-17"><a href="#cb2-17" target="_self" aria-hidden="true" tabindex="-1"></a>  [<span class="at">:is</span>_deleted <span class="at">:boolean</span> [<span class="at">:not</span> <span class="va">nil</span>] [<span class="at">:default</span> <span class="va">false</span>]</span>
<span id="cb2-18"><a href="#cb2-18" target="_self" aria-hidden="true" tabindex="-1"></a>   <span class="co">;; true IFF the namespace *and every bit of its data*</span></span>
<span id="cb2-19"><a href="#cb2-19" target="_self" aria-hidden="true" tabindex="-1"></a>   <span class="co">;; was permanently erased</span></span>
<span id="cb2-20"><a href="#cb2-20" target="_self" aria-hidden="true" tabindex="-1"></a>   ]</span>
<span id="cb2-21"><a href="#cb2-21" target="_self" aria-hidden="true" tabindex="-1"></a>  [<span class="at">:ns</span>_meta <span class="at">:text</span></span>
<span id="cb2-22"><a href="#cb2-22" target="_self" aria-hidden="true" tabindex="-1"></a>   <span class="co">;; semi-regular information about the namespace / org.</span></span>
<span id="cb2-23"><a href="#cb2-23" target="_self" aria-hidden="true" tabindex="-1"></a>   <span class="co">;; {:org-name &quot;ACME Corp.&quot;</span></span>
<span id="cb2-24"><a href="#cb2-24" target="_self" aria-hidden="true" tabindex="-1"></a>   <span class="co">;;  :address {:street &quot;001&quot;</span></span>
<span id="cb2-25"><a href="#cb2-25" target="_self" aria-hidden="true" tabindex="-1"></a>   <span class="co">;;            :city &quot;Eta Omega&quot; ... }}</span></span>
<span id="cb2-26"><a href="#cb2-26" target="_self" aria-hidden="true" tabindex="-1"></a>   ]]}</span>
<span id="cb2-27"><a href="#cb2-27" target="_self" aria-hidden="true" tabindex="-1"></a></span></code></pre></div>
<h3 id="honeysql-constrain-world-users">HoneySQL: Constrain World Users</h3>
<figure>
<img src="./poor-mans-bitemporal-sqlite-db-world-users.png" />
<figcaption>"World Users".</figcaption>
</figure>
<p>All users must ID as fully-qualified name like <code>com.acmecorp/adi</code>, following the constraint of standard global namespacing (<code>some.name.space/the-name</code>).</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode clojure"><code class="sourceCode clojure"><span id="cb3-1"><a href="#cb3-1" target="_self" aria-hidden="true" tabindex="-1"></a>{<span class="at">:create-table</span> [<span class="at">:world</span>_users <span class="at">:if-not-exists</span>]</span>
<span id="cb3-2"><a href="#cb3-2" target="_self" aria-hidden="true" tabindex="-1"></a> <span class="at">:with-columns</span></span>
<span id="cb3-3"><a href="#cb3-3" target="_self" aria-hidden="true" tabindex="-1"></a> [[<span class="at">:rowid</span> <span class="at">:integer</span> <span class="at">:primary-key</span>]</span>
<span id="cb3-4"><a href="#cb3-4" target="_self" aria-hidden="true" tabindex="-1"></a>  [<span class="at">:ns</span>_user_id</span>
<span id="cb3-5"><a href="#cb3-5" target="_self" aria-hidden="true" tabindex="-1"></a>   <span class="at">:text</span> [<span class="at">:not</span> <span class="va">nil</span>] [<span class="at">:unique</span>]</span>
<span id="cb3-6"><a href="#cb3-6" target="_self" aria-hidden="true" tabindex="-1"></a>   [<span class="at">:check</span> [:= <span class="at">:ns</span>_user_id [<span class="at">:trim</span> <span class="at">:ns</span>_user_id]]]]</span>
<span id="cb3-7"><a href="#cb3-7" target="_self" aria-hidden="true" tabindex="-1"></a>  [<span class="at">:ns</span>_name</span>
<span id="cb3-8"><a href="#cb3-8" target="_self" aria-hidden="true" tabindex="-1"></a>   <span class="at">:text</span> [<span class="at">:not</span> <span class="va">nil</span>]</span>
<span id="cb3-9"><a href="#cb3-9" target="_self" aria-hidden="true" tabindex="-1"></a>   <span class="at">:generated-always</span> <span class="at">:as</span> [[<span class="at">:text</span>_split <span class="at">:ns</span>_user_id <span class="st">&quot;/&quot;</span> <span class="dv">1</span>]]</span>
<span id="cb3-10"><a href="#cb3-10" target="_self" aria-hidden="true" tabindex="-1"></a>   <span class="at">:stored</span>]</span>
<span id="cb3-11"><a href="#cb3-11" target="_self" aria-hidden="true" tabindex="-1"></a>  [<span class="at">:user</span>_name</span>
<span id="cb3-12"><a href="#cb3-12" target="_self" aria-hidden="true" tabindex="-1"></a>   <span class="at">:text</span> [<span class="at">:not</span> <span class="va">nil</span>]</span>
<span id="cb3-13"><a href="#cb3-13" target="_self" aria-hidden="true" tabindex="-1"></a>   <span class="at">:generated-always</span> <span class="at">:as</span> [[<span class="at">:text</span>_split <span class="at">:ns</span>_user_id <span class="st">&quot;/&quot;</span> <span class="dv">2</span>]]</span>
<span id="cb3-14"><a href="#cb3-14" target="_self" aria-hidden="true" tabindex="-1"></a>   <span class="at">:stored</span>]</span>
<span id="cb3-15"><a href="#cb3-15" target="_self" aria-hidden="true" tabindex="-1"></a>  [<span class="at">:user</span>_type <span class="at">:text</span> [<span class="at">:not</span> <span class="va">nil</span>] [<span class="at">:default</span> <span class="st">&quot;UNSPECIFIED&quot;</span>]</span>
<span id="cb3-16"><a href="#cb3-16" target="_self" aria-hidden="true" tabindex="-1"></a>   <span class="co">;; call it &quot;user_type&quot;, symmetric with &quot;entity_type&quot;,</span></span>
<span id="cb3-17"><a href="#cb3-17" target="_self" aria-hidden="true" tabindex="-1"></a>   <span class="co">;; because users are special case entities</span></span>
<span id="cb3-18"><a href="#cb3-18" target="_self" aria-hidden="true" tabindex="-1"></a>   <span class="co">;; :system/owner, :system/admin, :system/member, :system/bot</span></span>
<span id="cb3-19"><a href="#cb3-19" target="_self" aria-hidden="true" tabindex="-1"></a>   <span class="co">;; :org/owner, :org/admin, :org/member :org/bot</span></span>
<span id="cb3-20"><a href="#cb3-20" target="_self" aria-hidden="true" tabindex="-1"></a>   ]</span>
<span id="cb3-21"><a href="#cb3-21" target="_self" aria-hidden="true" tabindex="-1"></a>  [<span class="at">:is</span>_active <span class="at">:boolean</span> [<span class="at">:not</span> <span class="va">nil</span>] [<span class="at">:default</span> <span class="va">false</span>]</span>
<span id="cb3-22"><a href="#cb3-22" target="_self" aria-hidden="true" tabindex="-1"></a>   <span class="co">;; sometimes, a user may be deactivated</span></span>
<span id="cb3-23"><a href="#cb3-23" target="_self" aria-hidden="true" tabindex="-1"></a>   <span class="co">;; but kept around for &lt;reasons&gt;</span></span>
<span id="cb3-24"><a href="#cb3-24" target="_self" aria-hidden="true" tabindex="-1"></a>   ]</span>
<span id="cb3-25"><a href="#cb3-25" target="_self" aria-hidden="true" tabindex="-1"></a>  [<span class="at">:is</span>_deleted <span class="at">:boolean</span> [<span class="at">:not</span> <span class="va">nil</span>] [<span class="at">:default</span> <span class="va">false</span>]</span>
<span id="cb3-26"><a href="#cb3-26" target="_self" aria-hidden="true" tabindex="-1"></a>   <span class="co">;; signal that user and /every bit of user data/</span></span>
<span id="cb3-27"><a href="#cb3-27" target="_self" aria-hidden="true" tabindex="-1"></a>   <span class="co">;; was permanently erased</span></span>
<span id="cb3-28"><a href="#cb3-28" target="_self" aria-hidden="true" tabindex="-1"></a>   ]</span>
<span id="cb3-29"><a href="#cb3-29" target="_self" aria-hidden="true" tabindex="-1"></a>  [<span class="at">:ns</span>_user_meta <span class="at">:text</span></span>
<span id="cb3-30"><a href="#cb3-30" target="_self" aria-hidden="true" tabindex="-1"></a>   <span class="co">;; semi-regular information about the user</span></span>
<span id="cb3-31"><a href="#cb3-31" target="_self" aria-hidden="true" tabindex="-1"></a>   <span class="co">;; {:first_name &quot;Foo&quot; :last_name &quot;Bar&quot;</span></span>
<span id="cb3-32"><a href="#cb3-32" target="_self" aria-hidden="true" tabindex="-1"></a>   <span class="co">;;  :address {:flat &quot;001&quot; :city &quot;Lambda&quot; ... }}</span></span>
<span id="cb3-33"><a href="#cb3-33" target="_self" aria-hidden="true" tabindex="-1"></a>   ]</span>
<span id="cb3-34"><a href="#cb3-34" target="_self" aria-hidden="true" tabindex="-1"></a>  [[<span class="at">:foreign-key</span> <span class="at">:ns</span>_name]</span>
<span id="cb3-35"><a href="#cb3-35" target="_self" aria-hidden="true" tabindex="-1"></a>   [<span class="at">:references</span> <span class="at">:world</span>_namespaces <span class="at">:ns</span>_name]</span>
<span id="cb3-36"><a href="#cb3-36" target="_self" aria-hidden="true" tabindex="-1"></a>   <span class="co">;; We would like to strictly permit</span></span>
<span id="cb3-37"><a href="#cb3-37" target="_self" aria-hidden="true" tabindex="-1"></a>   <span class="co">;; only pre-registered global namespaces.</span></span>
<span id="cb3-38"><a href="#cb3-38" target="_self" aria-hidden="true" tabindex="-1"></a>   ]]}</span></code></pre></div>
<h3 id="honeysql-constrain-world-entities">HoneySQL: Constrain World Entities</h3>
<figure>
<img src="./poor-mans-bitemporal-sqlite-db-world-entities.png" />
<figcaption>"World Entities".</figcaption>
</figure>
<p>Entity namespacing is according to the global standard—<code>some.name.space/the-entity-name</code>—constrained by our namespaces schema. So entity IDs could be: <code>com.acme/adi,
com.acme/file, com.acme/category, com.acme/tag, com.acme/user-role</code>.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode clojure"><code class="sourceCode clojure"><span id="cb4-1"><a href="#cb4-1" target="_self" aria-hidden="true" tabindex="-1"></a>{<span class="at">:create-table</span> [<span class="at">:world</span>_entities <span class="at">:if-not-exists</span>]</span>
<span id="cb4-2"><a href="#cb4-2" target="_self" aria-hidden="true" tabindex="-1"></a> <span class="at">:with-columns</span></span>
<span id="cb4-3"><a href="#cb4-3" target="_self" aria-hidden="true" tabindex="-1"></a> [[<span class="at">:rowid</span> <span class="at">:integer</span> <span class="at">:primary-key</span>]</span>
<span id="cb4-4"><a href="#cb4-4" target="_self" aria-hidden="true" tabindex="-1"></a>  [<span class="at">:ns</span>_entity_id</span>
<span id="cb4-5"><a href="#cb4-5" target="_self" aria-hidden="true" tabindex="-1"></a>   <span class="at">:text</span> [<span class="at">:not</span> <span class="va">nil</span>] [<span class="at">:unique</span>]</span>
<span id="cb4-6"><a href="#cb4-6" target="_self" aria-hidden="true" tabindex="-1"></a>   [<span class="at">:check</span> [:= <span class="at">:ns</span>_entity_id [<span class="at">:trim</span> <span class="at">:ns</span>_entity_id]]]</span>
<span id="cb4-7"><a href="#cb4-7" target="_self" aria-hidden="true" tabindex="-1"></a>   <span class="co">;; com.acme/adi, com.acme/file, com.acme/category</span></span>
<span id="cb4-8"><a href="#cb4-8" target="_self" aria-hidden="true" tabindex="-1"></a>   <span class="co">;; com.acme/tag, com.acme/user-role</span></span>
<span id="cb4-9"><a href="#cb4-9" target="_self" aria-hidden="true" tabindex="-1"></a>   ]</span>
<span id="cb4-10"><a href="#cb4-10" target="_self" aria-hidden="true" tabindex="-1"></a>  [<span class="at">:ns</span>_name <span class="at">:text</span> [<span class="at">:not</span> <span class="va">nil</span>]</span>
<span id="cb4-11"><a href="#cb4-11" target="_self" aria-hidden="true" tabindex="-1"></a>   <span class="at">:generated-always</span> <span class="at">:as</span> [[<span class="at">:text</span>_split <span class="at">:ns</span>_entity_id <span class="st">&quot;/&quot;</span> <span class="dv">1</span>]]</span>
<span id="cb4-12"><a href="#cb4-12" target="_self" aria-hidden="true" tabindex="-1"></a>   <span class="at">:stored</span></span>
<span id="cb4-13"><a href="#cb4-13" target="_self" aria-hidden="true" tabindex="-1"></a>   <span class="co">;; com.acme</span></span>
<span id="cb4-14"><a href="#cb4-14" target="_self" aria-hidden="true" tabindex="-1"></a>   ]</span>
<span id="cb4-15"><a href="#cb4-15" target="_self" aria-hidden="true" tabindex="-1"></a>  [<span class="at">:entity</span>_name</span>
<span id="cb4-16"><a href="#cb4-16" target="_self" aria-hidden="true" tabindex="-1"></a>   <span class="at">:text</span> [<span class="at">:not</span> <span class="va">nil</span>]</span>
<span id="cb4-17"><a href="#cb4-17" target="_self" aria-hidden="true" tabindex="-1"></a>   <span class="at">:generated-always</span> <span class="at">:as</span> [[<span class="at">:text</span>_split <span class="at">:ns</span>_entity_id <span class="st">&quot;/&quot;</span> <span class="dv">2</span>]]</span>
<span id="cb4-18"><a href="#cb4-18" target="_self" aria-hidden="true" tabindex="-1"></a>   <span class="at">:stored</span></span>
<span id="cb4-19"><a href="#cb4-19" target="_self" aria-hidden="true" tabindex="-1"></a>   <span class="co">;; adi, file, category, tag, user-role</span></span>
<span id="cb4-20"><a href="#cb4-20" target="_self" aria-hidden="true" tabindex="-1"></a>   ]</span>
<span id="cb4-21"><a href="#cb4-21" target="_self" aria-hidden="true" tabindex="-1"></a>  [<span class="at">:entity</span>_type</span>
<span id="cb4-22"><a href="#cb4-22" target="_self" aria-hidden="true" tabindex="-1"></a>   <span class="at">:text</span> [<span class="at">:not</span> <span class="va">nil</span>]</span>
<span id="cb4-23"><a href="#cb4-23" target="_self" aria-hidden="true" tabindex="-1"></a>   [<span class="at">:default</span> <span class="st">&quot;UNSPECIFIED&quot;</span>]</span>
<span id="cb4-24"><a href="#cb4-24" target="_self" aria-hidden="true" tabindex="-1"></a>   <span class="co">;; &quot;:user/actor&quot; &quot;:user/role&quot; &quot;:content/file&quot;</span></span>
<span id="cb4-25"><a href="#cb4-25" target="_self" aria-hidden="true" tabindex="-1"></a>   <span class="co">;; &quot;:content/category&quot; &quot;:content/tag&quot;</span></span>
<span id="cb4-26"><a href="#cb4-26" target="_self" aria-hidden="true" tabindex="-1"></a>   ]</span>
<span id="cb4-27"><a href="#cb4-27" target="_self" aria-hidden="true" tabindex="-1"></a>  [<span class="at">:is</span>_active</span>
<span id="cb4-28"><a href="#cb4-28" target="_self" aria-hidden="true" tabindex="-1"></a>   <span class="at">:boolean</span> [<span class="at">:not</span> <span class="va">nil</span>]</span>
<span id="cb4-29"><a href="#cb4-29" target="_self" aria-hidden="true" tabindex="-1"></a>   [<span class="at">:default</span> <span class="va">false</span>]</span>
<span id="cb4-30"><a href="#cb4-30" target="_self" aria-hidden="true" tabindex="-1"></a>   <span class="co">;; sometimes a entity may be deactivated but kept around</span></span>
<span id="cb4-31"><a href="#cb4-31" target="_self" aria-hidden="true" tabindex="-1"></a>   ]</span>
<span id="cb4-32"><a href="#cb4-32" target="_self" aria-hidden="true" tabindex="-1"></a>  [<span class="at">:is</span>_deleted</span>
<span id="cb4-33"><a href="#cb4-33" target="_self" aria-hidden="true" tabindex="-1"></a>   <span class="at">:boolean</span></span>
<span id="cb4-34"><a href="#cb4-34" target="_self" aria-hidden="true" tabindex="-1"></a>   [<span class="at">:not</span> <span class="va">nil</span>] [<span class="at">:default</span> <span class="va">false</span>]</span>
<span id="cb4-35"><a href="#cb4-35" target="_self" aria-hidden="true" tabindex="-1"></a>   <span class="co">;; signals that entity and all entity data may be garbage-collected</span></span>
<span id="cb4-36"><a href="#cb4-36" target="_self" aria-hidden="true" tabindex="-1"></a>   ]</span>
<span id="cb4-37"><a href="#cb4-37" target="_self" aria-hidden="true" tabindex="-1"></a>  [<span class="at">:ns</span>_entity_meta <span class="at">:text</span>]</span>
<span id="cb4-38"><a href="#cb4-38" target="_self" aria-hidden="true" tabindex="-1"></a>  [[<span class="at">:foreign-key</span> <span class="at">:ns</span>_name]</span>
<span id="cb4-39"><a href="#cb4-39" target="_self" aria-hidden="true" tabindex="-1"></a>   [<span class="at">:references</span> <span class="at">:world</span>_namespaces <span class="at">:ns</span>_name]]]}</span></code></pre></div>
<h2 id="datomic-single-thread-writes-concurrent-reads">Datomic: Single-thread writes, concurrent reads</h2>
<p>SQLite in WAL mode is the poor man's single-computer Datomic—one sequential writer, many concurrent readers, mutually non-blocking, with globally atomic transactions. To be clear, Datomic itself can be the poor man's single-computer Datomic. Ditto for XTDB and Rama. Clojure programmers will do well to study the Clojure <code>agent</code> primitive, to build a good mental model about SQLite in WAL mode.</p>
<h3 id="code-saasy-sqlite-configuration">Code: SaaSy SQLite Configuration</h3>
<p>Some recommended <code>PRAGMA</code> settings to use SQLite as a web backend.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode clojure"><code class="sourceCode clojure"><span id="cb5-1"><a href="#cb5-1" target="_self" aria-hidden="true" tabindex="-1"></a>{<span class="at">:dbtype</span> <span class="st">&quot;sqlite&quot;</span></span>
<span id="cb5-2"><a href="#cb5-2" target="_self" aria-hidden="true" tabindex="-1"></a> <span class="co">;; INCREMENTAL = 2. Set manually. Not supported by xerial.</span></span>
<span id="cb5-3"><a href="#cb5-3" target="_self" aria-hidden="true" tabindex="-1"></a> <span class="at">:auto</span>_vacuum <span class="st">&quot;INCREMENTAL&quot;</span></span>
<span id="cb5-4"><a href="#cb5-4" target="_self" aria-hidden="true" tabindex="-1"></a> <span class="at">:connectionTestQuery</span> <span class="st">&quot;PRAGMA journal_mode;&quot;</span> <span class="co">; used by HikariCP</span></span>
<span id="cb5-5"><a href="#cb5-5" target="_self" aria-hidden="true" tabindex="-1"></a> <span class="at">:preferredTestQuery</span> <span class="st">&quot;PRAGMA journal_mode;&quot;</span> <span class="co">; used by C3P0</span></span>
<span id="cb5-6"><a href="#cb5-6" target="_self" aria-hidden="true" tabindex="-1"></a> <span class="co">;; :maximumPoolSize max-concurrency ; not supported by Xerial</span></span>
<span id="cb5-7"><a href="#cb5-7" target="_self" aria-hidden="true" tabindex="-1"></a> <span class="at">:dataSourceProperties</span></span>
<span id="cb5-8"><a href="#cb5-8" target="_self" aria-hidden="true" tabindex="-1"></a> {<span class="at">:limit</span>_worker_threads <span class="dv">4</span></span>
<span id="cb5-9"><a href="#cb5-9" target="_self" aria-hidden="true" tabindex="-1"></a>  <span class="at">:enable</span>_load_extension <span class="va">true</span> <span class="co">; disabled by default for security</span></span>
<span id="cb5-10"><a href="#cb5-10" target="_self" aria-hidden="true" tabindex="-1"></a>  <span class="at">:busy</span>_timeout <span class="dv">5000</span> <span class="co">; ms, set per connection</span></span>
<span id="cb5-11"><a href="#cb5-11" target="_self" aria-hidden="true" tabindex="-1"></a>  <span class="at">:foreign</span>_keys <span class="st">&quot;ON&quot;</span> <span class="co">; ON = boolean 1, set per connection</span></span>
<span id="cb5-12"><a href="#cb5-12" target="_self" aria-hidden="true" tabindex="-1"></a>  <span class="at">:cache</span>_size -<span class="dv">50000</span> <span class="co">; KiB = 50 MiB, set per connection</span></span>
<span id="cb5-13"><a href="#cb5-13" target="_self" aria-hidden="true" tabindex="-1"></a>  <span class="at">:journal</span>_mode <span class="st">&quot;WAL&quot;</span> <span class="co">; supported by xerial JDBC driver</span></span>
<span id="cb5-14"><a href="#cb5-14" target="_self" aria-hidden="true" tabindex="-1"></a>  <span class="co">;; NORMAL = 1, set per connection</span></span>
<span id="cb5-15"><a href="#cb5-15" target="_self" aria-hidden="true" tabindex="-1"></a>  <span class="at">:synchronous</span> <span class="st">&quot;NORMAL&quot;</span>}}</span></code></pre></div>
<p><code>* nb.</code> Some <code>PRAGMAS</code> are set at the DB level, and others are set on a per-connection basis. I'm using HikariCP connection pooling library to help me do this cleanly (paired with xerial's JDBC driver for SQLite).</p>
<p>However, I <em>might</em> be able to drop HikariCP… the spirit of "fewer dependencies, better life" is hard to ignore. Just look at <a href="https://andersmurphy.com/">Anders Murphy</a>'s <em>neato</em> work on <a href="https://github.com/andersmurphy/hyperlith">hyperlith</a> ("the hypermedia based monolith", using Datastar and Clojure), and <a href="https://github.com/andersmurphy/sqlite4clj">sqlite4clj</a>. See the hyperlith examples, particularly OneBillionCells: <a href="https://github.com/andersmurphy/hyperlith/tree/master/examples/billion_cells">code</a>, <a href="https://cells.andersmurphy.com/">demo</a>. Rad!</p>
<h2 id="xtdb-all-facts-are-bitemporal-by-design">XTDB: All facts are bitemporal by design</h2>
<p>The full, faithfully recorded, append-only log of world facts, as claimed by any of the pre-registered users, about any of the pre-registered entities, belonging to pre-registered namespaces.</p>
<h3 id="honeysql-our-central-append-only-world-facts-table">HoneySQL: Our central append-only "World Facts" table</h3>
<figure>
<img src="./poor-mans-bitemporal-sqlite-db-world-facts.png" />
<figcaption>"World Facts".</figcaption>
</figure>
<div class="sourceCode" id="cb6"><pre class="sourceCode clojure"><code class="sourceCode clojure"><span id="cb6-1"><a href="#cb6-1" target="_self" aria-hidden="true" tabindex="-1"></a>{<span class="at">:create-table</span> [<span class="at">:world</span>_facts <span class="at">:if-not-exists</span>]</span>
<span id="cb6-2"><a href="#cb6-2" target="_self" aria-hidden="true" tabindex="-1"></a> <span class="at">:with-columns</span></span>
<span id="cb6-3"><a href="#cb6-3" target="_self" aria-hidden="true" tabindex="-1"></a> [[<span class="at">:rowid</span> <span class="at">:integer</span> <span class="at">:primary-key</span>]</span>
<span id="cb6-4"><a href="#cb6-4" target="_self" aria-hidden="true" tabindex="-1"></a>  [<span class="at">:txn</span>_id <span class="at">:numeric</span> [<span class="at">:not</span> <span class="va">nil</span>]</span>
<span id="cb6-5"><a href="#cb6-5" target="_self" aria-hidden="true" tabindex="-1"></a>   <span class="co">;; MUST be a uuidv7</span></span>
<span id="cb6-6"><a href="#cb6-6" target="_self" aria-hidden="true" tabindex="-1"></a>   ]</span>
<span id="cb6-7"><a href="#cb6-7" target="_self" aria-hidden="true" tabindex="-1"></a>  [<span class="at">:valid</span>_id</span>
<span id="cb6-8"><a href="#cb6-8" target="_self" aria-hidden="true" tabindex="-1"></a>   <span class="at">:numeric</span> [<span class="at">:not</span> <span class="va">nil</span>]</span>
<span id="cb6-9"><a href="#cb6-9" target="_self" aria-hidden="true" tabindex="-1"></a>   <span class="at">:unique</span> [<span class="at">:default</span> [[<span class="at">:uuid7</span>]]]</span>
<span id="cb6-10"><a href="#cb6-10" target="_self" aria-hidden="true" tabindex="-1"></a>   ]</span>
<span id="cb6-11"><a href="#cb6-11" target="_self" aria-hidden="true" tabindex="-1"></a>  [<span class="at">:txn</span>_time</span>
<span id="cb6-12"><a href="#cb6-12" target="_self" aria-hidden="true" tabindex="-1"></a>   <span class="at">:numeric</span> [<span class="at">:not</span> <span class="va">nil</span>]</span>
<span id="cb6-13"><a href="#cb6-13" target="_self" aria-hidden="true" tabindex="-1"></a>   <span class="at">:generated-always</span> <span class="at">:as</span> [[<span class="at">:uuid7</span>_timestamp_ms <span class="at">:txn</span>_id]]</span>
<span id="cb6-14"><a href="#cb6-14" target="_self" aria-hidden="true" tabindex="-1"></a>   <span class="at">:stored</span>]</span>
<span id="cb6-15"><a href="#cb6-15" target="_self" aria-hidden="true" tabindex="-1"></a>  [<span class="at">:valid</span>_time</span>
<span id="cb6-16"><a href="#cb6-16" target="_self" aria-hidden="true" tabindex="-1"></a>   <span class="at">:numeric</span> [<span class="at">:not</span> <span class="va">nil</span>]</span>
<span id="cb6-17"><a href="#cb6-17" target="_self" aria-hidden="true" tabindex="-1"></a>   <span class="at">:generated-always</span> <span class="at">:as</span> [[<span class="at">:uuid7</span>_timestamp_ms <span class="at">:valid</span>_id]]</span>
<span id="cb6-18"><a href="#cb6-18" target="_self" aria-hidden="true" tabindex="-1"></a>   <span class="at">:stored</span>]</span>
<span id="cb6-19"><a href="#cb6-19" target="_self" aria-hidden="true" tabindex="-1"></a>  [<span class="at">:valid</span>_preferred</span>
<span id="cb6-20"><a href="#cb6-20" target="_self" aria-hidden="true" tabindex="-1"></a>   <span class="at">:boolean</span> [<span class="at">:not</span> <span class="va">nil</span>]</span>
<span id="cb6-21"><a href="#cb6-21" target="_self" aria-hidden="true" tabindex="-1"></a>   [<span class="at">:default</span> <span class="va">false</span>]</span>
<span id="cb6-22"><a href="#cb6-22" target="_self" aria-hidden="true" tabindex="-1"></a>   <span class="co">;; use this /mutably/ to resolve conflicting valid timelines</span></span>
<span id="cb6-23"><a href="#cb6-23" target="_self" aria-hidden="true" tabindex="-1"></a>   ]</span>
<span id="cb6-24"><a href="#cb6-24" target="_self" aria-hidden="true" tabindex="-1"></a>  [<span class="at">:e</span> <span class="at">:text</span> [<span class="at">:not</span> <span class="va">nil</span>]] <span class="co">; Entity</span></span>
<span id="cb6-25"><a href="#cb6-25" target="_self" aria-hidden="true" tabindex="-1"></a>  [<span class="at">:a</span> <span class="at">:text</span> [<span class="at">:not</span> <span class="va">nil</span>]] <span class="co">; Attribute</span></span>
<span id="cb6-26"><a href="#cb6-26" target="_self" aria-hidden="true" tabindex="-1"></a>  [<span class="at">:v</span> <span class="at">:numeric</span>]         <span class="co">; Value</span></span>
<span id="cb6-27"><a href="#cb6-27" target="_self" aria-hidden="true" tabindex="-1"></a>  [<span class="at">:assert</span> <span class="at">:boolean</span> [<span class="at">:not</span> <span class="va">nil</span>]]</span>
<span id="cb6-28"><a href="#cb6-28" target="_self" aria-hidden="true" tabindex="-1"></a>  [<span class="at">:ns</span>_user_ref <span class="at">:numeric</span> [<span class="at">:not</span> <span class="va">nil</span>]]</span>
<span id="cb6-29"><a href="#cb6-29" target="_self" aria-hidden="true" tabindex="-1"></a>  [<span class="at">:fact</span>_meta <span class="at">:numeric</span></span>
<span id="cb6-30"><a href="#cb6-30" target="_self" aria-hidden="true" tabindex="-1"></a>   <span class="co">;; Use this to /mutably/ attach auditor notes to history data.</span></span>
<span id="cb6-31"><a href="#cb6-31" target="_self" aria-hidden="true" tabindex="-1"></a>   <span class="co">;; Maybe track addition of the auditor note as a new fact.</span></span>
<span id="cb6-32"><a href="#cb6-32" target="_self" aria-hidden="true" tabindex="-1"></a>   ]</span>
<span id="cb6-33"><a href="#cb6-33" target="_self" aria-hidden="true" tabindex="-1"></a>  [[<span class="at">:foreign-key</span> <span class="at">:ns</span>_user_ref]</span>
<span id="cb6-34"><a href="#cb6-34" target="_self" aria-hidden="true" tabindex="-1"></a>   [<span class="at">:references</span> <span class="at">:world</span>_users <span class="at">:ns</span>_user_id]</span>
<span id="cb6-35"><a href="#cb6-35" target="_self" aria-hidden="true" tabindex="-1"></a>   <span class="co">;; Permit facts only from known, pre-registered users.</span></span>
<span id="cb6-36"><a href="#cb6-36" target="_self" aria-hidden="true" tabindex="-1"></a>   [<span class="at">:foreign-key</span> <span class="at">:e</span>]</span>
<span id="cb6-37"><a href="#cb6-37" target="_self" aria-hidden="true" tabindex="-1"></a>   [<span class="at">:references</span> <span class="at">:world</span>_entities <span class="at">:ns</span>_entity_id]</span>
<span id="cb6-38"><a href="#cb6-38" target="_self" aria-hidden="true" tabindex="-1"></a>   <span class="co">;; Permit facts only about known, pre-registered entities.</span></span>
<span id="cb6-39"><a href="#cb6-39" target="_self" aria-hidden="true" tabindex="-1"></a>   ]]}</span></code></pre></div>
<h2 id="realities-are-arrows.-time-marks-flight.-uuidv7-is-time.">Realities are arrows. Time marks flight. UUIDv7 is Time.</h2>
<p>Processes are happening. Facts are being recorded. Events occur along a <em>virtual timeline</em>, not a physical one.</p>
<p>Instead of compositing a physical time and a virtual ID into one identifier, why not use a virtual time-is-a-vector style identifier and derive physical time from it for use in our normal day to day SQL queries, <em>in addition to</em> also having an identifier that is a standard requiring no coordination to create, is globally conflict-free, <em>and</em> is SQL DB indexing-friendly as well as query-friendly? In a world where disks are cheap, and data generation is unlimited, we can afford to waste computer resources on giant IDs instead of compact little Integers that overflow.</p>
<p>UUIDv7 helps us express this concept. This is <em>crucial</em> for conflict management.</p>
<p>Our system relies on the <em>guarantee</em> that <code>valid_id</code> is <em>globally unique</em>, even when the UNIX time component of <code>valid-id</code> for multiple colliding facts is the same.</p>
<p>The default decision heuristic is "latest asserted fact wins". The "last write wins" principle is popularly used by the local-first community too (e.g. in CRDTs).</p>
<p>Of course, this thumb rule is not always acceptable. Humans will disagree about the facts for un-computable reasons.</p>
<p>For example, different editors at the publisher <em>Target</em> may lay different claims to the same titular character name: claim conflicting values, and/or different asserted states. Now they have to duke it out and decide which assertion or redaction should apply for that EA pair at a given physical time.</p>
<table>
<thead>
<tr class="header">
<th><code class="verbatim">valid_ID</code></th>
<th>e</th>
<th>a</th>
<th>v</th>
<th><code class="verbatim">owner_ref</code></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>01978840-4816-787c-8aab-d39bd088754b</td>
<td>character-id-42</td>
<td>character/name</td>
<td>The Tenth Doctor</td>
<td>com.target/editor-alpha</td>
</tr>
<tr class="even">
<td>01978840-4816-787c-8efg-r8235asdf3rb</td>
<td>character-id-42</td>
<td>character/name</td>
<td>Dr. Who</td>
<td>com.target/editor-bravo</td>
</tr>
<tr class="odd">
<td>01978840-4816-787c-098a-757o8ujygasf</td>
<td>character-id-42</td>
<td>character/name</td>
<td>The Doctor</td>
<td>com.target/editor-charlie</td>
</tr>
</tbody>
</table>
<hr />
<p>The tie-break may be <em>"We compromise on this particular version of facts"</em>"</p>
<div class="sourceCode" id="cb7" data-org-language="sqlite"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb7-1"><a href="#cb7-1" target="_self" aria-hidden="true" tabindex="-1"></a><span class="kw">select</span> <span class="op">*</span> <span class="kw">from</span> world_facts</span>
<span id="cb7-2"><a href="#cb7-2" target="_self" aria-hidden="true" tabindex="-1"></a><span class="kw">where</span> valid_id <span class="op">=</span> <span class="st">&#39;01978840-4816-787c-8aab-d39bd088754b&#39;</span>;<span class="ot">&quot;</span></span></code></pre></div>
<p>We break the tie in our <code>world_facts</code> table, using a boolean column, <code>valid_preferred</code>. We allow in-place updates to this field because that makes life simpler. Alternative tie-break choices:</p>
<ul>
<li><em>"We hereby decree that such-and-such is the preferred version of the facts to use for all as-of queries."</em></li>
</ul>
<div class="sourceCode" id="cb8" data-org-language="sqlite"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb8-1"><a href="#cb8-1" target="_self" aria-hidden="true" tabindex="-1"></a><span class="kw">update</span> world_facts <span class="kw">set</span> valid_preferred <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb8-2"><a href="#cb8-2" target="_self" aria-hidden="true" tabindex="-1"></a><span class="kw">where</span> valid_id <span class="op">=</span> <span class="st">&#39;01978840-4816-787c-8aab-d39bd088754b&#39;</span>;</span></code></pre></div>
<ul>
<li><em>"First dibs wins"</em>, based on the transaction ID of the E/A pair.</li>
</ul>
<div class="sourceCode" id="cb9" data-org-language="sqlite"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb9-1"><a href="#cb9-1" target="_self" aria-hidden="true" tabindex="-1"></a><span class="kw">update</span> world_facts <span class="kw">set</span> valid_preferred <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb9-2"><a href="#cb9-2" target="_self" aria-hidden="true" tabindex="-1"></a><span class="kw">where</span> e <span class="op">=</span> <span class="st">&#39;character-id-42&#39;</span> <span class="kw">and</span></span>
<span id="cb9-3"><a href="#cb9-3" target="_self" aria-hidden="true" tabindex="-1"></a>      a <span class="op">=</span><span class="st">&#39;character/name&#39;</span> <span class="kw">and</span></span>
<span id="cb9-4"><a href="#cb9-4" target="_self" aria-hidden="true" tabindex="-1"></a>      txn_id <span class="op">=</span> <span class="st">&#39;01978840-4816-787c-8aab-d39bd088754b&#39;</span>;</span></code></pre></div>
<ul>
<li><em>"Only use Charlie's choice names for the character; henceforth and retroactively."</em></li>
</ul>
<div class="sourceCode" id="cb10" data-org-language="sqlite"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb10-1"><a href="#cb10-1" target="_self" aria-hidden="true" tabindex="-1"></a><span class="kw">update</span> world_facts <span class="kw">set</span> valid_preferred <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb10-2"><a href="#cb10-2" target="_self" aria-hidden="true" tabindex="-1"></a><span class="kw">where</span> e <span class="op">=</span> <span class="st">&#39;character-id-42&#39;</span> <span class="kw">and</span></span>
<span id="cb10-3"><a href="#cb10-3" target="_self" aria-hidden="true" tabindex="-1"></a>      a <span class="op">=</span><span class="st">&#39;character/name&#39;</span> <span class="kw">and</span></span>
<span id="cb10-4"><a href="#cb10-4" target="_self" aria-hidden="true" tabindex="-1"></a>      owner_ref <span class="op">=</span> <span class="st">&#39;com.target/editor-charlie&#39;</span>;</span></code></pre></div>
<p><code>nb.</code> A proper setter query must ensure <code>valid_preferred</code> is set to <code>true</code> for <em>exactly one</em> <code>world_fact</code>, in a set of disputed colliding facts. <em>And</em> it should <em>append a new <code>world_fact</code></em>, stating for the record, that such-and-such <code>valid_id</code> was set to <code>valid_preferred =
true</code> at such-and-such time, by such-and-such user.</p>
<h3 id="honeysql-current-db-is-just-a-view-of-valid-world-facts-as-of-now">HoneySQL: Current DB is just a VIEW of valid World Facts as-of-now</h3>
<figure>
<img src="./poor-mans-bitemporal-sqlite-db-world-facts-as-of-now.png" />
<figcaption>The Current Database: "World Facts As Of Now".</figcaption>
</figure>
<p>SQLite's window queries are handy!</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode clojure"><code class="sourceCode clojure"><span id="cb11-1"><a href="#cb11-1" target="_self" aria-hidden="true" tabindex="-1"></a>{<span class="at">:create-view</span> [<span class="at">:world</span>_facts_as_of_now <span class="at">:if-not-exists</span>]</span>
<span id="cb11-2"><a href="#cb11-2" target="_self" aria-hidden="true" tabindex="-1"></a> <span class="at">:select</span> [<span class="at">:rowid</span></span>
<span id="cb11-3"><a href="#cb11-3" target="_self" aria-hidden="true" tabindex="-1"></a>          <span class="at">:txn</span>_time <span class="at">:valid</span>_time</span>
<span id="cb11-4"><a href="#cb11-4" target="_self" aria-hidden="true" tabindex="-1"></a>          <span class="at">:e</span> <span class="at">:a</span> <span class="at">:v</span></span>
<span id="cb11-5"><a href="#cb11-5" target="_self" aria-hidden="true" tabindex="-1"></a>          <span class="at">:ns</span>_user_ref <span class="at">:fact</span>_meta]</span>
<span id="cb11-6"><a href="#cb11-6" target="_self" aria-hidden="true" tabindex="-1"></a> <span class="at">:from</span> {<span class="at">:select</span> [:*</span>
<span id="cb11-7"><a href="#cb11-7" target="_self" aria-hidden="true" tabindex="-1"></a>                 [[<span class="at">:over</span></span>
<span id="cb11-8"><a href="#cb11-8" target="_self" aria-hidden="true" tabindex="-1"></a>                   [[<span class="at">:row</span>_number]</span>
<span id="cb11-9"><a href="#cb11-9" target="_self" aria-hidden="true" tabindex="-1"></a>                    {<span class="at">:partition-by</span> [<span class="at">:e</span> <span class="at">:a</span>],</span>
<span id="cb11-10"><a href="#cb11-10" target="_self" aria-hidden="true" tabindex="-1"></a>                     <span class="at">:order-by</span> [[<span class="at">:valid</span>_preferred <span class="at">:desc</span>]</span>
<span id="cb11-11"><a href="#cb11-11" target="_self" aria-hidden="true" tabindex="-1"></a>                                [<span class="at">:txn</span>_id <span class="at">:desc</span>]]}</span>
<span id="cb11-12"><a href="#cb11-12" target="_self" aria-hidden="true" tabindex="-1"></a>                    <span class="at">:row</span>_num]]]]</span>
<span id="cb11-13"><a href="#cb11-13" target="_self" aria-hidden="true" tabindex="-1"></a>        <span class="at">:from</span> <span class="at">:world</span>_facts}</span>
<span id="cb11-14"><a href="#cb11-14" target="_self" aria-hidden="true" tabindex="-1"></a> <span class="at">:where</span> [<span class="at">:and</span> [:= <span class="at">:row</span>_num <span class="dv">1</span>] [:= <span class="at">:assert</span> <span class="dv">1</span>]]</span>
<span id="cb11-15"><a href="#cb11-15" target="_self" aria-hidden="true" tabindex="-1"></a> <span class="at">:order-by</span> [[<span class="at">:rowid</span> <span class="at">:asc</span>]]}</span>
<span id="cb11-16"><a href="#cb11-16" target="_self" aria-hidden="true" tabindex="-1"></a></span></code></pre></div>
<h3 id="honeysql-current-db-indices-and-full-text-search-for-great-good">HoneySQL: Current DB: Indices and Full Text Search for great good</h3>
<p>The DDLs are elided because they are boring.</p>
<p><strong>Indices:</strong> Basically, we may create reverse indices of Facts, to support query patterns, as needed. Some possible indices for day-to-day "online" use, to be created on the "current world facts" view.</p>
<ul>
<li>EAV: Entity, Attribute, Value</li>
<li>EAVTx: EAV, TransactionTime</li>
<li>AEVTx</li>
<li>AVETx</li>
<li>VxAETx: ValidTime, AETx</li>
</ul>
<p>Normally, we wouldn't want to touch our lynchpin "World Facts" table. Indices consume disk space and that table will grow fast. The same indices might be required for retroactive "audit" use cases. Ideally I would do this sort of querying "offline", against a snapshot of the primary DB.</p>
<p><strong>For Full Text Search</strong>, I intend to use SQLite's built-in 'FTS5' extension. It requires a bit of SQL writin'—make a Virtual Table, and then write a bunch of Triggers to keep it up-to date. Again, very boring SQL, well documented at the <a href="https://sqlite.org/fts5.html">extension's page</a>. It just needs writing, is all.</p>
<p>Something like this…</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode clojure"><code class="sourceCode clojure"><span id="cb12-1"><a href="#cb12-1" target="_self" aria-hidden="true" tabindex="-1"></a>(<span class="bu">defn</span><span class="fu"> search-world-facts-as-of-now</span></span>
<span id="cb12-2"><a href="#cb12-2" target="_self" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Run the given search query against the FTS table and</span></span>
<span id="cb12-3"><a href="#cb12-3" target="_self" aria-hidden="true" tabindex="-1"></a><span class="st">   return a match from the original world_facts table.&quot;</span></span>
<span id="cb12-4"><a href="#cb12-4" target="_self" aria-hidden="true" tabindex="-1"></a>  ([where-search-clause-raw-sql]</span>
<span id="cb12-5"><a href="#cb12-5" target="_self" aria-hidden="true" tabindex="-1"></a>   (search-world-facts-as-of-now</span>
<span id="cb12-6"><a href="#cb12-6" target="_self" aria-hidden="true" tabindex="-1"></a>    (<span class="kw">partial</span> <span class="kw">format</span> <span class="st">&quot;fts_world_facts_as_of_now MATCH %s&quot;</span>)</span>
<span id="cb12-7"><a href="#cb12-7" target="_self" aria-hidden="true" tabindex="-1"></a>    where-search-clause-raw-sql))</span>
<span id="cb12-8"><a href="#cb12-8" target="_self" aria-hidden="true" tabindex="-1"></a>  ([search-term-formatter where-search-clause-raw-sql]</span>
<span id="cb12-9"><a href="#cb12-9" target="_self" aria-hidden="true" tabindex="-1"></a>   (hsql/format</span>
<span id="cb12-10"><a href="#cb12-10" target="_self" aria-hidden="true" tabindex="-1"></a>    {<span class="at">:select</span> [<span class="at">:world</span>_facts.<span class="kw">*</span>]</span>
<span id="cb12-11"><a href="#cb12-11" target="_self" aria-hidden="true" tabindex="-1"></a>     <span class="at">:from</span> [<span class="at">:fts</span>_world_facts_as_of_now]</span>
<span id="cb12-12"><a href="#cb12-12" target="_self" aria-hidden="true" tabindex="-1"></a>     <span class="at">:join</span> [<span class="at">:world</span>_facts</span>
<span id="cb12-13"><a href="#cb12-13" target="_self" aria-hidden="true" tabindex="-1"></a>            [:=</span>
<span id="cb12-14"><a href="#cb12-14" target="_self" aria-hidden="true" tabindex="-1"></a>             <span class="at">:fts</span>_world_facts_as_of_now.rowid</span>
<span id="cb12-15"><a href="#cb12-15" target="_self" aria-hidden="true" tabindex="-1"></a>             <span class="at">:world</span>_facts.rowid]]</span>
<span id="cb12-16"><a href="#cb12-16" target="_self" aria-hidden="true" tabindex="-1"></a>     <span class="at">:where</span> [<span class="at">:raw</span> (search-term-formatter</span>
<span id="cb12-17"><a href="#cb12-17" target="_self" aria-hidden="true" tabindex="-1"></a>                   where-search-clause-raw-sql)]</span>
<span id="cb12-18"><a href="#cb12-18" target="_self" aria-hidden="true" tabindex="-1"></a>     <span class="at">:order-by</span> [<span class="at">:rank</span>]}</span>
<span id="cb12-19"><a href="#cb12-19" target="_self" aria-hidden="true" tabindex="-1"></a>    {<span class="at">:inline</span> <span class="va">true</span>})))</span></code></pre></div>
<h2 id="rama-views-are-just-data.-materialize-in-clojure.-not-in-sql.">Rama: Views are just data. Materialize in Clojure. Not in SQL.</h2>
<p>The temporal database does not discriminate when storing facts. Consequently, any given temporal database could contain any of…</p>
<ul>
<li>At least a partial snapshot of at least one Reality,</li>
<li>OR several partial snapshots of one Reality,</li>
<li>OR several partial snapshots of several, possibly alternate and parallel, Realities.</li>
</ul>
<p>The great power (and great responsibility) to decide the <em>concretely materialised reality of the world</em> resides solely in the hands of the party interrogating the temporal database.</p>
<p>Therefore, the temporal database designer must create interrogation tools (query languages, data storage and access formats etc.) so the temporal data engineer can sift through a veritable multiverse, to figure out what "the world" looked like <em>as of <strong>whatever</strong> time</em> interests them.</p>
<p>I have been warned that attempting temporal queries with SQL will cause obnoxious joins, strange indexing schemes, finicky triggers, stored procedures from hell, and non-standard shenanigans specific to the database engine in question. <a href="#fn15" target="_self" class="footnote-ref" id="fnref15" role="doc-noteref"><sup>15</sup></a>.</p>
<p>See James Henderson's <em>"Building a Bitemporal Index"</em> series—parts <a href="https://xtdb.com/blog/building-a-bitemp-index-1-taxonomy">one</a>, <a href="https://xtdb.com/blog/building-a-bitemp-index-2-resolution">two</a>, and <a href="https://xtdb.com/blog/building-a-bitemp-index-3-storage">three</a>—to get a flavour of temporal query patterns that challenge current databases as well as current data engineers. Haunting questions like <em>Why do you need to use a database with bitemporality baked in anyway?</em></p>
<p>Fortunately, <em>if we play our cards right</em>, this all-you-can-eat pedantic fact-recording can help us create truly general-purpose data systems. For example, <a href="https://github.com/redplanetlabs/specter">Specter</a> is a <a href="https://blog.redplanetlabs.com/2024/04/30/rama-is-a-testament-to-the-power-of-clojure/">critical piece of Rama's query infrastructure</a>, allowing the system to cheaply query materialised views.</p>
<blockquote>
<p>A lot of Rama programming revolves around materializing views (PStates), which are literally just data structures interacted with using the exact same Specter API as used to interact with in-memory data structures. This stands in stark contrast with databases, which have fixed data models and special APIs for interacting with them. Any database can be replicated in a PState in both expressivity and performance, since a data model is just a specific combination of data structures (e.g. key/value is a map, column-oriented is a map of sorted maps, document is a map of maps, etc.).</p>
</blockquote>
<p>We will <em>embed all on-demand views in code</em>, using plain ol' Clojure transducers and/or Specter's capabilities.</p>
<p>This endows our vertically integrated tiny-SaaS system with the Poor Man's cheap copy of <a href="https://redplanetlabs.com/docs/~/tutorial3.html#task-model">Rama's task model</a> of distributed programming.</p>
<ul>
<li>Views always travel with the web application.</li>
<li>The database is always in-process.</li>
<li>The data file itself is always machine-local.</li>
<li>Each tenant gets their own dedicated SQLite database.</li>
</ul>
<p>Further, it means that <em>migrations occur NOT by futzing with database schemas, but by rolling out a new version of application code</em>.</p>
<p>So, <em>if</em> the database architecture and schema never changes, and I don't screw up writing to it, then I should never ever need to run a schema migration. In the off-chance that I do need to physically migrate schema, I will be forced to do it in an append-only way, because that's how SQLite data migrations work the best and safest. Which is a good corner to box oneself into, because it forces us to do <em>nondestructive</em> migrations, be they of schema or of data. This makes gradual roll-outs and complete roll-backs fairly safe.</p>
<p>SQLite has one more compelling feature.</p>
<h2 id="sqlite-flexible-typing-for-the-win">SQLite: Flexible typing for the win</h2>
<p>Without this, the Facts table would be rather ungainly. With flexible typing, our 'numeric' values are stored as efficiently as they can be stored. Numbers are stored as numbers. Text is stored as text. Booleans are stored as booleans. In the very same column.</p>
<p>However, it does not protect us the way Datomic, XTDB, and Rama do. We have to make our own guardrails to safely use SQLite as if it were a temporal database.</p>
<ul>
<li>Work against a strictly constrained world (namespaces, users, entities)</li>
<li>Emulate immutability for the most part (append-only facts).</li>
<li>Use Idempotence (upsert entities -&gt; facts)</li>
<li>Facts must include all actions happening within the world, including addition, removal, updates to namespaces, users, entities, fact meta-data, and set-preferred-fact choices.</li>
</ul>
<p>Something like this…</p>
<h3 id="transact-facts-append-only">Transact Facts: Append-only</h3>
<div class="sourceCode" id="cb13"><pre class="sourceCode clojure"><code class="sourceCode clojure"><span id="cb13-1"><a href="#cb13-1" target="_self" aria-hidden="true" tabindex="-1"></a>(<span class="bu">defn</span><span class="fu"> append-facts!</span></span>
<span id="cb13-2"><a href="#cb13-2" target="_self" aria-hidden="true" tabindex="-1"></a>  ([tx facts]</span>
<span id="cb13-3"><a href="#cb13-3" target="_self" aria-hidden="true" tabindex="-1"></a>   (append-facts! tx facts <span class="va">nil</span>))</span>
<span id="cb13-4"><a href="#cb13-4" target="_self" aria-hidden="true" tabindex="-1"></a>  ([tx facts owned-by-ns-user-id]</span>
<span id="cb13-5"><a href="#cb13-5" target="_self" aria-hidden="true" tabindex="-1"></a>   (jdbc/execute! tx</span>
<span id="cb13-6"><a href="#cb13-6" target="_self" aria-hidden="true" tabindex="-1"></a>                  (<span class="kw">-&gt;</span> facts</span>
<span id="cb13-7"><a href="#cb13-7" target="_self" aria-hidden="true" tabindex="-1"></a>                      (insert-world-facts-hsql</span>
<span id="cb13-8"><a href="#cb13-8" target="_self" aria-hidden="true" tabindex="-1"></a>                       owned-by-ns-user-id)</span>
<span id="cb13-9"><a href="#cb13-9" target="_self" aria-hidden="true" tabindex="-1"></a>                      hsql/format))))</span></code></pre></div>
<h3 id="transact-entities-namespaces-users-idempotently">Transact Entities, Namespaces, Users Idempotently</h3>
<p><em>And</em> append corresponding facts in the world-facts table too. Yes, it doubles up as an audit log for things that were <em>done to the World</em> itself, in addition to things happened inside the World.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode clojure"><code class="sourceCode clojure"><span id="cb14-1"><a href="#cb14-1" target="_self" aria-hidden="true" tabindex="-1"></a>(<span class="bu">defn</span><span class="fu"> transact-entities-&gt;facts</span></span>
<span id="cb14-2"><a href="#cb14-2" target="_self" aria-hidden="true" tabindex="-1"></a>  [tx entity-records fact-data]</span>
<span id="cb14-3"><a href="#cb14-3" target="_self" aria-hidden="true" tabindex="-1"></a>  (<span class="kw">and</span> (<span class="kw">seq</span> (upsert-entities! tx entity-records))</span>
<span id="cb14-4"><a href="#cb14-4" target="_self" aria-hidden="true" tabindex="-1"></a>       (append-facts! tx</span>
<span id="cb14-5"><a href="#cb14-5" target="_self" aria-hidden="true" tabindex="-1"></a>                      (transduce</span>
<span id="cb14-6"><a href="#cb14-6" target="_self" aria-hidden="true" tabindex="-1"></a>                       (record-&gt;fact-xf <span class="st">&quot;world_entities&quot;</span></span>
<span id="cb14-7"><a href="#cb14-7" target="_self" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">:ns</span>_entity_id</span>
<span id="cb14-8"><a href="#cb14-8" target="_self" aria-hidden="true" tabindex="-1"></a>                                        fact-data)</span>
<span id="cb14-9"><a href="#cb14-9" target="_self" aria-hidden="true" tabindex="-1"></a>                       <span class="kw">conj</span> []</span>
<span id="cb14-10"><a href="#cb14-10" target="_self" aria-hidden="true" tabindex="-1"></a>                       entity-records))))</span>
<span id="cb14-11"><a href="#cb14-11" target="_self" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-12"><a href="#cb14-12" target="_self" aria-hidden="true" tabindex="-1"></a>(<span class="bu">defn</span><span class="fu"> transact-namespaces-&gt;entities-&gt;facts</span></span>
<span id="cb14-13"><a href="#cb14-13" target="_self" aria-hidden="true" tabindex="-1"></a>  [tx ns-records fact-data]</span>
<span id="cb14-14"><a href="#cb14-14" target="_self" aria-hidden="true" tabindex="-1"></a>  (<span class="kw">and</span> (<span class="kw">seq</span> (upsert-namespaces! tx ns-records))</span>
<span id="cb14-15"><a href="#cb14-15" target="_self" aria-hidden="true" tabindex="-1"></a>       (append-facts! tx</span>
<span id="cb14-16"><a href="#cb14-16" target="_self" aria-hidden="true" tabindex="-1"></a>                      (transduce</span>
<span id="cb14-17"><a href="#cb14-17" target="_self" aria-hidden="true" tabindex="-1"></a>                       (record-&gt;fact-xf <span class="st">&quot;world_namespaces&quot;</span></span>
<span id="cb14-18"><a href="#cb14-18" target="_self" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">:ns</span>_name</span>
<span id="cb14-19"><a href="#cb14-19" target="_self" aria-hidden="true" tabindex="-1"></a>                                        fact-data)</span>
<span id="cb14-20"><a href="#cb14-20" target="_self" aria-hidden="true" tabindex="-1"></a>                       <span class="kw">conj</span> []</span>
<span id="cb14-21"><a href="#cb14-21" target="_self" aria-hidden="true" tabindex="-1"></a>                       ns-records))</span>
<span id="cb14-22"><a href="#cb14-22" target="_self" aria-hidden="true" tabindex="-1"></a>       (transact-entities-&gt;facts tx</span>
<span id="cb14-23"><a href="#cb14-23" target="_self" aria-hidden="true" tabindex="-1"></a>                                 (ns-records-&gt;entity-records</span>
<span id="cb14-24"><a href="#cb14-24" target="_self" aria-hidden="true" tabindex="-1"></a>                                  ns-records)</span>
<span id="cb14-25"><a href="#cb14-25" target="_self" aria-hidden="true" tabindex="-1"></a>                                 fact-data)))</span>
<span id="cb14-26"><a href="#cb14-26" target="_self" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-27"><a href="#cb14-27" target="_self" aria-hidden="true" tabindex="-1"></a>(<span class="bu">defn</span><span class="fu"> transact-users-&gt;entities-&gt;facts</span></span>
<span id="cb14-28"><a href="#cb14-28" target="_self" aria-hidden="true" tabindex="-1"></a>  [tx user-records fact-data]</span>
<span id="cb14-29"><a href="#cb14-29" target="_self" aria-hidden="true" tabindex="-1"></a>  (<span class="kw">and</span> (<span class="kw">seq</span> (upsert-users! tx user-records))</span>
<span id="cb14-30"><a href="#cb14-30" target="_self" aria-hidden="true" tabindex="-1"></a>       (append-facts! tx</span>
<span id="cb14-31"><a href="#cb14-31" target="_self" aria-hidden="true" tabindex="-1"></a>                      (transduce</span>
<span id="cb14-32"><a href="#cb14-32" target="_self" aria-hidden="true" tabindex="-1"></a>                       (record-&gt;fact-xf <span class="st">&quot;world_users&quot;</span></span>
<span id="cb14-33"><a href="#cb14-33" target="_self" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">:ns</span>_user_id</span>
<span id="cb14-34"><a href="#cb14-34" target="_self" aria-hidden="true" tabindex="-1"></a>                                        fact-data)</span>
<span id="cb14-35"><a href="#cb14-35" target="_self" aria-hidden="true" tabindex="-1"></a>                                    <span class="kw">conj</span> []</span>
<span id="cb14-36"><a href="#cb14-36" target="_self" aria-hidden="true" tabindex="-1"></a>                                    user-records))</span>
<span id="cb14-37"><a href="#cb14-37" target="_self" aria-hidden="true" tabindex="-1"></a>       (transact-entities-&gt;facts tx</span>
<span id="cb14-38"><a href="#cb14-38" target="_self" aria-hidden="true" tabindex="-1"></a>                                 (user-records-&gt;entity-records</span>
<span id="cb14-39"><a href="#cb14-39" target="_self" aria-hidden="true" tabindex="-1"></a>                                  user-records)</span>
<span id="cb14-40"><a href="#cb14-40" target="_self" aria-hidden="true" tabindex="-1"></a>                                 fact-data)))</span></code></pre></div>
<p>One more cool thing about SQLite is that it can totally be used as our "Everything DB Engine" (see: <a href="https://github.com/oldmoe/litestack">oldmoe/litestack</a>), with purpose-specific database files (queue, cache, sessions, documents, key-value store). SQLite's ability to do cross-database joins will doubtless come handy too.</p>
<h2 id="git-and-local-first-somehow-make-all-facts-merge">Git and Local-First: Somehow make all facts merge</h2>
<p>A fact is a snapshot of an event in time. If we are careful to send facts around so that they are trivial to merge in a facts table, then we can separate out conflict management. Git shows the way. When we fetch changes, the objects are synced to our computer. If a conflict occurs, then what happens to the objects? They remain cached on disk. Git simply refuses to transact the conflict into the live state of the codebase, until someone a) fixes the conflict manually and b) <em>tells git</em> that the conflict is resolved. Git does not know or care about the conflict resolution mechanism. This is because conflicts occur due to essential tacit and implicit context that <em>never</em> travels with the objects. Disambiguation thus requires converging on shared agreement, which is a squishy non-deterministic process at best, chaotic and interminable at worst. Have you heard of laws and lawmakers?</p>
<h2 id="todo-production-engineering-things-one-ought-to-do">TODO: Production engineering things one ought to do</h2>
<p>Things like…</p>
<ul>
<li>Tests for write integrity
<ul>
<li>See if we can use spec / malli to generatively test this</li>
</ul></li>
<li>Model an example domain of sufficient complexity
<ul>
<li>A single example customer (presuming a tenant per DB)</li>
<li>All their users</li>
<li>All their workflows</li>
<li>All their data</li>
</ul></li>
<li>Offload complex joins to the app (specter)
<ul>
<li>But only a pre-filtered subset lifted from the database</li>
</ul></li>
<li>The <code>world_facts</code> table is going to grow very fast. Measure latency at various orders of magnitude, for the same example domain complexity, for the same line-of-business read/write pattern (SaaS-y 80% read, 20% write, for example).
<ul>
<li>1 M facts</li>
<li>10 M facts</li>
<li>100 M facts</li>
<li>1000 M facts</li>
</ul></li>
<li>etc…</li>
</ul>
<p>Basically, try to find out all the ways this will fail to satisfy the "can I get away with it" criterion.</p>
<h1 id="postamble-rant-as-a-recap-same-thing">Postamble / Rant As A Recap (same thing)</h1>
<p>A gaggle of reasons <a href="#fn16" class="footnote-ref" id="fnref16" role="doc-noteref"><sup>16</sup></a> diverted me onto this long road to a small mangy database <a href="#fn17" target="_self" class="footnote-ref" id="fnref17" role="doc-noteref"><sup>17</sup></a>.</p>
<ul>
<li>wannabe be an Independent Software Vendor,</li>
<li>specialised in building niche SaaS products,</li>
<li>operating on dirt-cheap server infrastructure,</li>
<li>with super-duper low maintenance overhead,</li>
<li>while being able to extend the SaaS to local-first usage <a href="#fn18" target="_self" class="footnote-ref" id="fnref18" role="doc-noteref"><sup>18</sup></a></li>
</ul>
<p>As a consequence:</p>
<ul>
<li>Most crucially, I must design and build a system that I can hold in my head <em>and explain to anyone</em>. It is a form of buyer investment protection. If any business buys my software, they must have assurance that not just their data, but the whole application will be <em>accessible</em> to any other competent party they wish to transfer operations and upkeep to. It's one thing to transfer software and data custody, but a whole other ballgame to transfer <em>ownership</em>.</li>
<li>All SaaS building blocks must be compact, stable, and composable.</li>
<li>Rework must be <em>designed out</em>.</li>
</ul>
<p>The following have been sloshing about my skull, in no particular order:</p>
<ul>
<li>SQLite for web backends</li>
<li>Local First software and private data sovereignty</li>
<li>Entity-Attribute-Value modeling</li>
<li>Bitemporal data systems</li>
<li>The meaning of time</li>
<li>A healthy avoidance of schema migrations</li>
<li>Immutability</li>
<li>Idempotence (often the next-best thing to immutability, and sometimes even better)</li>
<li>Concurrency (especially concurrent read/write independence)</li>
</ul>
<p>At the end of the road, the specific choice of trying this in SQLite boils down to:</p>
<ul>
<li>Necessary Frugality</li>
<li>Necessary Archival</li>
<li>Unnecessarily Having a Smol Grug Brain</li>
<li>Unnecessarily Caring Too Much</li>
<li>Unnecessarily Poor Impulse Control</li>
</ul>
<p>The end customers, in this particular case, survive largely on love and fresh air and the mercurial generosity of arts-supporting sponsors. But that fact is valid for any indie web app I make too. So the SaaS-es must be <em>dirt-cheap</em> to run. And I should be able to <em>trivially</em> power them up and down and up again.</p>
<p>Complete database exports must be made available, on-demand, in a universally query-able, archive-grade format. The database itself must be archive-grade. Only SQLite publicly guarantees availability till 2050. And they are one of a few formats approved by the US Library of Congress for data archival.</p>
<p>Because though We are one, and We are little, and We live like an artist, We care about sovereign data ownership a bit too much, especially when the Sovereign is the poor NPC at the bottom of the B2B food chain.</p>
<p>It must be <em>trivial</em> to store each customer's data in the appropriate geography. <em>And</em> to offer it for download on demand. And to forget it completely, when asked. And to be able to prove that we've done so.</p>
<p>No, we can't use automagic managed services, because that means deep vendor lock-in.</p>
<p>Last but not least, The Whole Thing <strong>Must</strong> be Single Operator Friendly Especially If Said Operator Will Necessarily Have To Operate Internationally, Meaning They Can Easily Run Afoul Of Data Residency and Privacy Laws That They Cannot Humanly Know Or Keep Abreast Of. Like Ever . <a href="#fn19" target="_self" class="footnote-ref" id="fnref19" role="doc-noteref"><sup>19</sup></a></p>
<h1 id="readings-and-references">Readings and References</h1>
<h2 id="research-references">Research references</h2>
<ul>
<li>Data and Reality, 2nd Edition (PDF via <a href="https://web.archive.org/web/20250608204041/https://buttondown.com/hillelwayne/archive/data-and-reality-2nd-edition/">Hillel Wayne's endorsement</a>).</li>
<li><a href="https://people.cs.aau.dk/~csj/Thesis/">Temporal Database Management</a> (April 2000), dr.techn. thesis by Christian S. Jensen.</li>
<li><a href="https://www2.cs.arizona.edu/~rts/tdbbook.pdf">Developing Time-Oriented Database Applications in SQL</a> (year 2000), Richard T. Snodgrass.</li>
</ul>
<h2 id="temporal-data-system-friendly-products">Temporal Data System Friendly Products</h2>
<p>Consult their official documentation, blog, talks.</p>
<ul>
<li><a href="https://clojure.org/">Clojure</a> by Rich Hickey, especially:
<ul>
<li><a href="https://www.youtube.com/watch?v=-6BsiVyC1kM">The Value of Values</a> - Rich Hickey (InfoQ, JaxConf 2012)</li>
<li><a href="https://www.youtube.com/watch?v=Cym4TZwTCNU">Deconstructing the Database</a> - Rich Hickey (InfoQ, JaxConf 2012)</li>
</ul></li>
<li><a href="https://www.datomic.com/">Datomic</a> by Cognitect, especially:
<ul>
<li><a href="https://www.infoq.com/presentations/The-Design-of-Datomic/">The Design of Datomic</a> - Rich Hickey (InfoQ, Clojure/West 2019)</li>
</ul></li>
<li><a href="https://xtdb.com/">XTDB</a> by JUXT, especially:
<ul>
<li><a href="https://www.youtube.com/watch?v=3Stja6YUB94">The Crux of Bitemporality</a> - Jon Pither (Clojure/North 2019)</li>
</ul></li>
<li><a href="https://redplanetlabs.com/">Rama</a> by RedPlanetLabs, especially:
<ul>
<li><a href="https://www.youtube.com/watch?v=25lJNRibYv8">Simple ideas with huge impact from Clojure and Rama</a>, Nathan Marz (reClojure 2025).</li>
</ul></li>
</ul>
<h2 id="affiliations-disclosures">Affiliations / Disclosures</h2>
<ul>
<li>I use Clojure for work and hobby software, and participate in the community.</li>
<li><code>as-of</code> (see what I did there?) publication date, I have no commercial affiliations with any of the products or book publishers listed.</li>
</ul>
<h1 id="special-thanks-and-credits">Special Thanks and Credits</h1>
<p>A friendly generous wise needlessly self-effacing gentleman and scholar of infinite patience—you know who you are 🍻—who's simple requirement (really it's a day's worth of vibe-coding) precipitated this months long (and ongoing) detour across temporal data rabbit holes.</p>
<p><a href="https://github.com/jarohen">James Henderson</a> and <a href="https://github.com/refset">Jeremy Taylor</a> of the <a href="https://xtdb.com/team">XTDB team</a> generously gave much-needed feedback and encouragement in the Clojurians Slack (see <a href="https://clojurians.slack.com/archives/C1Q164V29/p1746178509141159">thread</a>). Also members of the selfsame Clojurians Slack who are only too happy to have thinky-thoughts together. I visit for Clojure, but stay for <code>#off-topic</code>.</p>
<h1 id="footnotes">Footnotes</h1>
<aside id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr />
<ol>
<li id="fn1"><p>As a reasonably self-aware person, one knows this path is littered with deadly shards of broken databases. That's fine… one expects a few cuts and bruises and heartbreaks.</p>
<p>However, time travel is a <em>nasty</em> business… the sort of thing that can drive a person stark raving mad.</p>
<p>So if you, O Sage Reader realise I am on the path to insanity, <em>please</em> exercise the <a href="https://xkcd.com/386/">XKCD 386: "Duty Calls"</a> rights available to every Upstanding Internet Citizen. Feel at ease to <a href="../../about.html#standing-invitation">email me</a> a lengthy, scathing critique of my catastrophic, misguided, foolish… folly.</p>
<p>For example:</p>
<pre class="text"><code>From: email-redacted
To:   email-redacted
Sub:  WHY, in the name of Your Maker, are you
      using UUIDv7s to ID... time??!!

... &lt;Lengthy heartfelt diatribe&gt; ...

Sincerely,
Name
</code></pre>
<p>Because you know <em>exactly</em> the fifty ways I <em>will</em> make catastrophic bugs in my production software, no matter how much I test things. Because you can tell at once, that the design I outline here is fundamentally broken to begin with. Because if it's a zero-day design bug, rows <em>will</em> get hammered, and hearts <em>will</em> bleed.<a href="#fnref1" target="_self" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>And return-gift them beautiful big immutable software ledgers, which give omniscience to effortlessly grant any reporting wish made by sales, corporate, audit, and just about anyone who "wants this ASAP", which pleases the board, which in turn makes the CEO happy, who can then make the software engineers <em>very</em> happy by letting them keep their jobs, who can in turn keep feeding themselves in order to keep stealing ideas from accountants to make still better immutable software ledgers.</p>
<p>A beautiful big circular economy.</p>
<p>Except, of course, for those of us experiencing a "period of extended involuntary negative cash flow due to adverse macroeconomic conditions, but our business fundamentals remain sound, and we are long-term bullish, and are building for that future by going all-in on A.I.", as our ex-CEO must have said in our ex-townhall.</p>
<p>Well, we may have beautiful big circular incomes. But we can exact sweet revenge yet. The only way we know how; by getting on our high hammocks, to contemplate hopelessly complected objects like Current Databases.</p>
<p>'cause—stan this, mid ex-CEO in cringe ex-townhall—we time-rich now.</p>
<p>🥃.<a href="#fnref2" target="_self" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>Except on the Dalek home world, where such error fetches death by accounting papercut. Yes, a singular cut suffices. A Dalek outside its casing is helpless. Fatal infection is inevitable. Even if it wants to <strong><em>not</em></strong> OBEY OBEY OBEY, and live, it literally CANNOT RESIST.<a href="#fnref3" target="_self" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>One doesn't reeeeally care <em>who</em> does it or <em>how</em>, as long as one gets the discount as quickly and painlessly as possible. Our respective accounts departments, however, care <em>very much</em> about transactional integrity. Store staff would like their accounts to be kosher, so the regional director is pleased and signs off on those sweet weekly sales commissions. Our overlords, on the other hand are just looking out for us. They <em>never</em> want us to fall into a situation where we feel <em>compelled</em> to pocket that yummy 8% on the D.L. (Split 80-20 if the cashier catches our drift. 'Coz like, time travel is rough enough as it is, you know, and like, if someone complains, we can like always come back and prevent the cashier from fouling up our bill in the first place. No harm, no foul.)<a href="#fnref4" target="_self" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>But have you ever met any cashier who has time to think long enough about what to fill in that field? No. They just PUNCH PUNCHPUNCHPUNCH PUNCHPUNCH. TABTABTABTAB. SAVE. PRINT. "NEEEXT."<a href="#fnref5" target="_self" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn6"><p>In that sense, a mind in "diffused mode" is engaged in abstract exploration and passive observation. Events are just events. Thoughts are just thoughts. Associations are just associations. A mind in "focus mode" materializes that intangible abstract expressionism into a hyper-real, concrete, singular here and now. A temporal database is similarly bimodal. Normally, it simply keeps track of events fed into it. Only when an observer tries to examine reality does it render a materialized view… a concrete version of reality, constructed by choosing facts from potentially simultaneous temporal event streams, and synchronising them along a single shared timeline.<a href="#fnref6" target="_self" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn7"><p>"Lossless" FLAC audio is a dense but lossy sequence of digital samples of analog audio. A hi-fi LP inscribes a richer, continuous analog representation of the same song. Higher fidelity than FLAC, but still a lossy inscription of the original audio performed by the artist.<a href="#fnref7" target="_self" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn8"><p><a href="https://en.wikipedia.org/wiki/Attosecond_physics">Wikipedia says</a></p>
<blockquote>
<p>Attosecond Physics, also known as attophysics, or more generally attosecond science, is a branch of physics that deals with light-matter interaction phenomena wherein attosecond (10<sup>-18</sup> s) photon pulses are used to investigate dynamical processes in matter with unprecedented temporal resolution.</p>
<p>The main research topics in this field are:</p>
<ul>
<li>Atomic physics …</li>
<li>Molecular physics …</li>
<li>Solid state physics …</li>
</ul>
</blockquote>
<p>The page further explains that ~43 attoseconds (43 x 10<sup>-18s</sup>) is the best-resolution measure we can reliably make. Thus any given measurement of any attribute of any electron-entity resides within an interval of <em>at least</em> 43 attoseconds.</p>
<p>What an electron entity is up to inside of that 43 attosecond interval is a guessing game… literally statistical quantum mechanics.<a href="#fnref8" target="_self" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn9"><p>Dan Luu has some nice posts about this phenomenon:</p>
<ul>
<li><a href="https://danluu.com/input-lag/">Computer latency: 1977-2017</a> (see also: <a href="https://danluu.com/term-latency/">Terminal latency</a> and <a href="https://danluu.com/keyboard-latency/">Keyboard latency</a>)</li>
<li><a href="https://danluu.com/web-bloat/">How web bloat impacts users with slow connections</a></li>
<li><a href="https://danluu.com/simple-architectures/">In defense of simple architectures</a></li>
</ul>
<a href="#fnref9" target="_self" class="footnote-back" role="doc-backlink">↩︎</a></li>
<li id="fn10"><p>As someone who literally embodied this <em>Way</em> said.</p>
<blockquote>
<p>"When there is freedom from mechanical conditioning, there is simplicity. The classical man is just a bundle of routine, ideas and tradition. If you follow the classical pattern, you are understanding the routine, the tradition, the shadow — you are not understanding yourself."<br />
…<br />
"Do not deny the classical approach, simply as a reaction, or you will have created another pattern and trapped yourself there."<br />
…<br />
"Do not be assertive, but adjust to the object, and you shall find a way around or through it. If nothing within you stays rigid, outward things will disclose themselves."<br />
…<br />
"Empty your mind, be formless. Shapeless, like water.<br />
If you put water into a cup, it becomes the cup. You put water into a bottle and it becomes the bottle. You put it in a teapot, it becomes the teapot.</p>
<p>Now, water can flow or it can crash.</p>
<p>Be water, my friend."</p>
— Bruce Lee<br />

</blockquote>
<p>Tao of Jeet Kune Do (1975), and<br />
"The Lost Interview" with Pierre Burton (1971).<a href="#fnref10" target="_self" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn11"><p>The downside of any capital investment applies here too. One project is not likely to pay it back in full. Several projects can—build, ship, adapt, pivot, iterate in tight OODA loops. Other gigs and jobs too. The owner-operator's skill, knowledge, and hard-won experience are not to be underestimated.</p>
<p>Of course, one can always <em>avoid</em> choosing… <em>"We Choose The Best Tool For The Job"</em>.</p>
<p><em>Suuuurrre</em> one can…</p>
<p>As long as one is willing to make <em>someone</em> pay the price of riding a hamster wheel of constantly debugging and "hot fixing" and manually working around the <a href="../software-debt/index.html#software-debt-is-networked.">explosive complexity</a> of a heterogeneous, half understood, moving target of a system. The end game is <a href="../how-to-not-die-by-a-thousand-cuts/index.html#main">death by a thousand cuts</a>. The speed of this half-SaaS-y enterprise demise depends on how high one is on OPM—Other People's Money.<a href="#fnref11" target="_self" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn12"><p>And quite okay believing that; even relieved because it helped me let go of my FOMO of not being a <em>fast</em> programmer. Grug energy makes me feel safe working in <a href="../demo-clojure-workflow-scicloj/index.html#main">my slow, plodding, manual manner, using only brain-muscles</a>. It is especially, helping me avoid FOMO of "missing out" on the hot chaos of gen-AI… Like I <em>could</em>, in theory, bundle about 20 gigs of disk-local LLM tech to deliver state-of-the-art local-first conversational search and query intelligence. But every other developer with a pulse is already doing that, so like, I got to innovate something else. Besides, I hear minimalism never goes out of style.<a href="#fnref12" target="_self" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn13"><p>If I wanna scale my problem-solving <em>and</em> simplify my life, do I really need kubernetes? Because everybody sez so? And, bro, like, managed services are just <em>better</em>? No thanks. <em>Choosing</em> to build atop <em>vendor-specific distributed systems</em>, from the get-go, is just bass-ackwards. IYKYK. 🤷<a href="#fnref13" target="_self" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn14"><p>Because, current DBs update information in-place. Because, they <em>must</em> force all changes to synchronise around <em>one singular moment of wall-clock-time</em> (i.e. all writes are as of <code>now</code> writes).</p>
<p>The job of a current database, and current database designers, <em>and</em> current database users is to guarantee that every in-place state update Durably leaves the database in a Consistent state. All this put together causes the makers of current databases to obsess over helping the data engineers satisfy the A and the I of ACID, which inevitably leads <em>everybody</em> to at least once contemplate the dark art of Multi Version Concurrency Control.</p>
<p>Any database using application can easily subvert these checks and balances, leading to database corruption. Unfortunately the risk is ever-present, even with excellent application engineering discipline—crafting database constraints, schemas, and queries.</p>
<p>Which means, every serious user of current databases has to have a way to fix badness, if they detect it. Which in turn, causes them to maintain <em>detailed audit logs</em> of every single database update, as and when the database updates happen. The all-important Audit Trail.</p>
<p><em>Unfortunately</em> every such audit trail is forever a work-in-progress, because the nobody has perfect foresight about all the schema and data migrations in the future of the database. Eventually, we all end up satisfying Henderson's Tenth Law.<a href="#fnref14" target="_self" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn15"><p>Databases barely implement the SQL:2011 standard pertaining to "Language Enhancements for temporal data definition and manipulation". Whatever first-class support exists is spotty at best. JSON storage and querying got a lot more love over the last decade-plus of the SQL v/s NoSQL Database Wars. Can't blame standards committees. They have to go where the world has already gone.<a href="#fnref15" target="_self" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn16"><p>Several factors conspired gradually and suddenly.</p>
<ul>
<li>An ever-present vulnerability to being nerd-sniped (not that I'm complaining, mind you). In this case, Alice has fallen into the temporal data systems rabbit hole.</li>
<li>A peculiar and very particular set of constraints (that I mostly chose all by myself because, I am (and always have been) the CEO of Me (in addition to being CEO of <a href="https://htmx.org/">HTMX</a> and CEO of <a href="https://data-star.dev/">Datastar</a> (Hi friends!)).</li>
<li>A beatific project sponsor who is somehow <em>not</em> sending irate emails, though well aware that I've gone rogue, rooting around in rabbit holes that absolutely do <em>not</em> need rooting around in.</li>
<li>Life happened. Boy can life Happen. The upshot of that… character building period… has been turning into a person who can lovingly embrace that special kind of simple-minded <em>devil may care-ness</em> that helps a person ignore their own Dire Admonitions, because they are having too much fun right now, and because they know that <em>Poor Man</em> has none of the many, enormous, consequential burdens of <em>Rich Man</em>.</li>
<li>I only noticed in hindsight (time is like that); having grown up on a steady diet of Dr. Who paperbacks.</li>
</ul>
<a href="#fnref16" target="_self" class="footnote-back" role="doc-backlink">↩︎</a></li>
<li id="fn17"><p>Becky Chambers, you <em>see</em> me. How?!</p>
<blockquote>
<p>'No, Jenks,' Pepper said. All room for discussion was gone from her voice. 'I'm not talking about you getting arrested. I'm talking about you doing something dangerous. I hate to pull the my-past-is-a-sad-story card, but listen: I am the end product of a few very stupid, well-intentioned people who thought it would be a great idea to redefine Humanity. It didn't start with much. A tweak here, a splice there. But things escalated, as they always do, until it became something completely beyond reason.'</p>
</blockquote>
<p>SQLite is Humanity and I am well-intentioned.<a href="#fnref17" target="_self" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn18"><p>Or at least a limited but useful modal usage pattern; such as easy toggle between a "work alone" read-only mode and a "work together" synchronized read-write.<a href="#fnref18" target="_self" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn19"><p>Because <em>someone</em> (I wonder who) <em>chose</em> to turn into obnoxious sticky-fingerprinting gluttons, getting their greedy little hands into everybody's cookie jars, spraying insidious little tracking pixels all over our LAN parties, enshittifying everything they even touch (never mind ship or acquire), turning their users into <em>users</em>, selling them out <em>wholesale</em> to the lowest lowlife highest bidder, because "fiduciary duty" and "shareholder value", thus forcing planet-wide bureaucracies to <em>inevitably</em> do what bureaucracies do best; try to win the enterprise whack-a-mole game by making sweeping heavy-handed regulation in a forgone bid to curtail the most egregious enterprise excesses. Never mind us billion little NPCs who must now <em>also</em> comply with the same mountain of regulation if we so much as sneeze on the Internet, Or Else.</p>
<p>Truly, one person's <em>collateral damage</em> is another (legal) entity's <em>Strategic Denial of Entrepreneurial Opportunity</em>.</p>
<figure>
<img src="./agent-smith-mr-anderson-cant-phone-call.jpg" />
<figcaption>Agent Smith: What good is a phone call if you are unable to speak?</figcaption>
</figure>
<p>smh.<a href="#fnref19" target="_self" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</aside>
  </section>
  <footer id="blog-post-footer" class="footer stack">
    <hr>
    <nav class="cluster">
      <span>&uarr; <a href="#blog-post-toc" rel="bookmark" target="_self">toc</a></span>
      <span>&uarr; <a href="#blog-post" rel="bookmark" target="_self">title</a></span>
      <span>&uarr; <a href="#site-header" rel="bookmark" target="_self">menu</a></span>
    </nav>
    <hr>
          <nav class="cluster">
        <a href="mailto:blog.comments@evalapply.org?subject=DELETE_ME_HUMAN Poor man's bitemporal data system in SQLite and Clojure" rel="bookmark">&#x2709; email me comments</a>
        <span>&raquo; share &rarr;</span>
        <a href="https://bsky.app/intent/compose?text=Poor%20man%27s%20bitemporal%20data%20system%20in%20SQLite%20and%20Clojure%20https%3A%2F%2Fwww.evalapply.org%2Fposts%2Fpoor-mans-time-oriented-data-system%2Findex.html" target="_blank">[bsky]</a>
        <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fwww.evalapply.org%2Fposts%2Fpoor-mans-time-oriented-data-system%2Findex.html" target="_blank">[in]</a>
        <a href="https://news.ycombinator.com/submitlink?u=https%3A%2F%2Fwww.evalapply.org%2Fposts%2Fpoor-mans-time-oriented-data-system%2Findex.html&t=Poor%20man%27s%20bitemporal%20data%20system%20in%20SQLite%20and%20Clojure" target="_blank"> [HN]</a>
        <a href="https://lobste.rs/stories/new" target="_blank">[lobste.rs]</a>
        <a href="http://www.reddit.com/submit?url=https%3A%2F%2Fwww.evalapply.org%2Fposts%2Fpoor-mans-time-oriented-data-system%2Findex.html&title=Poor%20man%27s%20bitemporal%20data%20system%20in%20SQLite%20and%20Clojure" target="_blank">[reddit]</a>
        <a class="site-feed" href="https://www.evalapply.org/index.xml" target="_blank">feed</a>
      </nav>
    <form class="footer cluster"
      action="https://buttondown.com/api/emails/embed-subscribe/evalapply"
      method="post"
      target="popupwindow"
      autocomplete="on"
      onsubmit="window.open('https://buttondown.com/evalapply', 'popupwindow')">
  <input type="email" name="email" id="bd-email" autocomplete="on" />
  <label for="bd-email" hidden>Email</label>
  <span>
    <input type="submit" value="Get posts by email" />
    <input type="hidden" name="tag" value="everyone" />
<input type="hidden" name="tag" value="via-blog-post" />
  </span>
</form>
  </footer>
</article>
  </main>
      <footer id="site-footer">
  <hr>
  <div class="box invert footer stack">
    <p class="center">&copy; 2025,
      <a href="https://www.linkedin.com/in/adityaathalye/" target="_blank">Aditya Athalye</a>.
      <span>All content licensed
        <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/" target="_blank">
          CC BY-SA 4.0
        </a>, except where noted otherwise.
      </span>
    </p>
    <p class="center">
      Built with
      <a href="https://github.com/adityaathalye/shite" target="_blank">shite</a>,
      GNU <a href="https://www.gnu.org/software/emacs/" target="_blank">Emacs</a>,
      <a href="https://orgmode.org" target="_blank">org-mode</a>, and &#x1F5A4;.
    </p>
    <p class="center">
      My
      <a href="https://buttondown.com/evalapply" target="_blank">newsletter</a>
      is powered by
      <a href="https://buttondown.com/refer/evalapply" target="_blank">Buttondown</a>.
    </p>
    <div class="rc-scout-wrapper center">
      <div class="rc-scout" data-scout-rendered="true">
        <p class="rc-scout__text">
          <i class="rc-scout__logo"></i>
          Want to become a better programmer?
          <a class="rc-scout__link" href="https://www.recurse.com/scout/click?t=40533398b8c93bb4f3323a170e032e91" target="_blank">Join the Recurse Center!</a>
        </p>
      </div>
      <style class="rc-scout__style" type="text/css">.rc-scout { display: block; padding: 0; border: 0; margin: 0; } .rc-scout__text { display: block; padding: 0; border: 0; margin: 0; height: 100%; font-size: 100%; } .rc-scout__logo { display: inline-block; padding: 0; border: 0; margin: 0; width: 0.85em; height: 0.85em; background: no-repeat center url('data:image/svg+xml;utf8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%2012%2015%22%3E%3Crect%20x%3D%220%22%20y%3D%220%22%20width%3D%2212%22%20height%3D%2210%22%20fill%3D%22%23000%22%3E%3C%2Frect%3E%3Crect%20x%3D%221%22%20y%3D%221%22%20width%3D%2210%22%20height%3D%228%22%20fill%3D%22%23fff%22%3E%3C%2Frect%3E%3Crect%20x%3D%222%22%20y%3D%222%22%20width%3D%228%22%20height%3D%226%22%20fill%3D%22%23000%22%3E%3C%2Frect%3E%3Crect%20x%3D%222%22%20y%3D%223%22%20width%3D%221%22%20height%3D%221%22%20fill%3D%22%233dc06c%22%3E%3C%2Frect%3E%3Crect%20x%3D%224%22%20y%3D%223%22%20width%3D%221%22%20height%3D%221%22%20fill%3D%22%233dc06c%22%3E%3C%2Frect%3E%3Crect%20x%3D%226%22%20y%3D%223%22%20width%3D%221%22%20height%3D%221%22%20fill%3D%22%233dc06c%22%3E%3C%2Frect%3E%3Crect%20x%3D%223%22%20y%3D%225%22%20width%3D%222%22%20height%3D%221%22%20fill%3D%22%233dc06c%22%3E%3C%2Frect%3E%3Crect%20x%3D%226%22%20y%3D%225%22%20width%3D%222%22%20height%3D%221%22%20fill%3D%22%233dc06c%22%3E%3C%2Frect%3E%3Crect%20x%3D%224%22%20y%3D%229%22%20width%3D%224%22%20height%3D%223%22%20fill%3D%22%23000%22%3E%3C%2Frect%3E%3Crect%20x%3D%221%22%20y%3D%2211%22%20width%3D%2210%22%20height%3D%224%22%20fill%3D%22%23000%22%3E%3C%2Frect%3E%3Crect%20x%3D%220%22%20y%3D%2212%22%20width%3D%2212%22%20height%3D%223%22%20fill%3D%22%23000%22%3E%3C%2Frect%3E%3Crect%20x%3D%222%22%20y%3D%2213%22%20width%3D%221%22%20height%3D%221%22%20fill%3D%22%23fff%22%3E%3C%2Frect%3E%3Crect%20x%3D%223%22%20y%3D%2212%22%20width%3D%221%22%20height%3D%221%22%20fill%3D%22%23fff%22%3E%3C%2Frect%3E%3Crect%20x%3D%224%22%20y%3D%2213%22%20width%3D%221%22%20height%3D%221%22%20fill%3D%22%23fff%22%3E%3C%2Frect%3E%3Crect%20x%3D%225%22%20y%3D%2212%22%20width%3D%221%22%20height%3D%221%22%20fill%3D%22%23fff%22%3E%3C%2Frect%3E%3Crect%20x%3D%226%22%20y%3D%2213%22%20width%3D%221%22%20height%3D%221%22%20fill%3D%22%23fff%22%3E%3C%2Frect%3E%3Crect%20x%3D%227%22%20y%3D%2212%22%20width%3D%221%22%20height%3D%221%22%20fill%3D%22%23fff%22%3E%3C%2Frect%3E%3Crect%20x%3D%228%22%20y%3D%2213%22%20width%3D%221%22%20height%3D%221%22%20fill%3D%22%23fff%22%3E%3C%2Frect%3E%3Crect%20x%3D%229%22%20y%3D%2212%22%20width%3D%221%22%20height%3D%221%22%20fill%3D%22%23fff%22%3E%3C%2Frect%3E%3C%2Fsvg%3E'); } .rc-scout__link:link, .rc-scout__link:visited { color: var(--color-dark); text-decoration: underline; text-underline-offset: var(--scale-xxxs); } .rc-scout__link:hover, .rc-scout__link:active { color: #4e8b1d; }
      </style>
    </div>
  </div>
</footer>
    </div>
  </body>
</html>
