<!DOCTYPE html>
<html lang="en" prefix="og: https://ogp.me/ns#">
  <head>
    <!-- Some basic hygiene meta-data -->
<title>A Clojure view of &quot;Mars Rover&quot;</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="author" content="Aditya Athalye">
<meta name="description"
      content="Here I illustrate how Clojurists (including Yours Truly) like to solve problems and model things using hammocks, pure functions, and the &quot;it&apos;s just data&quot; ideology. Also, while the *problem* focuses on &quot;design in the small&quot; of application logic, many ideas in the *solution* can—and do—scale all the way to &quot;design in the large&quot; of whole systems.">
<meta name="keywords" content="systems thinking,functional programming,architecture,software design,technology leadership,devops,clojure">
<meta property="og:title" content="A Clojure view of &quot;Mars Rover&quot;">
<meta property="og:description" content="Here I illustrate how Clojurists (including Yours Truly) like to solve problems and model things using hammocks, pure functions, and the &quot;it&apos;s just data&quot; ideology. Also, while the *problem* focuses on &quot;design in the small&quot; of application logic, many ideas in the *solution* can—and do—scale all the way to &quot;design in the large&quot; of whole systems.">
<meta property="og:locale" content="en_GB">
<meta property="og:type" content="website">
<meta property="og:url" content="https://evalapply.org/posts/clojure-mars-rover/index.html">
    <link rel="stylesheet preload" type="text/css" as="style" href="https://evalapply.org/static/css/style.css">
<link href="https://evalapply.org/index.xml"
      rel="alternate" type="application/rss+xml"
      title="Eval / Apply is pure magic">
<link rel="canonical" href="https://evalapply.org/posts/clojure-mars-rover/index.html">
</head>
  <body>
    <div id="the-very-top" class="stack center box">
        <header id="site-header">
  <div class="box invert stack">
    <div class="with-sidebar site-header">
      <a class="box icon" href="https://evalapply.org/index.html#main">
        <img src="https://evalapply.org/static/img/Lisp_logo.svg" alt="Eval / Apply is pure magic">
      </a>
      <div class="stack">
        <div class="site-header site-header:title">Eval / Apply is pure magic</div>
        <nav class="cluster site-header site-header:nav-items">
          <a href="https://evalapply.org/index.html#main">
   &lambda; about
</a>
<a href="https://evalapply.org/posts/index.html">
   &#9753; blog
</a>
<a href="mailto:hello@evalapply.org">
   email
</a>
<a href="#site-footer">
   &rlhar; subscribe
</a>
        </nav>
      </div>
    </div>
  </div>
</header>
        <main id="main">
          <article id="blog-post" class="stack">
  <header>
    <div class="stack">
      <div class="title">A Clojure view of "Mars Rover"</div>
      <div class="cluster post-meta">
           <span>&uarr; <a href="#site-header" rel="bookmark">menu</a></span>
           <span>&darr; <a href="#blog-post-footer" rel="bookmark">discuss</a></span>
           <span>&darr; <a href="#blog-post-toc" rel="bookmark">toc</a></span>
      </div>
      <div class="summary">Here I illustrate how Clojurists (including Yours Truly) like to solve problems and model things using hammocks, pure functions, and the "it's just data" ideology. Also, while the *problem* focuses on "design in the small" of application logic, many ideas in the *solution* can—and do—scale all the way to "design in the large" of whole systems.</div>
      <div class="cluster post-meta">
        <span class="author">By: Adi</span>
        <span class="date">Published: 2022-10-19</span>
        <span class="date">Updated: 2022-11-08</span>
        <span class="tags">Tags:  / <a href="https://evalapply.org/tags/clojure/index.html#main">#clojure</a> / <a href="https://evalapply.org/tags/functional_programming/index.html#main">#functional_programming</a> / <a href="https://evalapply.org/tags/software_design/index.html#main">#software_design</a> / <a href="https://evalapply.org/tags/architecture/index.html#main">#architecture</a>
        </span>
      </div>
      <hr>
    </div>
  </header>
  <section class="stack">
      <div id="blog-post-toc" class="stack table-of-contents">
  <details class="box invert stack" open>
    <summary>
      <strong>Contents</strong>
    </summary>
    <nav class="stack">
      <a href="#reading-guide" class="toc-heading:h1">Reading guide</a>
<a href="#the-problem-statement" class="toc-heading:h1">The Problem Statement</a>
<a href="#move-0-use-a-hammock" class="toc-heading:h1">Move 0: Use a hammock</a>
<a href="#teasing-apart-the-essential-and-the-incidental" class="toc-heading:h2">Teasing apart the Essential and the Incidental</a>
<a href="#framing-the-essential-problem-domain" class="toc-heading:h2">Framing the essential "problem domain"</a>
<a href="#sidelight-how-the-design-space-opens-up" class="toc-heading:h2">Sidelight: how the design space opens up</a>
<a href="#move-1-identify-the-shape-of-core-data" class="toc-heading:h1">Move 1: Identify the shape of core data</a>
<a href="#directions" class="toc-heading:h2">Directions</a>
<a href="#rotations" class="toc-heading:h2">Rotations</a>
<a href="#position" class="toc-heading:h2">Position</a>
<a href="#move-2-model-the-domain-operations" class="toc-heading:h1">Move 2: Model the domain operations</a>
<a href="#rotate-in-place" class="toc-heading:h2">Rotate in place</a>
<a href="#move-one-step" class="toc-heading:h2">Move one step</a>
<a href="#move-many-steps-safely" class="toc-heading:h2">Move Many Steps Safely</a>
<a href="#move-safely-around-other-rovers-and-sundry-insurmountable-objects" class="toc-heading:h2">Move Safely Around Other Rovers and Sundry Insurmountable Objects</a>
<a href="#move-3-interpret-the-commands" class="toc-heading:h1">Move 3: Interpret the commands</a>
<a href="#move-4-can-we-pretty-please-move-the-rover-already" class="toc-heading:h1">Move 4: Can we pretty please move the rover already?</a>
<a href="#move-5-ok-now-we-can-move-it." class="toc-heading:h1">Move 5: Ok, <em>now</em> we can move it.</a>
<a href="#finally-imperative-shell-to-parse-incoming-signal" class="toc-heading:h1">Finally: "Imperative shell" to parse incoming signal</a>
<a href="#recap" class="toc-heading:h1">Recap</a>
<a href="#footnotes" class="toc-heading:h1">Footnotes</a>
    </nav>
  </details>
</div>
<hr>
  <h1 id="reading-guide">Reading guide</h1>
<ul>
<li><p>Follow the post for a detailed breakdown of my Clojurish thought process, and the resulting code at each step.</p></li>
<li><p>Or, <a href="#recap">skip here to read the whole code at one go</a>.</p></li>
<li><p>I assume basic familiarity with Clojure (functions, hashmaps, namespaces, multimethods, code naming and calling conventions etc.).</p></li>
</ul>
<h1 id="the-problem-statement">The Problem Statement</h1>
<p>The so-called <em>"Mars Rover"</em> problem is one of those evergreen software design interview questions, attributed to ThoughtWorks since the mid-2000s. It is perhaps second only to <em>FizzBuzz</em> <a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> in its genere-defining significance. The question is available all over the Internet. For completeness, I've copied it here from its <a href="https://code.google.com/archive/p/marsrovertechchallenge/">archive page at code.google.com</a>.</p>
<details class="box invert stack">
<summary>
<code>A squad of robotic rovers are to be landed by NASA on a plateau on Mars...</code>
<hr>
</summary><code>
<p>… This plateau, which is curiously rectangular, must be navigated by the rovers so that their on-board cameras can get a complete view of the surrounding terrain to send back to Earth.</p>
<p>A rover's position and location is represented by a combination of x and y co-ordinates and a letter representing one of the four cardinal compass points. The plateau is divided up into a grid to simplify navigation.</p>
<p>An example position might be 0, 0, N, which means the rover is in the bottom left corner and facing North.</p>
<p>In order to control a rover, NASA sends a simple string of letters. The possible letters are \"L\", \"R\" and \"M\". \"L\" and \"R\" makes the rover spin 90 degrees left or right respectively, without moving from its current spot. \"M\" means move forward one grid point, and maintain the same heading.</p>
<p>Assume that the square directly North from (x, y) is (x, y+1).</p>
<p>INPUT:</p>
<p>The first rover-start-position-line of input is the upper- right coordinates of the plateau, the lower-left coordinates are assumed to be 0,0.</p>
<p>The rest of the input is information pertaining to the rovers that have been deployed. Each rover has two lines of input. The first rover-start-position-line gives the rover's position, and the second rover-start-position-line is a series of instructions telling the rover how to explore the plateau.</p>
<p>The position is made up of two integers and a letter separated by spaces, corresponding to the x and y co-ordinates and the rover's orientation.</p>
<p>Each rover will be finished sequentially, which means that the second rover won't start to move until the first one has finished moving.</p>
<p>OUTPUT</p>
<p>The output for each rover should be its final co-ordinates and heading.</p>
<p>INPUT AND OUTPUT</p>
<p>Test Input:</p>
<pre class="text"><code>5 5
1 2 N
LMLMLMLMM
3 3 E
MMRMMRMRRM
</code></pre>
<p>Expected Output:</p>
<pre class="text"><code>1 3 N
5 1 E
</code></pre>
</code></details>
<h1 id="move-0-use-a-hammock">Move 0: Use a hammock</h1>
<p>Before we even consider firing up a REPL, we recline on our hammock <a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> to consider the all-important question; <em>"Well what's the <strong>actual</strong> problem?"</em>.</p>
<ul>
<li>Is it to parse input commands?</li>
<li>Is it to physically move a rover?</li>
<li>Is it to calculate how to move the rover?</li>
<li>Is it also something unstated?</li>
</ul>
<p>Hammocks engender naps. Naps engender diffuse-mode brainwork.</p>
<h2 id="teasing-apart-the-essential-and-the-incidental">Teasing apart the Essential and the Incidental</h2>
<p>After a suitable amount of snoozing, tossing, turning, note-scribbling, I'd argue that the <em>essential</em> job is to calculate a (safe) path, given some intial conditions and sequence of commands.</p>
<p>Why?</p>
<p>Well, because it occurred to me that if we had such a calculator, almost anything could use it, including simulators or the rover's body-doubles back on Earth, at mission control.</p>
<p>This implies that the problem of reading and parsing input (input source and format could be anything), and that of actually moving a Rover (or Rover-ish thing) are both <em>incidental</em> problems.</p>
<h2 id="framing-the-essential-problem-domain">Framing the essential "problem domain"</h2>
<p>After we remove all trace of the inessential, the basic shape of our problem domain looks like this:</p>
<pre class="text"><code>Directions are cardinal compass points:
  N, S, E, W

Position is defined as the composite of:
  [X Coordinate, Y Coordinate, Cardinal Direction]

Rotations are defined as:
  L := 90 deg left, in-place
  R := 90 deg right, in-place

Movement is defined as:
  M := advance 1 unit, in the current direction

The core problem is defined as:
  Describe motion in terms of our definitions.
</code></pre>
<p>From this, it follows that our <em>solution</em> domain consists of answers to questions like:</p>
<ul>
<li>What are the different entities in our system? (directions, coordinates)</li>
<li>What are the different operations? (move, rotate)</li>
<li>What are the given rules of the system? (plateau is rectangular, rotate in place by 90°, move one unit)</li>
<li>What are the design decisions we must make? e.g.
<ul>
<li>Detect collisions or be dumb?</li>
<li>What to do with nonsensical input like commands that can move us off-grid (and maybe off a cliff)?</li>
<li>etc.</li>
</ul></li>
</ul>
<h2 id="sidelight-how-the-design-space-opens-up">Sidelight: how the design space opens up</h2>
<p>It shouldn't surprise me any more but it invariably does… the unreasonable effectiveness of devoting quality "hammock time" to extract the essentials of a problem space.</p>
<p>The exercise illuminates design choices not just in-app, but also system-wide. At the very least the act of subtraction helps prevent permanent lock-out of future choices.</p>
<p>For example, the whole rover-mover could very well be a single program.</p>
<p>Or…</p>
<p>We could model the calculations in a slow, energy-inefficient, high-level language—in context of the rover's power budget constraints. Then implement the model as a custom chip in the rover. Then wire chip output to a drivetrain, and feed the chip input from some sort of signal processor. This way NASA retains ability to in-source the mission-critical calculator, and impose API contracts on subsystem vendors for signal I/O.</p>
<p>Either way, it turns out we can express our core problem in terms of pure data and functions, i.e. this is the <em>"functional core"</em> of our program design. Whereas the input/output pieces become our program's <em>"imperative shell"</em> <a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>.</p>
<h1 id="move-1-identify-the-shape-of-core-data">Move 1: Identify the shape of core data</h1>
<p>Where to begin? Well, what is the smallest but very important domain entity we can model? I'd say it is directions, and immediately adjacent to that, rotations.</p>
<h2 id="directions">Directions</h2>
<p>Directions can simply be keywords <code>:N</code>, <code>:W</code>, <code>:S</code>, <code>:E</code>.</p>
<p>That's it. It's <em>boring</em>. Boring is good.</p>
<h2 id="rotations">Rotations</h2>
<p>We can define rotations in terms of pre-calculated hash-tables, because we know exactly how the rover must rotate.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode clojure"><code class="sourceCode clojure"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true"></a>(<span class="kw">ns</span> mars.rover)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true"></a><span class="co">;; Each rotation is 90 degrees. Thus we can define the</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true"></a><span class="co">;; meaning of left-rotation and right-rotation like so:</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true"></a>(<span class="bu">def</span><span class="fu"> rot-L </span>{<span class="at">:N</span> <span class="at">:W</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true"></a>            <span class="at">:S</span> <span class="at">:E</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true"></a>            <span class="at">:W</span> <span class="at">:S</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true"></a>            <span class="at">:E</span> <span class="at">:N</span>})</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true"></a></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true"></a>(<span class="bu">def</span><span class="fu"> rot-R </span>{<span class="at">:N</span> <span class="at">:E</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true"></a>            <span class="at">:S</span> <span class="at">:W</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true"></a>            <span class="at">:W</span> <span class="at">:N</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true"></a>            <span class="at">:E</span> <span class="at">:S</span>})</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true"></a></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true"></a>(<span class="kw">comment</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true"></a>  (rot-L <span class="at">:N</span>) <span class="co">; =&gt; :W</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true"></a>  (rot-L (rot-L <span class="at">:N</span>)) <span class="co">; =&gt; :S</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true"></a>  ((<span class="kw">comp</span> rot-L rot-L rot-R rot-R) <span class="at">:N</span>) <span class="co">; =&gt; :N</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true"></a>  )</span></code></pre></div>
<p>What if we had a precision stepper motor capable of 0.1° turns, you ask? Well, we could <em>still</em> pre-calculate all L-side and R-side rotations as hard-coded hash-tables.</p>
<p>Think about it.</p>
<p>Once we send a stepper motor into space, we can't swap it out for a better motor. So we can even hard-wire the rotations lookup table in a ROM. The fastest function call is no function call.</p>
<h2 id="position">Position</h2>
<p>We define "position" as <code>x,y</code> coordinates plus current direction. We can certainly model it as a tuple <code>[x y d]</code>, because <code>x,y,d</code> is a sensible-enough convention to make standard system-wide.</p>
<p><em>However</em>, a hashmap <code>{:x X :y Y :d D}</code> is much better: more descriptive, better data access, more flexible for future change <a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a>.</p>
<h1 id="move-2-model-the-domain-operations">Move 2: Model the domain operations</h1>
<p>Our model has just three explicit operations: rotate left, rotate right, and move. The functions that calculate the result of the operations almost write themselves, because of the way we set up our core data.</p>
<h2 id="rotate-in-place">Rotate in place</h2>
<p>We can calculate rotation in terms of position <code>{:x X :y Y :d D}</code> , like so.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode clojure"><code class="sourceCode clojure"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true"></a>(<span class="bu">defn</span><span class="fu"> L</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true"></a>  <span class="st">&quot;Return a left-rotate relative to the current direction</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true"></a><span class="st">   at the current coordinates.&quot;</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true"></a>  [position]</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true"></a>  (<span class="kw">update</span> position <span class="at">:d</span> rot-L))</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true"></a>(<span class="bu">defn</span><span class="fu"> R</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true"></a>  <span class="st">&quot;Return a right-rotate relative to the current direction</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true"></a><span class="st">   at the current coordinates.&quot;</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true"></a>  [position]</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true"></a>  (<span class="kw">update</span> position <span class="at">:d</span> rot-R))</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true"></a></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true"></a>(<span class="kw">comment</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true"></a>  (L {<span class="at">:x</span> <span class="dv">1</span> <span class="at">:y</span> <span class="dv">3</span> <span class="at">:d</span> <span class="at">:N</span>})</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true"></a>  <span class="co">;; =&gt; {:x 1 :y 3 :d :W}</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true"></a></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true"></a>  (R (L {<span class="at">:x</span> <span class="dv">1</span> <span class="at">:y</span> <span class="dv">3</span> <span class="at">:d</span> <span class="at">:N</span>}))</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true"></a>  <span class="co">;; =&gt; {:x 1 :y 3 :d :N}</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true"></a></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true"></a>  ((<span class="kw">comp</span> R R L L) {<span class="at">:x</span> <span class="dv">1</span> <span class="at">:y</span> <span class="dv">3</span> <span class="at">:d</span> <span class="at">:N</span>})</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true"></a>  <span class="co">;; =&gt; {:x 1 :y 3 :d :N}</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true"></a>  )</span></code></pre></div>
<p>A reader might complain that the word <code>position</code> doesn't convey the fact that it is written as a hashmap. We can address this complaint in one or more ways:</p>
<ul>
<li><p>Provide handy "Rich Comment" blocks <a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a> along with the code, as I've done here, and everywhere else.</p></li>
<li><p>Write the function signature with destructuring:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode clojure"><code class="sourceCode clojure"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true"></a>(<span class="bu">defn</span><span class="fu"> R</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true"></a>  [{<span class="at">:keys</span> [x y d] <span class="at">:as</span> position}]</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true"></a>  (<span class="kw">update</span> position <span class="at">:d</span> rot-R))</span></code></pre></div>
<p>This can be useful, but can also be a matter of taste.</p>
<p>In this case, I find destructuring <em>extra</em>. Mainly because we don't use <code>x, y, d</code> in the function body, and slightly because bindings are created, for <code>x, y, d</code>, which adds some overhead (however negligible) at runtime and I don't like to make my program do throwaway work.</p></li>
<li><p>Write a specification for <code>positon</code>. This would be my preferred option, as compared to destructuring. A specification is more general-purpose, complete, and useful—we can use in tests and validations.</p></li>
<li><p>Tell everyone that "Well, in Clojure, it's almost always a hashmap.", which I'm telling you now :)</p></li>
</ul>
<h2 id="move-one-step">Move one step</h2>
<p>To move is to advance one step in the current direction. This means we have to choose to either increment or decrement either x or y. We are also told to assume "move north" means to go from <code>x,y</code> to <code>x,y+1</code>. Thus, the plateau is laid out south to north, with the south-west corner at 0,0, and north-east corner at max-x,max-y. So <code>M</code> can be defined like this, in terms of our <code>{:x X :y Y :d D}</code> <em>position</em>.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode clojure"><code class="sourceCode clojure"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true"></a>(<span class="bu">defmulti</span><span class="fu"> M</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true"></a>  <span class="st">&quot;Return a position one unit farther in the</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true"></a><span class="st">  current direction.&quot;</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true"></a>  <span class="at">:d</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true"></a>(<span class="bu">defmethod</span><span class="fu"> M </span><span class="at">:N</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true"></a>  [position]</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true"></a>  (<span class="kw">update</span> position <span class="at">:y</span> <span class="kw">inc</span>))</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true"></a>(<span class="bu">defmethod</span><span class="fu"> M </span><span class="at">:S</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true"></a>  [position]</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true"></a>  (<span class="kw">update</span> position <span class="at">:y</span> <span class="kw">dec</span>))</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true"></a></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true"></a>(<span class="bu">defmethod</span><span class="fu"> M </span><span class="at">:E</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true"></a>  [position]</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true"></a>  (<span class="kw">update</span> position <span class="at">:x</span> <span class="kw">inc</span>))</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true"></a></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true"></a>(<span class="bu">defmethod</span><span class="fu"> M </span><span class="at">:W</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true"></a>  [position]</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true"></a>  (<span class="kw">update</span> position <span class="at">:x</span> <span class="kw">dec</span>))</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true"></a></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true"></a>(<span class="kw">comment</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true"></a>  (M {<span class="at">:x</span> <span class="dv">1</span> <span class="at">:y</span> <span class="dv">3</span> <span class="at">:d</span> <span class="at">:N</span>}) <span class="co">; =&gt; {:x 1 :y 4 :d :N}</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true"></a>  (M {<span class="at">:x</span> <span class="dv">1</span> <span class="at">:y</span> <span class="dv">3</span> <span class="at">:d</span> <span class="at">:S</span>}) <span class="co">; =&gt; {:x 1 :y 2 :d :S}</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true"></a>  (M {<span class="at">:x</span> <span class="dv">1</span> <span class="at">:y</span> <span class="dv">3</span> <span class="at">:d</span> <span class="at">:E</span>}) <span class="co">; =&gt; {:x 2 :y 3 :d :E}</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true"></a>  (M {<span class="at">:x</span> <span class="dv">1</span> <span class="at">:y</span> <span class="dv">3</span> <span class="at">:d</span> <span class="at">:W</span>}) <span class="co">; =&gt; {:x 0 :y 3 :d :W}</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true"></a>  )</span></code></pre></div>
<h2 id="move-many-steps-safely">Move Many Steps Safely</h2>
<p>The problem with <code>M</code> above is that it could help us increment or decrement our way out of the grid all the way off a cliff. Like, what if we get a bad insruction sequence?</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode clojure"><code class="sourceCode clojure"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true"></a><span class="co">;; Say our given area of operation is 0,0 to 5,5, and our</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true"></a><span class="co">;; rover starts at 0,0, facing East. This sequence will</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true"></a><span class="co">;; drive us off-grid:</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true"></a>((<span class="kw">comp</span> M M M M M M M R M M M M M M M L)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true"></a> {<span class="at">:x</span> <span class="dv">0</span> <span class="at">:y</span> <span class="dv">0</span> <span class="at">:d</span> <span class="at">:E</span>})</span></code></pre></div>
<p>Well one answer is to <em>throw</em> or <em>panic</em> when we see the badness. A nicer answer is to <em>stay put</em>. Do nothing. Nada. One way to say "nothing" is to clip all out-of-bounds calculations to the edges of the grid.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode clojure"><code class="sourceCode clojure"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true"></a>(<span class="bu">defn</span><span class="fu"> clip-to-bounds</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true"></a>  <span class="st">&quot;Clip the given position to at most the boundary of</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true"></a><span class="st">  the given max/min x,y coordinates of operation.&quot;</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true"></a>  [{<span class="at">:keys</span> [max-x max-y min-x min-y]</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true"></a>    <span class="at">:or</span> {min-x <span class="dv">0</span> min-y <span class="dv">0</span>} <span class="at">:as</span> _bounds}</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true"></a>   {<span class="at">:keys</span> [x y] <span class="at">:as</span> position}]</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true"></a>  (<span class="kw">assoc</span> position</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true"></a>         <span class="at">:x</span> (<span class="kw">min</span> (<span class="kw">max</span> min-x x) max-x)</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true"></a>         <span class="at">:y</span> (<span class="kw">min</span> (<span class="kw">max</span> min-y y) max-y)))</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true"></a></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true"></a>(<span class="kw">comment</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true"></a>  (clip-to-bounds {<span class="at">:max-x</span> <span class="dv">5</span> <span class="at">:max-y</span> <span class="dv">5</span>}</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true"></a>                  {<span class="at">:x</span> <span class="dv">0</span> <span class="at">:y</span> <span class="dv">6</span> <span class="at">:d</span> <span class="at">:N</span>})</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true"></a>  <span class="co">;; =&gt; {:x 0, :y 5, :d :N}</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true"></a></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true"></a>  (clip-to-bounds {<span class="at">:max-x</span> <span class="dv">5</span> <span class="at">:max-y</span> <span class="dv">5</span>}</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true"></a>                  {<span class="at">:x</span> <span class="dv">-1</span> <span class="at">:y</span> <span class="dv">6</span> <span class="at">:d</span> <span class="at">:N</span>})</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true"></a>  <span class="co">;; =&gt; {:x 0, :y 5, :d :N}</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true"></a></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true"></a>  (clip-to-bounds {<span class="at">:max-x</span> <span class="dv">5</span> <span class="at">:max-y</span> <span class="dv">5</span>}</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true"></a>                  {<span class="at">:x</span> <span class="dv">6</span> <span class="at">:y</span> <span class="dv">0</span> <span class="at">:d</span> <span class="at">:N</span>})</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true"></a>  <span class="co">;; =&gt; {:x 5, :y 0, :d :N}</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true"></a></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true"></a>  (clip-to-bounds {<span class="at">:max-x</span> <span class="dv">5</span> <span class="at">:max-y</span> <span class="dv">5</span>}</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true"></a>                  {<span class="at">:x</span> <span class="dv">6</span> <span class="at">:y</span> <span class="dv">-1</span> <span class="at">:d</span> <span class="at">:N</span>})</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true"></a>  <span class="co">;; =&gt; {:x 5, :y 0, :d :N}</span></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true"></a></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true"></a>  (clip-to-bounds {<span class="at">:max-x</span> <span class="dv">5</span> <span class="at">:max-y</span> <span class="dv">5</span>}</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true"></a>                  {<span class="at">:x</span> <span class="dv">6</span> <span class="at">:y</span> <span class="dv">6</span> <span class="at">:d</span> <span class="at">:N</span>})</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true"></a>  <span class="co">;; =&gt; {:x 5, :y 5, :d :N}</span></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true"></a></span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true"></a>  (clip-to-bounds {<span class="at">:max-x</span> <span class="dv">5</span> <span class="at">:max-y</span> <span class="dv">5</span>}</span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true"></a>                  ((<span class="kw">comp</span> M M M M M M M R M M M M M M M L)</span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true"></a>                   {<span class="at">:x</span> <span class="dv">0</span> <span class="at">:y</span> <span class="dv">0</span> <span class="at">:d</span> <span class="at">:E</span>}))</span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true"></a>  <span class="co">;; =&gt; {:x 5, :y 5, :d :E}</span></span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true"></a>  )</span></code></pre></div>
<h2 id="move-safely-around-other-rovers-and-sundry-insurmountable-objects">Move Safely Around Other Rovers and Sundry Insurmountable Objects</h2>
<p>We will just ignore collision detection.</p>
<p>Our rovers are dumb and only follow outside instructions on a pre-planned route. So if mission control botches it, well, we will probably end up with <em>far</em> fewer rovers and maybe no mission to control anymore.</p>
<h1 id="move-3-interpret-the-commands">Move 3: Interpret the commands</h1>
<p>Incoming commands are supposed to tell us to:</p>
<ul>
<li>Rotate <code>:L</code> or <code>:R</code> at the current <code>position</code>, or</li>
<li>Move <code>:M</code> by one step in the current <code>direction</code></li>
</ul>
<p>So the job is to update the <code>{:x X :y Y :d D} position</code> in some way (or not).</p>
<p>We could potentially get unknown or garbled commands. In which case the sanest thing to do may be do nothing. Stay put. We also want to make sure we are always within <code>xy-bounds</code>.</p>
<p>We can express it like this:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode clojure"><code class="sourceCode clojure"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true"></a>(<span class="bu">defmulti</span><span class="fu"> command-interpreter</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true"></a>  <span class="st">&quot;Return updated position given a known set of commands,</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true"></a><span class="st">  or current position given unknown commands.&quot;</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true"></a>  (<span class="kw">fn</span> [xy-bounds position command]</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true"></a>    command))</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true"></a>(<span class="bu">defmethod</span><span class="fu"> command-interpreter </span><span class="at">:L</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true"></a>  [xy-bounds position command]</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true"></a>  (L position))</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true"></a></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true"></a>(<span class="bu">defmethod</span><span class="fu"> command-interpreter </span><span class="at">:R</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true"></a>  [xy-bounds position command]</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true"></a>  (R position))</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true"></a></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true"></a>(<span class="bu">defmethod</span><span class="fu"> command-interpreter </span><span class="at">:M</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true"></a>  [xy-bounds position command]</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true"></a>  (<span class="kw">-&gt;&gt;</span> position</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true"></a>       M</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true"></a>       (clip-to-bounds xy-bounds)))</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true"></a></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true"></a>(<span class="bu">defmethod</span><span class="fu"> command-interpreter </span><span class="at">:default</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true"></a>  [xy-bounds position command]</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true"></a>  position)</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true"></a></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true"></a>(<span class="kw">comment</span></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true"></a>  (command-interpreter {<span class="at">:max-x</span> <span class="dv">5</span> <span class="at">:max-y</span> <span class="dv">5</span>}</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true"></a>                       {<span class="at">:x</span> <span class="dv">1</span> <span class="at">:y</span> <span class="dv">3</span> <span class="at">:d</span> <span class="at">:N</span>}</span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true"></a>                       <span class="at">:M</span>)</span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true"></a>  <span class="co">;; =&gt; {:x 1, :y 4, :d :N}</span></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true"></a></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true"></a>  (command-interpreter {<span class="at">:max-x</span> <span class="dv">5</span> <span class="at">:max-y</span> <span class="dv">5</span>}</span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true"></a>                       {<span class="at">:x</span> <span class="dv">1</span> <span class="at">:y</span> <span class="dv">3</span> <span class="at">:d</span> <span class="at">:N</span>}</span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true"></a>                       <span class="at">:L</span>)</span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true"></a>  <span class="co">;; =&gt; {:x 1, :y 3, :d :W}</span></span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true"></a></span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true"></a>  (command-interpreter {<span class="at">:max-x</span> <span class="dv">5</span> <span class="at">:max-y</span> <span class="dv">5</span>}</span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true"></a>                       {<span class="at">:x</span> <span class="dv">1</span> <span class="at">:y</span> <span class="dv">3</span> <span class="at">:d</span> <span class="at">:N</span>}</span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true"></a>                       <span class="at">:R</span>)</span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true"></a>  <span class="co">;; =&gt; {:x 1, :y 3, :d :E}</span></span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true"></a></span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true"></a>  (command-interpreter {<span class="at">:max-x</span> <span class="dv">5</span> <span class="at">:max-y</span> <span class="dv">5</span>}</span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true"></a>                       {<span class="at">:x</span> <span class="dv">1</span> <span class="at">:y</span> <span class="dv">3</span> <span class="at">:d</span> <span class="at">:N</span>}</span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true"></a>                       <span class="at">:LOL</span>)</span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true"></a>  <span class="co">;; =&gt; {:x 1, :y 3, :d :N}</span></span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true"></a>  )</span></code></pre></div>
<h1 id="move-4-can-we-pretty-please-move-the-rover-already">Move 4: Can we pretty please move the rover already?</h1>
<p>Ok it seems we can calculate updated position. Now can we move the rover?</p>
<p>Arguably, this is a decent place to implement movement, but that means changing the state of the world (moving the rover on the planet). Whenever Clojurists sense the prospect of state and mutation, we head back to our hammocks and ask ourselves if we can turn state into data.</p>
<p>What if we plan the route before actually traversing it? A route plan would be… what? Just a sequence of position maps! This has several implications:</p>
<ol>
<li>Movement reduces to mindlessly following the route. Some other onboard component could dumbly transduce deltas between <em>current</em> and <em>next</em> <code>position</code> into signal required to drive stepper motor, rotor, whatever.</li>
<li>Happily, we also get back some safety: a chance to do collision avoidance (not detection), by comparing plans across rovers.</li>
<li>Further, we can also ensure the locally-calculated plan obeys some ground rules (pun-intended), like <em>"Each position must differ from its predecessor in <strong>exactly</strong> one dimension; <code>:x</code>, or <code>:y</code>, or <code>:d</code>. If it differs in any</em> <em>other way, abort, because it means something is wrong. Either a command failed to arrive in the transmit sequence, or a bug has occurred onboard."</em>.</li>
</ol>
<div class="sourceCode" id="cb11"><pre class="sourceCode clojure"><code class="sourceCode clojure"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true"></a>(<span class="bu">defn</span><span class="fu"> calculate-path</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true"></a>  [{<span class="at">:keys</span> [xy-bounds start-pos commands]}]</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true"></a>  (reductions (<span class="kw">partial</span> command-interpreter xy-bounds)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true"></a>              start-pos</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true"></a>              commands))</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true"></a>(<span class="kw">comment</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true"></a>  (calculate-path</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true"></a>   {<span class="at">:xy-bounds</span> {<span class="at">:max-x</span> <span class="dv">5</span> <span class="at">:max-y</span> <span class="dv">5</span>}</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true"></a>    <span class="at">:start-pos</span> {<span class="at">:x</span> <span class="dv">1</span> <span class="at">:y</span> <span class="dv">2</span> <span class="at">:d</span> <span class="at">:N</span>}</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true"></a>    <span class="at">:commands</span> [<span class="at">:L</span> <span class="at">:M</span> <span class="at">:L</span> <span class="at">:M</span> <span class="at">:L</span> <span class="at">:M</span> <span class="at">:L</span> <span class="at">:M</span> <span class="at">:M</span>]})</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true"></a>  <span class="co">;; =&gt; ({:x 1, :y 2, :d :N}</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true"></a>  <span class="co">;;     {:x 1, :y 2, :d :W}</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true"></a>  <span class="co">;;     {:x 0, :y 2, :d :W}</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true"></a>  <span class="co">;;     {:x 0, :y 2, :d :S}</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true"></a>  <span class="co">;;     {:x 0, :y 1, :d :S}</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true"></a>  <span class="co">;;     {:x 0, :y 1, :d :E}</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true"></a>  <span class="co">;;     {:x 1, :y 1, :d :E}</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true"></a>  <span class="co">;;     {:x 1, :y 1, :d :N}</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true"></a>  <span class="co">;;     {:x 1, :y 2, :d :N}</span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true"></a>  <span class="co">;;     {:x 1, :y 3, :d :N})</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true"></a></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true"></a>  (calculate-path</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true"></a>   {<span class="at">:xy-bounds</span> {<span class="at">:max-x</span> <span class="dv">5</span> <span class="at">:max-y</span> <span class="dv">5</span>}</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true"></a>    <span class="at">:start-pos</span> {<span class="at">:x</span> <span class="dv">3</span> <span class="at">:y</span> <span class="dv">3</span> <span class="at">:d</span> <span class="at">:E</span>}</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true"></a>    <span class="at">:commands</span> [<span class="at">:M</span> <span class="at">:M</span> <span class="at">:R</span> <span class="at">:M</span> <span class="at">:M</span> <span class="at">:R</span> <span class="at">:M</span> <span class="at">:R</span> <span class="at">:R</span> <span class="at">:M</span>]})</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true"></a>  <span class="co">;; =&gt; ({:x 3, :y 3, :d :E}</span></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true"></a>  <span class="co">;;     {:x 4, :y 3, :d :E}</span></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true"></a>  <span class="co">;;     {:x 5, :y 3, :d :E}</span></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true"></a>  <span class="co">;;     {:x 5, :y 3, :d :S}</span></span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true"></a>  <span class="co">;;     {:x 5, :y 2, :d :S}</span></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true"></a>  <span class="co">;;     {:x 5, :y 1, :d :S}</span></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true"></a>  <span class="co">;;     {:x 5, :y 1, :d :W}</span></span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true"></a>  <span class="co">;;     {:x 4, :y 1, :d :W}</span></span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true"></a>  <span class="co">;;     {:x 4, :y 1, :d :N}</span></span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true"></a>  <span class="co">;;     {:x 4, :y 1, :d :E}</span></span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true"></a>  <span class="co">;;     {:x 5, :y 1, :d :E})</span></span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true"></a>  )</span></code></pre></div>
<h1 id="move-5-ok-now-we-can-move-it.">Move 5: Ok, <em>now</em> we can move it.</h1>
<p>Or more like model the motion of the rover, because I don't know systems programming :D</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode clojure"><code class="sourceCode clojure"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true"></a>(<span class="bu">def</span><span class="fu"> rover-one</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true"></a>  ^{<span class="at">:doc</span> <span class="do">&quot;A rover contains information about mission</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true"></a><span class="do">objectives... where it was, what it&#39;s been told to do,</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true"></a><span class="do">where it&#39;s headed, where it&#39;s allowed to operate etc.&quot;</span>}</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true"></a>  (<span class="kw">atom</span> {<span class="at">:xy-bounds</span> <span class="va">nil</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true"></a>         <span class="at">:start-pos</span> <span class="va">nil</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true"></a>         <span class="at">:commands</span> <span class="va">nil</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true"></a>         <span class="at">:path</span> <span class="va">nil</span>}))</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true"></a></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true"></a>(<span class="bu">defn</span><span class="fu"> init-rover!</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true"></a>  <span class="st">&quot;Initialise rover with info. about its current mission,</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true"></a><span class="st">  viz. bounds of operation, start location, and full path</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true"></a><span class="st">  to traverse.&quot;</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true"></a>  [rover</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true"></a>   {<span class="at">:keys</span> [xy-bounds start-pos commands]</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true"></a>    <span class="at">:as</span> rover-plan}]</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true"></a>  (<span class="kw">reset!</span> rover</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true"></a>          {<span class="at">:xy-bounds</span> xy-bounds</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true"></a>           <span class="at">:start-pos</span> start-pos</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true"></a>           <span class="at">:commands</span> commands</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true"></a>           <span class="at">:path</span> (calculate-path rover-plan)}))</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true"></a></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true"></a>(<span class="bu">defn</span><span class="fu"> advance-rover!</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true"></a>  <span class="st">&quot;Keep moving the rover along the calculated path sequence until</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true"></a><span class="st">      no more path remains. The path reduces as the rover advances.&quot;</span></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true"></a>  [rover]</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true"></a>  (<span class="kw">let</span> [pos-before-move (<span class="kw">first</span> (<span class="at">:path</span> <span class="at">@rover</span>))]</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true"></a>    (<span class="kw">swap!</span> rover</span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true"></a>           <span class="kw">update</span></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true"></a>           <span class="at">:path</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true"></a>           <span class="kw">rest</span>)</span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true"></a>    (<span class="kw">println</span> <span class="st">&quot;Rover moved from&quot;</span></span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true"></a>             pos-before-move</span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true"></a>             <span class="st">&quot;to&quot;</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true"></a>             (<span class="kw">first</span> (<span class="at">:path</span> <span class="at">@rover</span>)))))</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true"></a></span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true"></a>(<span class="kw">comment</span></span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true"></a>  (init-rover! rover-one</span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true"></a>               {<span class="at">:xy-bounds</span> {<span class="at">:max-x</span> <span class="dv">5</span> <span class="at">:max-y</span> <span class="dv">5</span>}</span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true"></a>                <span class="at">:start-pos</span> {<span class="at">:x</span> <span class="dv">3</span> <span class="at">:y</span> <span class="dv">3</span> <span class="at">:d</span> <span class="at">:E</span>}</span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true"></a>                <span class="at">:commands</span> [<span class="at">:M</span> <span class="at">:M</span> <span class="at">:R</span> <span class="at">:M</span> <span class="at">:M</span> <span class="at">:R</span> <span class="at">:M</span> <span class="at">:R</span> <span class="at">:R</span> <span class="at">:M</span>]})</span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true"></a></span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true"></a>  (advance-rover! rover-one)</span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true"></a>  )</span></code></pre></div>
<h1 id="finally-imperative-shell-to-parse-incoming-signal">Finally: "Imperative shell" to parse incoming signal</h1>
<p>By now, I hope you're sold on the idea that parsing is incidental complexity.</p>
<p>Seasoned programmers will recognise the usual icky, tricky, finicky code that must absorb the insanity of data inbound from the wild. Someone has to do it. Might as well be us. There are many ways to do it. Here is one way.</p>
<p>That said, even though we have to do I/O, the general technique is to solve small pieces of the problem <em>ideally as pure functions</em>, and compose them into the full solution. Stave off actual state management or I/O to the very end.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode clojure"><code class="sourceCode clojure"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true"></a>(<span class="bu">defn</span><span class="fu"> parse-max-bounds</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true"></a>  [max-bounds-line]</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true"></a>  (<span class="kw">let</span> [[x y] (clojure.string/split max-bounds-line</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true"></a>                                    <span class="ss">#&quot;\s+&quot;</span>)]</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true"></a>    {<span class="at">:max-x</span> (Integer/parseInt x)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true"></a>     <span class="at">:max-y</span> (Integer/parseInt y)}))</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true"></a>(<span class="bu">defn</span><span class="fu"> parse-start-position</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true"></a>  [start-position-line]</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true"></a>  (<span class="kw">let</span> [[x y d] (clojure.string/split start-position-line</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true"></a>                                      <span class="ss">#&quot;\s+&quot;</span>)]</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true"></a>    {<span class="at">:x</span> (Integer/parseInt x)</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true"></a>     <span class="at">:y</span> (Integer/parseInt y)</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true"></a>     <span class="at">:d</span> (<span class="kw">keyword</span> d)}))</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true"></a></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true"></a>(<span class="bu">defn</span><span class="fu"> parse-commands-line</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true"></a>  [commands-line]</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true"></a>  (<span class="kw">map</span> (<span class="kw">comp</span> <span class="kw">keyword</span> <span class="kw">str</span>)</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true"></a>       commands-line))</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true"></a></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true"></a>(<span class="bu">defn</span><span class="fu"> parse-command-input</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true"></a>  [[start-position-raw commands-raw]]</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true"></a>  {<span class="at">:start-pos</span> (parse-start-position start-position-raw)</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true"></a>   <span class="at">:commands</span> (parse-commands-line commands-raw)})</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true"></a></span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true"></a>(<span class="bu">defn</span><span class="fu"> ingest-command-data</span></span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true"></a>  [command-data-file]</span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true"></a>  (<span class="kw">let</span> [raw-data (<span class="kw">-&gt;&gt;</span> command-data-file</span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true"></a>                      <span class="kw">slurp</span></span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true"></a>                      clojure.string/split-lines</span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true"></a>                      (<span class="kw">mapv</span> clojure.string/trim))</span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true"></a>        max-xy-bounds (parse-max-bounds (<span class="kw">first</span> raw-data))</span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true"></a>        xy-bounds (<span class="kw">assoc</span> max-xy-bounds</span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true"></a>                         <span class="at">:min-x</span> <span class="dv">0</span></span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true"></a>                         <span class="at">:min-y</span> <span class="dv">0</span>)</span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true"></a>        start-pos-commands-pairs-raw (<span class="kw">partition</span> <span class="dv">2</span> (<span class="kw">rest</span> raw-data))]</span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true"></a>    (<span class="kw">map</span> (<span class="kw">fn</span> [[start-position-raw commands-raw]]</span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true"></a>           {<span class="at">:start-pos</span> (parse-start-position start-position-raw)</span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true"></a>            <span class="at">:commands</span> (parse-commands-line commands-raw)</span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true"></a>            <span class="at">:xy-bounds</span> xy-bounds})</span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true"></a>         start-pos-commands-pairs-raw)))</span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true"></a></span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true"></a>(<span class="kw">comment</span></span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true"></a>  <span class="co">;; Test Input, as per problem statement:</span></span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true"></a></span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true"></a>  <span class="co">;; 5 5</span></span>
<span id="cb13-47"><a href="#cb13-47" aria-hidden="true"></a>  <span class="co">;; 1 2 N</span></span>
<span id="cb13-48"><a href="#cb13-48" aria-hidden="true"></a>  <span class="co">;; LMLMLMLMM</span></span>
<span id="cb13-49"><a href="#cb13-49" aria-hidden="true"></a>  <span class="co">;; 3 3 E</span></span>
<span id="cb13-50"><a href="#cb13-50" aria-hidden="true"></a>  <span class="co">;; MMRMMRMRRM</span></span>
<span id="cb13-51"><a href="#cb13-51" aria-hidden="true"></a></span>
<span id="cb13-52"><a href="#cb13-52" aria-hidden="true"></a>  <span class="co">;; Expected Output:</span></span>
<span id="cb13-53"><a href="#cb13-53" aria-hidden="true"></a></span>
<span id="cb13-54"><a href="#cb13-54" aria-hidden="true"></a>  <span class="co">;; 1 3 N</span></span>
<span id="cb13-55"><a href="#cb13-55" aria-hidden="true"></a>  <span class="co">;; 5 1 E</span></span>
<span id="cb13-56"><a href="#cb13-56" aria-hidden="true"></a></span>
<span id="cb13-57"><a href="#cb13-57" aria-hidden="true"></a>  (<span class="kw">let</span> [_ (spit <span class="st">&quot;rover-commands.txt&quot;</span></span>
<span id="cb13-58"><a href="#cb13-58" aria-hidden="true"></a>                <span class="st">&quot;5 5</span></span>
<span id="cb13-59"><a href="#cb13-59" aria-hidden="true"></a><span class="st">            1 2 N</span></span>
<span id="cb13-60"><a href="#cb13-60" aria-hidden="true"></a><span class="st">            LMLMLMLMM</span></span>
<span id="cb13-61"><a href="#cb13-61" aria-hidden="true"></a><span class="st">            3 3 E</span></span>
<span id="cb13-62"><a href="#cb13-62" aria-hidden="true"></a><span class="st">            MMRMMRMRRM&quot;</span>)</span>
<span id="cb13-63"><a href="#cb13-63" aria-hidden="true"></a>        input-command-data (ingest-command-data <span class="st">&quot;rover-commands.txt&quot;</span>)</span>
<span id="cb13-64"><a href="#cb13-64" aria-hidden="true"></a>        final-position-as-str (<span class="kw">comp</span> (<span class="kw">partial</span> clojure.string/join <span class="st">&quot; &quot;</span>)</span>
<span id="cb13-65"><a href="#cb13-65" aria-hidden="true"></a>                                    (<span class="kw">juxt</span> <span class="at">:x</span> <span class="at">:y</span> (<span class="kw">comp</span> <span class="kw">name</span> <span class="at">:d</span>))</span>
<span id="cb13-66"><a href="#cb13-66" aria-hidden="true"></a>                                    <span class="kw">last</span></span>
<span id="cb13-67"><a href="#cb13-67" aria-hidden="true"></a>                                    calculate-path)]</span>
<span id="cb13-68"><a href="#cb13-68" aria-hidden="true"></a>    (<span class="kw">map</span> final-position-as-str</span>
<span id="cb13-69"><a href="#cb13-69" aria-hidden="true"></a>         input-command-data))</span>
<span id="cb13-70"><a href="#cb13-70" aria-hidden="true"></a>  <span class="co">;; =&gt; (&quot;1 3 N&quot; &quot;5 1 E&quot;)</span></span>
<span id="cb13-71"><a href="#cb13-71" aria-hidden="true"></a>  )</span></code></pre></div>
<h1 id="recap">Recap</h1>
<p>The complete code at one go…</p>
<script src="https://gist.github.com/adityaathalye/cefe71a5cd5b729102d6adfcd7a6ab77.js"></script>

<h1 id="footnotes">Footnotes</h1>
<section class="footnotes" role="doc-endnotes">
<hr />
<ol>
<li id="fn1" role="doc-endnote"><p>If you know one way to FizzBuzz, here are <a href="https://www.evalapply.org/posts/n-ways-to-fizzbuzz-in-clojure/index.html#main">n ways to FizzBuzz in Clojure</a><a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2" role="doc-endnote"><p><a href="https://www.youtube.com/watch?v=f84n5oFoZBc">Hammock Driven Development</a>, Rich Hickey's second, "philosophical" talk at the first Clojure Conj, in Durham, North Carolina on October 23rd, 2010.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3" role="doc-endnote"><p>The so-called <em>"Functional Core, Imperative Shell"</em> architecture pattern. <a href="https://www.destroyallsoftware.com/screencasts/catalog/functional-core-imperative-shell">Gary Bernhardt's tutorial</a>, <a href="https://kumarshantanu.medium.com/organizing-clojure-code-with-functional-core-imperative-shell-2f2ee869faa2">Kumar Shantanu's blog post</a>, <a href="https://web.archive.org/web/20210513194256/https://clojureverse.org/t/organizing-clojure-code-a-real-problem/7567">The discussion at Clojureverse</a><a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4" role="doc-endnote"><p>We can imagine having to implement a latitude-longitude system. We could express it as <code>[[deg min sec direction] [deg min sec direction]]</code>. <em>Or</em> we could use a map <code>{:lat {:deg D :min M :sec S :dir D}
:lon {:deg D :min M :sec S :dir D}}</code>. Which is the superior model?<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5" role="doc-endnote"><p>Rich Comment blocks are very handy! See discussions:</p>
<ul>
<li><p>Stu Halloway's remarks in his excellent talk: <em><a href="https://youtu.be/Qx0-pViyIDU?t=1229">Running With Scissors: Live Coding with Data (at 20m 31s)</a></em></p>
<blockquote>
<p>"These comments are rich because they provide rich detail about the development process and because they were written by a person named Rich."</p>
</blockquote></li>
<li><p>In the <a href="https://calva.io/rich-comments/">Calva plugin's documentation</a></p></li>
<li><p>Blog post by <a href="https://betweentwoparens.com/blog/rich-comment-blocks/#rich-comment">betweentwoparens</a></p></li>
<li><p>Tutorial by <a href="https://practical.li/clojure/clojure-cli/projects/rich-comments.html">practical.li</a></p></li>
</ul>
<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></li>
</ol>
</section>
  </section>
  <footer id="blog-post-footer" class="footer">
    <nav class="cluster">
      <span>&uarr; <a href="#blog-post" rel="bookmark">title</a></span>
      <span>&uarr; <a href="#site-header" rel="bookmark">menu</a></span>
      <span>&rarr; <a href="mailto:weblog@evalapply.org">email comments</a></span>
    </nav>
  </footer>
</article>
        </main>
        <footer id="site-footer">
<hr>
<div class="box invert footer stack">
  <div class="cluster">
    <span>&#128231; : <a href="mailto:hello@evalapply.org">hello@evalapply.org</a></span>
    <a class="site-feed"
       href="https://evalapply.org/index.xml">
       Blog feed
    </a>
    <form class="cluster"
          action="https://buttondown.email/api/emails/embed-subscribe/evalapply"
          method="post" target="popupwindow"
          onsubmit="window.open('https://buttondown.email/evalapply','popupwindow')">
        <input type="email" name="email" id="bd-email">
      <span>
        <input type="submit" value="Get occasional newsletter">
        <em>(thanks, <a href="https://buttondown.email" target="_blank">Buttondown</a>!)</em>
      </span>
    </form>
  </div>
  <hr>
  <p>&copy; copyright 2022, <a href="https://evalapply.org" target="_blank">Aditya Athalye</a>.
    <span>Except where otherwise noted, content on this site is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">
    Creative Commons Attribution-ShareAlike 4.0 International License
    </a>, the same one used by Wikipedia.</span>
<span><a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">
    <img alt="Creative Commons License" style="border-width:0"
         src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png">
    </a></span>
  </p>
  <hr>
  <p> Made with
      <a href="https://www.gnu.org/software/emacs/">GNU Emacs</a>,
      <a href="https://orgmode.org/">org-mode</a>, and
      <a href="https://github.com/adityaathalye/shite">shite</a>.
  </p>
  <p id="recurse-scout">
  <script async defer src="https://www.recurse-scout.com/loader.js?t=40533398b8c93bb4f3323a170e032e91"></script>
  </p>
</div>
</footer>
    </div>
  </body>
</html>
